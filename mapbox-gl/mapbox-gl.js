(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Buffer(t){t?(this.array=t.array,this.pos=t.pos):(this.array=new ArrayBuffer(this.defaultLength),this.length=this.defaultLength,this.setupViews())}module.exports=Buffer,Buffer.prototype={pos:0,itemSize:4,defaultLength:8192,arrayType:"ARRAY_BUFFER",get index(){return this.pos/this.itemSize},setupViews:function(){this.ubytes=new Uint8Array(this.array),this.bytes=new Int8Array(this.array),this.ushorts=new Uint16Array(this.array),this.shorts=new Int16Array(this.array)},bind:function(t){var e=t[this.arrayType];this.buffer?t.bindBuffer(e,this.buffer):(this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.array.slice(0,this.pos),t.STATIC_DRAW),this.array=null)},destroy:function(t){this.buffer&&t.deleteBuffer(this.buffer)},resize:function(){if(this.length<this.pos+this.itemSize){for(;this.length<this.pos+this.itemSize;)this.length=2*Math.round(1.5*this.length/2);this.array=new ArrayBuffer(this.length);var t=new Uint8Array(this.array);t.set(this.ubytes),this.setupViews()}}};
},{}],2:[function(require,module,exports){
"use strict";var LineVertexBuffer=require("./line_vertex_buffer"),LineElementBuffer=require("./line_element_buffer"),FillVertexBuffer=require("./fill_vertex_buffer"),FillElementBuffer=require("./fill_elements_buffer"),OutlineElementBuffer=require("./outline_elements_buffer"),GlyphVertexBuffer=require("./glyph_vertex_buffer"),IconVertexBuffer=require("./icon_vertex_buffer");module.exports=function(e){return e=e||{},{glyphVertex:new GlyphVertexBuffer(e.glyphVertex),iconVertex:new IconVertexBuffer(e.iconVertex),fillVertex:new FillVertexBuffer(e.fillVertex),fillElement:new FillElementBuffer(e.fillElement),outlineElement:new OutlineElementBuffer(e.outlineElement),lineVertex:new LineVertexBuffer(e.lineVertex),lineElement:new LineElementBuffer(e.lineElement)}};
},{"./fill_elements_buffer":3,"./fill_vertex_buffer":4,"./glyph_vertex_buffer":5,"./icon_vertex_buffer":6,"./line_element_buffer":7,"./line_vertex_buffer":8,"./outline_elements_buffer":9}],3:[function(require,module,exports){
"use strict";function FillElementsBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=FillElementsBuffer,FillElementsBuffer.prototype=util.inherit(Buffer,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t,i){var r=this.pos/2;this.resize(),this.ushorts[r+0]=e,this.ushorts[r+1]=t,this.ushorts[r+2]=i,this.pos+=this.itemSize}});
},{"../../util/util":86,"./buffer":1}],4:[function(require,module,exports){
"use strict";function FillVertexBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=FillVertexBuffer,FillVertexBuffer.prototype=util.inherit(Buffer,{itemSize:4,add:function(e,i){var t=this.pos/2;this.resize(),this.shorts[t+0]=e,this.shorts[t+1]=i,this.pos+=this.itemSize}});
},{"../../util/util":86,"./buffer":1}],5:[function(require,module,exports){
"use strict";function GlyphVertexBuffer(t){Buffer.call(this,t)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype=util.inherit(Buffer,{defaultLength:32768,itemSize:16,add:function(t,e,r,i,h,s,o,u,a,f,n){var l=this.pos,b=l/2,y=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[b+0]=t,this.shorts[b+1]=e,this.shorts[b+2]=Math.round(64*r),this.shorts[b+3]=Math.round(64*i),this.ubytes[l+8]=Math.floor(h/4),this.ubytes[l+9]=Math.floor(s/4),this.ubytes[l+10]=Math.floor(10*(n||0)),this.ubytes[l+11]=Math.round(o*y)%256,this.ubytes[l+12]=Math.floor(10*(u||0)),this.ubytes[l+13]=Math.floor(10*Math.min(f||25,25)),this.ubytes[l+14]=Math.max(Math.round(a[0]*y),0)%256,this.ubytes[l+15]=Math.min(Math.round(a[1]*y),255)%256,this.pos+=this.itemSize},bind:function(t,e){Buffer.prototype.bind.call(this,t);var r=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,r,0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,r,4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,r,8),t.vertexAttribPointer(e.a_data2,4,t.UNSIGNED_BYTE,!1,r,12)}});
},{"../../util/util":86,"./buffer":1}],6:[function(require,module,exports){
"use strict";function GlyphVertexBuffer(t){Buffer.call(this,t)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype=util.inherit(Buffer,{defaultLength:32768,itemSize:16,add:function(t,e,r,i,s,h,u,o,a,f,n){var l=this.pos,b=l/2,y=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[b+0]=t,this.shorts[b+1]=e,this.shorts[b+2]=Math.round(64*r),this.shorts[b+3]=Math.round(64*i),this.ubytes[l+8]=s/4,this.ubytes[l+9]=h/4,this.ubytes[l+10]=Math.floor(10*(n||0)),this.ubytes[l+11]=Math.round(u*y)%256,this.ubytes[l+12]=Math.floor(10*(o||0)),this.ubytes[l+13]=Math.floor(10*Math.min(f||25,25)),this.ubytes[l+14]=Math.max(Math.round(a[0]*y),0)%256,this.ubytes[l+15]=Math.min(Math.round(a[1]*y),255)%256,this.pos+=this.itemSize},bind:function(t,e){Buffer.prototype.bind.call(this,t);var r=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,r,0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,r,4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,r,8),t.vertexAttribPointer(e.a_data2,4,t.UNSIGNED_BYTE,!1,r,12)}});
},{"../../util/util":86,"./buffer":1}],7:[function(require,module,exports){
"use strict";function LineElementBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=LineElementBuffer,LineElementBuffer.prototype=util.inherit(Buffer,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t,i){var r=this.pos/2;this.resize(),this.ushorts[r+0]=e,this.ushorts[r+1]=t,this.ushorts[r+2]=i,this.pos+=this.itemSize}});
},{"../../util/util":86,"./buffer":1}],8:[function(require,module,exports){
"use strict";function LineVertexBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=LineVertexBuffer,LineVertexBuffer.extrudeScale=63,LineVertexBuffer.prototype=util.inherit(Buffer,{itemSize:8,defaultLength:32768,add:function(e,t,r,i,s){var u=this.pos,f=u/2,h=this.index,o=LineVertexBuffer.extrudeScale;return this.resize(),this.shorts[f+0]=2*Math.floor(e.x)|r,this.shorts[f+1]=2*Math.floor(e.y)|i,this.bytes[u+4]=Math.round(o*t.x),this.bytes[u+5]=Math.round(o*t.y),this.bytes[u+6]=(s||0)/128,this.bytes[u+7]=(s||0)%128,this.pos+=this.itemSize,h}});
},{"../../util/util":86,"./buffer":1}],9:[function(require,module,exports){
"use strict";function OutlineElementsBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=OutlineElementsBuffer,OutlineElementsBuffer.prototype=util.inherit(Buffer,{itemSize:4,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t){var i=this.pos/2;this.resize(),this.ushorts[i+0]=e,this.ushorts[i+1]=t,this.pos+=this.itemSize}});
},{"../../util/util":86,"./buffer":1}],10:[function(require,module,exports){
"use strict";function createBucket(e,t,r,u){if(LayoutProperties[e.type]){var i=new LayoutProperties[e.type](e.layout),o="line"===e.type?LineBucket:"fill"===e.type?FillBucket:"symbol"===e.type?SymbolBucket:"raster"===e.type?RasterBucket:null,c=new o(i,t,r,u);return c.type=e.type,c.interactive=e.interactive,c.minZoom=e.minzoom,c.maxZoom=e.maxzoom,c}}module.exports=createBucket;var LineBucket=require("./line_bucket"),FillBucket=require("./fill_bucket"),SymbolBucket=require("./symbol_bucket"),RasterBucket=require("./raster_bucket"),LayoutProperties=require("../style/layout_properties");
},{"../style/layout_properties":47,"./fill_bucket":13,"./line_bucket":14,"./raster_bucket":15,"./symbol_bucket":16}],11:[function(require,module,exports){
"use strict";function ElementGroups(e,t,n){this.vertexBuffer=e,this.elementBuffer=t,this.secondElementBuffer=n,this.groups=[]}function ElementGroup(e,t,n){this.vertexStartIndex=e,this.elementStartIndex=t,this.secondElementStartIndex=n,this.elementLength=0,this.vertexLength=0,this.secondElementLength=0}module.exports=ElementGroups,ElementGroups.prototype.makeRoomFor=function(e){(!this.current||this.current.vertexLength+e>65535)&&(this.current=new ElementGroup(this.vertexBuffer.index,this.elementBuffer&&this.elementBuffer.index,this.secondElementBuffer&&this.secondElementBuffer.index),this.groups.push(this.current))};
},{}],12:[function(require,module,exports){
"use strict";function FeatureTree(e,t){this.getGeometry=e,this.getType=t,this.rtree=rbush(9),this.toBeInserted=[]}function geometryContainsPoint(e,t,r,n){return"Point"===t?pointContainsPoint(e,r,n):"LineString"===t?lineContainsPoint(e,r,n):"Polygon"===t?polyContainsPoint(e,r)?!0:lineContainsPoint(e,r,n):!1}function distToSegmentSquared(e,t,r){var n=t.distSqr(r);if(0===n)return e.distSqr(t);var o=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(0>o?t:o>1?r:r.sub(t)._mult(o)._add(t))}function lineContainsPoint(e,t,r){for(var n=r*r,o=0;o<e.length;o++)for(var i=e[o],s=1;s<i.length;s++){var u=i[s-1],a=i[s];if(distToSegmentSquared(t,u,a)<n)return!0}return!1}function polyContainsPoint(e,t){for(var r,n,o,i=!1,s=0;s<e.length;s++){r=e[s];for(var u=0,a=r.length-1;u<r.length;a=u++)n=r[u],o=r[a],n.y>t.y!=o.y>t.y&&t.x<(o.x-n.x)*(t.y-n.y)/(o.y-n.y)+n.x&&(i=!i)}return i}function pointContainsPoint(e,t,r){for(var n=r*r,o=0;o<e.length;o++)for(var i=e[o],s=0;s<i.length;s++)if(i[s].distSqr(t)<=n)return!0;return!1}var rbush=require("rbush"),Point=require("point-geometry");module.exports=FeatureTree,FeatureTree.prototype.insert=function(e,t,r){e.info=t,e.feature=r,this.toBeInserted.push(e)},FeatureTree.prototype._load=function(){this.rtree.load(this.toBeInserted),this.toBeInserted=[]},FeatureTree.prototype.query=function(e,t){this.toBeInserted.length&&this._load();for(var r=e.params||{},n=4096*(r.radius||0)/e.scale,o=e.x,i=e.y,s=[],u=this.rtree.search([o-n,i-n,o+n,i+n]),a=0;a<u.length;a++){var y=u[a].feature,f=this.getType(y),l=this.getGeometry(y);if(!(r.bucket&&u[a].info.id!==r.bucket.id||r.$type&&f!==r.$type||!geometryContainsPoint(l,f,new Point(o,i),n))){var p=this.formatResults(u[a].info);p.properties=u[a].feature.properties,p.$type=f,r.geometry&&(p._geometry=l),s.push(p)}}t(null,s)},FeatureTree.prototype.formatResults=function(e){var t={$type:e.$type,layer:{id:e.id,type:e.type,source:e.source,"source-layer":e["source-layer"],layout:e.layout}};return e.ref&&(t.layer.ref=e.ref),t};
},{"point-geometry":99,"rbush":100}],13:[function(require,module,exports){
"use strict";function FillBucket(e,t,r,l){this.layoutProperties=e,this.buffers=t,this.elementGroups=l||new ElementGroups(t.fillVertex,t.fillElement,t.outlineElement)}var ElementGroups=require("./element_groups");module.exports=FillBucket,FillBucket.prototype.addFeatures=function(){for(var e=this.features,t=0;t<e.length;t++){var r=e[t];this.addFeature(r.loadGeometry())}},FillBucket.prototype.addFeature=function(e){for(var t=0;t<e.length;t++)this.addFill(e[t])},FillBucket.prototype.addFill=function(e){if(!(e.length<3)){var t=e.length;this.elementGroups.makeRoomFor(t+1);var r=this.elementGroups.current,l=this.buffers.fillVertex,n=this.buffers.fillElement,i=this.buffers.outlineElement;r.vertexLength++;for(var o,u,s,a=l.index-r.vertexStartIndex,d=0;d<e.length;d++)u=l.index-r.vertexStartIndex,s=e[d],l.add(s.x,s.y),r.vertexLength++,d>=2&&(s.x!==e[0].x||s.y!==e[0].y)&&(n.add(a,o,u),r.elementLength++),d>=1&&(i.add(o,u),r.secondElementLength++),o=u}},FillBucket.prototype.hasData=function(){return!!this.elementGroups.current};
},{"./element_groups":11}],14:[function(require,module,exports){
"use strict";function LineBucket(e,t,r,i){this.layoutProperties=e,this.buffers=t,this.elementGroups=i||new ElementGroups(t.lineVertex,t.lineElement)}var ElementGroups=require("./element_groups");module.exports=LineBucket,LineBucket.prototype.addFeatures=function(){for(var e=this.features,t=0;t<e.length;t++){var r=e[t];this.addFeature(r.loadGeometry())}},LineBucket.prototype.addFeature=function(e){for(var t=this.layoutProperties,r=0;r<e.length;r++)this.addLine(e[r],t["line-join"],t["line-cap"],t["line-miter-limit"],t["line-round-limit"])},LineBucket.prototype.addLine=function(e,t,r,i,n){function u(e,t,r,i){var n,u=i?1:0;n=e.mult(G),t&&n._sub(e.perp()._mult(t)),g=d.add(v,n,u,0,q)-f,y>=0&&L>=0&&(p.add(y,L,g),m.elementLength++),y=L,L=g,n=e.mult(-G),r&&n._sub(e.perp()._mult(r)),g=d.add(v,n,u,1,q)-f,y>=0&&L>=0&&(p.add(y,L,g),m.elementLength++),y=L,L=g,m.vertexLength+=2}for(var l=e.length;l>2&&e[l-1].equals(e[l-2]);)l--;if(!(e.length<2)){"bevel"===t&&(i=1.05);var a=e[0],s=e[l-1],o=a.equals(s),d=this.buffers.lineVertex,p=this.buffers.lineElement;this.elementGroups.makeRoomFor(4*l);var m=this.elementGroups.current,f=m.vertexStartIndex;if(2!=l||!o){var v,h,b,c,_,y,L,g,x=r,k=o?"butt":r,G=1,q=0;o&&(v=e[l-2],_=a.sub(v)._unit()._perp());for(var B=0;l>B;B++)if(b=o&&B===l-1?e[1]:e[B+1],!b||!e[B].equals(b)){_&&(c=_),v&&(h=v),v=e[B],h&&(q+=v.dist(h)),_=b?b.sub(v)._unit()._perp():c,c=c||_;var E=c.add(_)._unit(),F=E.x*_.x+E.y*_.y,P=1/F,V=void 0===y||void 0===L,j=h&&b,w=j?t:b?x:k;if(j&&"round"===w&&n>P&&(w="miter"),"miter"===w&&P>i&&(w="bevel"),"bevel"===w&&(P>4&&(w="flipbevel"),i>P&&(w="miter")),"miter"===w)E._mult(P),u(E,0,0,!1);else if("flipbevel"===w){if(P>100)G=-G,E=_;else{var D=P*c.add(_).mag()/c.sub(_).mag();E._perp()._mult(G*D),G=-G}u(E,0,0,!1)}else{var I,M;if("bevel"===w){var R=c.x*_.y-c.y*_.x,S=-Math.sqrt(P*P-1);G*R>0?(M=0,I=S):(I=0,M=S)}else I=M="square"===w?1:0;V||u(c,I,M,!1),V||"round"!==w||u(c,1,1,!0),(V||"bevel"!==w)&&(y=L=-1,G=1),V&&"round"===x&&u(_,-1,-1,!0),b&&u(_,-I,-M,!1)}}}}},LineBucket.prototype.hasData=function(){return!!this.elementGroups.current};
},{"./element_groups":11}],15:[function(require,module,exports){
"use strict";function RasterBucket(t){this.layoutProperties=t}module.exports=RasterBucket;
},{}],16:[function(require,module,exports){
"use strict";function SymbolBucket(e,t,o,n){this.layoutProperties=e,this.buffers=t,this.collision=o,"line"===e["symbol-placement"]&&(e.hasOwnProperty("text-rotation-alignment")||(e["text-rotation-alignment"]="map"),e.hasOwnProperty("icon-rotation-alignment")||(e["icon-rotation-alignment"]="map"),e["symbol-avoid-edges"]=!0),this.elementGroups=n?n:{text:new ElementGroups(t.glyphVertex),icon:new ElementGroups(t.iconVertex)}}function byScale(e,t){return e.scale-t.scale}var ElementGroups=require("./element_groups"),Anchor=require("../symbol/anchor"),interpolate=require("../symbol/interpolate"),Point=require("point-geometry"),resolveTokens=require("../util/token"),Placement=require("../symbol/placement"),Shaping=require("../symbol/shaping"),resolveText=require("../symbol/resolve_text"),resolveIcons=require("../symbol/resolve_icons");module.exports=SymbolBucket;var fullRange=[2*Math.PI,0];SymbolBucket.prototype.addFeatures=function(){var e=this.layoutProperties,t=this.features,o=this.textFeatures,n=.5,s=.5;switch(e["text-anchor"]){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(e["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}var i=.5;"right"===e["text-justify"]?i=1:"left"===e["text-justify"]&&(i=0);for(var a=24,r=e["text-line-height"]*a,l="line"!==e["symbol-placement"]&&e["text-max-width"]*a,c=e["text-letter-spacing"]*a,h=e["text-font"],m=[e["text-offset"][0]*a,e["text-offset"][1]*a],p=0;p<t.length;p++){var u=t[p],x=o[p],y=u.loadGeometry(),g=!1;x&&(g=Shaping.shape(x,h,this.stacks,l,r,n,s,i,c,m));var d=!1;this.icons&&e["icon-image"]&&(d=this.icons[resolveTokens(u.properties,e["icon-image"])],d&&("undefined"==typeof this.elementGroups.sdfIcons?this.elementGroups.sdfIcons=d.sdf:this.elementGroups.sdfIcons!=d.sdf&&console.warn("Style sheet warning: Cannot mix SDF and non-SDF icons in one bucket"))),(g||d)&&this.addFeature(y,this.stacks,g,d)}},SymbolBucket.prototype.addFeature=function(e,t,o,n){for(var s=this.layoutProperties,i=this.collision,a=.5,r=24,l="viewport"===s["text-rotation-alignment"],c="viewport"===s["icon-rotation-alignment"],h=s["text-max-size"]/r,m=i.tilePixelRatio*h,p=i.tilePixelRatio*s["icon-max-size"],u=s["text-optional"]||!o,x=s["icon-optional"]||!n,y=s["symbol-avoid-edges"],g=0;g<e.length;g++){var d,f=e[g];"line"===s["symbol-placement"]?(d=interpolate(f,s["symbol-min-distance"],a,i.maxPlacementScale,i.tilePixelRatio),d.sort(byScale)):d=[new Anchor(f[0].x,f[0].y,0,a)];for(var b=new Point(0,-17),v=0,S=d.length;S>v;v++){var k=d[v],P=!(k.x<0||k.x>4096||k.y<0||k.y>4096);if(!y||P){var w,M,G=null,q=null;if((!o||(w=Placement.getGlyphs(k,b,o,t,m,l,f,s),G=s["text-allow-overlap"]?w.minScale:i.getPlacementScale(w.boxes,w.minScale,y),G||u))&&(!n||(M=Placement.getIcon(k,n,p,f,s),q=s["icon-allow-overlap"]?M.minScale:i.getPlacementScale(M.boxes,M.minScale,y),q||x))){u||x?!x&&G?G=Math.max(q,G):!u&&q&&(q=Math.max(q,G)):q=G=Math.max(q,G);var B=!G||s["text-allow-overlap"]?fullRange:i.getPlacementRange(w.boxes,G,l),F=!q||s["icon-allow-overlap"]?fullRange:i.getPlacementRange(M.boxes,q,c),I=[Math.min(F[0],B[0]),Math.max(F[1],B[1])];u||x?x?u||(F=I):B=I:F=B=I,G&&(s["text-ignore-placement"]||i.insert(w.boxes,k,G,B,l),P&&this.addSymbols(this.buffers.glyphVertex,this.elementGroups.text,w.shapes,G,B)),q&&(s["icon-ignore-placement"]||i.insert(M.boxes,k,q,F,c),P&&this.addSymbols(this.buffers.iconVertex,this.elementGroups.icon,M.shapes,q,F))}}}}},SymbolBucket.prototype.addSymbols=function(e,t,o,n,s){var i=this.collision.zoom;t.makeRoomFor(0);for(var a=t.current,r=Math.log(n)/Math.LN2+i,l=0;l<o.length;l++){var c=o[l],h=c.tl,m=c.tr,p=c.bl,u=c.br,x=c.tex,y=c.angle,g=c.anchor,d=Math.max(i+Math.log(c.minScale)/Math.LN2,r),f=Math.min(i+Math.log(c.maxScale)/Math.LN2,25);d>=f||(d===r&&(d=0),e.add(g.x,g.y,h.x,h.y,x.x,x.y,y,d,s,f,r),e.add(g.x,g.y,m.x,m.y,x.x+x.w,x.y,y,d,s,f,r),e.add(g.x,g.y,p.x,p.y,x.x,x.y+x.h,y,d,s,f,r),e.add(g.x,g.y,m.x,m.y,x.x+x.w,x.y,y,d,s,f,r),e.add(g.x,g.y,p.x,p.y,x.x,x.y+x.h,y,d,s,f,r),e.add(g.x,g.y,u.x,u.y,x.x+x.w,x.y+x.h,y,d,s,f,r),a.vertexLength+=6)}},SymbolBucket.prototype.getDependencies=function(e,t,o){function n(e){(e||i)&&o(e),i=!0,s=e}var s,i=!1;this.getTextDependencies(e,t,n),this.getIconDependencies(e,t,n)},SymbolBucket.prototype.getIconDependencies=function(e,t,o){var n=this;if(this.layoutProperties["icon-image"]){var s=this.features,i=this.layoutProperties,a=resolveIcons(s,i);a.length?t.send("get icons",{id:e.id,icons:a},function(e,t){return e?o(e):(n.icons=t,void o())}):o()}else o()},SymbolBucket.prototype.getTextDependencies=function(e,t,o){var n=this.features,s=this.layoutProperties;void 0===e.stacks&&(e.stacks={});var i=this.stacks=e.stacks,a=s["text-font"];void 0===i[a]&&(i[a]={glyphs:{},rects:{}});var r=i[a],l=resolveText(n,s,r.glyphs);this.textFeatures=l.textFeatures,t.send("get glyphs",{id:e.id,fontstack:a,codepoints:l.codepoints},function(e,t){if(e)return o(e);var n=t.glyphs,s=t.rects,i=r.glyphs,a=r.rects;for(var l in n)i[l]=n[l],a[l]=s[l];o()})},SymbolBucket.prototype.hasData=function(){return!!this.elementGroups.text.current||!!this.elementGroups.icon.current};
},{"../symbol/anchor":54,"../symbol/interpolate":59,"../symbol/placement":60,"../symbol/resolve_icons":61,"../symbol/resolve_text":62,"../symbol/shaping":64,"../util/token":85,"./element_groups":11,"point-geometry":99}],17:[function(require,module,exports){
"use strict";function LatLng(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LatLng object: ("+t+", "+n+")");this.lat=+t,this.lng=+n}module.exports=LatLng;var wrap=require("../util/util").wrap;LatLng.prototype.wrap=function(){return new LatLng(this.lat,wrap(this.lng,-180,180))},LatLng.convert=function(t){return t instanceof LatLng?t:Array.isArray(t)?new LatLng(t[0],t[1]):t};
},{"../util/util":86}],18:[function(require,module,exports){
"use strict";function LatLngBounds(t,n){if(t)for(var e=n?[t,n]:t,s=0,i=e.length;i>s;s++)this.extend(e[s])}module.exports=LatLngBounds;var LatLng=require("./lat_lng");LatLngBounds.prototype={extend:function(t){var n,e,s=this._sw,i=this._ne;if(t instanceof LatLng)n=t,e=t;else{if(!(t instanceof LatLngBounds))return t?this.extend(LatLng.convert(t)||LatLngBounds.convert(t)):this;if(n=t._sw,e=t._ne,!n||!e)return this}return s||i?(s.lat=Math.min(n.lat,s.lat),s.lng=Math.min(n.lng,s.lng),i.lat=Math.max(e.lat,i.lat),i.lng=Math.max(e.lng,i.lng)):(this._sw=new LatLng(n.lat,n.lng),this._ne=new LatLng(e.lat,e.lng)),this},getCenter:function(){return new LatLng((this._sw.lat+this._ne.lat)/2,(this._sw.lng+this._ne.lng)/2)},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getNorthWest:function(){return new LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._sw.lng},getSouth:function(){return this._sw.lat},getEast:function(){return this._ne.lng},getNorth:function(){return this._ne.lat}},LatLngBounds.convert=function(t){return!t||t instanceof LatLngBounds?t:new LatLngBounds(t)};
},{"./lat_lng":17}],19:[function(require,module,exports){
"use strict";function Transform(t,i){this.tileSize=512,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this.zoom=0,this.center=new LatLng(0,0),this.angle=0}var LatLng=require("./lat_lng"),Point=require("point-geometry"),wrap=require("../util/util").wrap;module.exports=Transform,Transform.prototype={get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t,this.zoom=Math.max(this.zoom,t)},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t,this.zoom=Math.min(this.zoom,t)},get worldSize(){return this.tileSize*this.scale},get centerPoint(){return this.size._div(2)},get size(){return new Point(this.width,this.height)},get bearing(){return-this.angle/Math.PI*180},set bearing(t){this.angle=-wrap(t,-180,180)*Math.PI/180},get zoom(){return this._zoom},set zoom(t){t=Math.min(Math.max(t,this.minZoom),this.maxZoom),this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain()},zoomScale:function(t){return Math.pow(2,t)},scaleZoom:function(t){return Math.log(t)/Math.LN2},project:function(t,i){return new Point(this.lngX(t.lng,i),this.latY(t.lat,i))},unproject:function(t,i){return new LatLng(this.yLat(t.y,i),this.xLng(t.x,i))},get x(){return this.lngX(this.center.lng)},get y(){return this.latY(this.center.lat)},get point(){return new Point(this.x,this.y)},lngX:function(t,i){return(180+t)*(i||this.worldSize)/360},latY:function(t,i){var n=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360));return(180-n)*(i||this.worldSize)/360},xLng:function(t,i){return 360*t/(i||this.worldSize)-180},yLat:function(t,i){var n=180-360*t/(i||this.worldSize);return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90},panBy:function(t){var i=this.centerPoint._add(t);this.center=this.pointLocation(i),this._constrain()},setZoomAround:function(t,i){var n=this.locationPoint(i),o=this.size._sub(n),e=this.pointLocation(o);this.zoom=t,i&&this.panBy(n.sub(this.locationPoint(e)))},setBearingAround:function(t,i){var n=this.locationPoint(i).sub(this.centerPoint);this.panBy(n),this.bearing=t,i&&this.panBy(n.mult(-1))},locationPoint:function(t){var i=this.project(t);return this.centerPoint._sub(this.point._sub(i)._rotate(this.angle))},pointLocation:function(t){var i=this.centerPoint._sub(t)._rotate(-this.angle);return this.unproject(this.point.sub(i))},locationCoordinate:function(t){var i=this.zoomScale(this.tileZoom)/this.worldSize;return{column:this.lngX(t.lng)*i,row:this.latY(t.lat)*i,zoom:this.tileZoom}},pointCoordinate:function(t,i){var n=this.zoomScale(this.zoomFraction),o=this.zoomScale(this.tileZoom-t.zoom),e=this.centerPoint._sub(i)._rotate(-this.angle)._div(this.tileSize*n);return{column:t.column*o-e.x,row:t.row*o-e.y,zoom:this.tileZoom}},_constrain:function(){if(this.center){var t,i,n,o,e,s,h,r,a=this.size;this.latRange&&(t=this.latY(this.latRange[1]),i=this.latY(this.latRange[0]),e=i-t<a.y?a.y/(i-t):0),this.lngRange&&(n=this.lngX(this.lngRange[0]),o=this.lngX(this.lngRange[1]),s=o-n<a.x?a.x/(o-n):0);var c=Math.max(s||0,e||0);if(c)return this.center=this.unproject(new Point(s?(o+n)/2:this.x,e?(i+t)/2:this.y)),void(this.zoom+=this.scaleZoom(c));if(this.latRange){var u=this.y,l=a.y/2;t>u-l&&(r=t+l),u+l>i&&(r=i-l)}if(this.lngRange){var m=this.x,g=a.x/2;n>m-g&&(h=n+g),m+g>o&&(h=o-g)}(void 0!==h||void 0!==r)&&(this.center=this.unproject(new Point(void 0!==h?h:this.x,void 0!==r?r:this.y)))}}};
},{"../util/util":86,"./lat_lng":17,"point-geometry":99}],20:[function(require,module,exports){
"use strict";var simplex_font={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};module.exports=function(l,n,t,e){e=e||1;var r,o,u,f,s,i,x,p,h=[];for(r=0,o=l.length;o>r;r++)if(s=simplex_font[l[r]]){for(p=null,u=0,f=s[1].length;f>u;u+=2)-1===s[1][u]&&-1===s[1][u+1]?p=null:(i=n+s[1][u]*e,x=t-s[1][u+1]*e,p&&h.push(p.x,p.y,i,x),p={x:i,y:x});n+=s[0]*e}return h};
},{}],21:[function(require,module,exports){
"use strict";if("undefined"==typeof window)new(require("./source/worker"))(self);else{var mapboxgl=module.exports=window.mapboxgl={};mapboxgl.Map=require("./ui/map"),mapboxgl.Navigation=require("./ui/control/navigation"),mapboxgl.Attribution=require("./ui/control/attribution"),mapboxgl.Source=require("./source/source"),mapboxgl.GeoJSONSource=require("./source/geojson_source"),mapboxgl.VideoSource=require("./source/video_source"),mapboxgl.Style=require("./style/style"),mapboxgl.LatLng=require("./geo/lat_lng"),mapboxgl.LatLngBounds=require("./geo/lat_lng_bounds"),mapboxgl.Point=require("point-geometry"),mapboxgl.Evented=require("./util/evented"),mapboxgl.util=require("./util/util");var browser=require("./util/browser");mapboxgl.util.supported=browser.supported;var ajax=require("./util/ajax");mapboxgl.util.getJSON=ajax.getJSON,mapboxgl.util.getArrayBuffer=ajax.getArrayBuffer;var config=require("./util/config");mapboxgl.config=config,Object.defineProperty(mapboxgl,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(e){config.ACCESS_TOKEN=e}})}
},{"./geo/lat_lng":17,"./geo/lat_lng_bounds":18,"./source/geojson_source":34,"./source/source":37,"./source/video_source":42,"./source/worker":43,"./style/style":50,"./ui/control/attribution":66,"./ui/control/navigation":68,"./ui/map":73,"./util/ajax":75,"./util/browser":76,"./util/config":79,"./util/evented":81,"./util/util":86,"point-geometry":99}],22:[function(require,module,exports){
"use strict";function drawBackground(r,t,a,e,i,o){var n,u=e["background-color"],c=e["background-image"],m=e["background-opacity"],f=c?t.spriteAtlas.getPosition(c,!0):null;if(f){n=t.patternShader,r.switchShader(n,i),r.uniform1i(n.u_image,0),r.uniform2fv(n.u_pattern_tl,f.tl),r.uniform2fv(n.u_pattern_br,f.br),r.uniform1f(n.u_mix,t.transform.zoomFraction),r.uniform1f(n.u_opacity,m);var l=t.transform,d=f.size,s=l.locationCoordinate(l.center),g=1/Math.pow(2,l.zoomFraction),_=mat3.create();mat3.scale(_,_,[1/d[0],1/d[1]]),mat3.translate(_,_,[s.column*l.tileSize%d[0],s.row*l.tileSize%d[1]]),mat3.rotate(_,_,-l.angle),mat3.scale(_,_,[g*l.width/2,-g*l.height/2]),r.uniformMatrix3fv(n.u_patternmatrix,!1,_),t.spriteAtlas.bind(r,!0)}else n=t.fillShader,r.switchShader(n,o.padded||i),r.uniform4fv(n.u_color,u);r.disable(r.STENCIL_TEST),r.bindBuffer(r.ARRAY_BUFFER,t.backgroundBuffer),r.vertexAttribPointer(n.a_pos,t.backgroundBuffer.itemSize,r.SHORT,!1,0,0),r.drawArrays(r.TRIANGLE_STRIP,0,t.backgroundBuffer.itemCount),r.enable(r.STENCIL_TEST),r.stencilMask(0),r.stencilFunc(r.EQUAL,128,128)}var mat3=require("gl-matrix").mat3;module.exports=drawBackground;
},{"gl-matrix":94}],23:[function(require,module,exports){
"use strict";function drawDebug(e,r,i){var t=TileCoord.fromID(i.id);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.switchShader(r.debugShader,i.posMatrix),e.bindBuffer(e.ARRAY_BUFFER,r.debugBuffer),e.vertexAttribPointer(r.debugShader.a_pos,r.debugBuffer.itemSize,e.SHORT,!1,0,0),e.uniform4f(r.debugShader.u_color,1,0,0,1),e.lineWidth(4),e.drawArrays(e.LINE_STRIP,0,r.debugBuffer.itemCount);var u=t.z+"/"+t.x+"/"+t.y,d=textVertices(u,50,200,5);e.bindBuffer(e.ARRAY_BUFFER,r.debugTextBuffer),e.bufferData(e.ARRAY_BUFFER,new Int16Array(d),e.STREAM_DRAW),e.vertexAttribPointer(r.debugShader.a_pos,r.debugTextBuffer.itemSize,e.SHORT,!1,0,0),e.lineWidth(8*browser.devicePixelRatio),e.uniform4f(r.debugShader.u_color,1,1,1,1),e.drawArrays(e.LINES,0,d.length/r.debugTextBuffer.itemSize),e.lineWidth(2*browser.devicePixelRatio),e.uniform4f(r.debugShader.u_color,0,0,0,1),e.drawArrays(e.LINES,0,d.length/r.debugTextBuffer.itemSize),e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.ONE)}var textVertices=require("../lib/debugtext"),browser=require("../util/browser"),TileCoord=require("../source/tile_coord");module.exports=drawDebug;
},{"../lib/debugtext":20,"../source/tile_coord":39,"../util/browser":76}],24:[function(require,module,exports){
"use strict";function drawFill(e,t,r,i,l,n,a){var o,s,f,u,m=t.translateMatrix(n,l.zoom,i["fill-translate"],i["fill-translate-anchor"]),c=i["fill-color"];e.stencilMask(63),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.NOTEQUAL,128,128),e.stencilOpSeparate(e.FRONT,e.INCR_WRAP,e.KEEP,e.KEEP),e.stencilOpSeparate(e.BACK,e.DECR_WRAP,e.KEEP,e.KEEP),e.colorMask(!1,!1,!1,!1),e.switchShader(t.fillShader,m),o=r.buffers.fillVertex,o.bind(e),s=r.buffers.fillElement,s.bind(e);for(var d,E,S=0;S<r.elementGroups.groups.length;S++)f=r.elementGroups.groups[S],d=f.vertexStartIndex*o.itemSize,e.vertexAttribPointer(t.fillShader.a_pos,2,e.SHORT,!1,4,d+0),u=3*f.elementLength,E=f.elementStartIndex*s.itemSize,e.drawElements(e.TRIANGLES,u,e.UNSIGNED_SHORT,E);e.colorMask(!0,!0,!0,!0),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(0);var p=i["fill-outline-color"];if(i["fill-antialias"]===!0&&(!i["fill-image"]||p)){e.switchShader(t.outlineShader,m),e.lineWidth(2*browser.devicePixelRatio),p?e.stencilFunc(e.EQUAL,128,128):e.stencilFunc(e.EQUAL,128,191),e.uniform2f(t.outlineShader.u_world,e.drawingBufferWidth,e.drawingBufferHeight),e.uniform4fv(t.outlineShader.u_color,p?p:c),o=r.buffers.fillVertex,s=r.buffers.outlineElement,s.bind(e);for(var h=0;h<r.elementGroups.groups.length;h++)f=r.elementGroups.groups[h],d=f.vertexStartIndex*o.itemSize,e.vertexAttribPointer(t.outlineShader.a_pos,2,e.SHORT,!1,4,d+0),u=2*f.secondElementLength,E=f.secondElementStartIndex*s.itemSize,e.drawElements(e.LINES,u,e.UNSIGNED_SHORT,E)}var _,x=i["fill-image"],v=i["fill-opacity"]||1;if(x){var A=t.spriteAtlas.getPosition(x,!0);if(!A)return;_=t.patternShader,e.switchShader(_,n),e.uniform1i(_.u_image,0),e.uniform2fv(_.u_pattern_tl,A.tl),e.uniform2fv(_.u_pattern_br,A.br),e.uniform1f(_.u_mix,t.transform.zoomFraction),e.uniform1f(_.u_opacity,v);var R=8/Math.pow(2,t.transform.tileZoom-l.zoom),b=mat3.create();mat3.scale(b,b,[1/(A.size[0]*R),1/(A.size[1]*R)]),e.uniformMatrix3fv(_.u_patternmatrix,!1,b),t.spriteAtlas.bind(e,!0)}else _=t.fillShader,e.switchShader(_,a.padded||n),e.uniform4fv(_.u_color,c);e.stencilFunc(e.NOTEQUAL,0,63),e.bindBuffer(e.ARRAY_BUFFER,t.tileExtentBuffer),e.vertexAttribPointer(_.a_pos,t.tileExtentBuffer.itemSize,e.SHORT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,t.tileExtentBuffer.itemCount),e.stencilMask(0),e.stencilFunc(e.EQUAL,128,128)}var browser=require("../util/browser"),mat3=require("gl-matrix").mat3;module.exports=drawFill;
},{"../util/browser":76,"gl-matrix":94}],25:[function(require,module,exports){
"use strict";var browser=require("../util/browser");module.exports=function(e,r,i,t,n,a){if(!(t["line-width"]<=0)){var o=1/browser.devicePixelRatio,l=t["line-blur"]+o,f=t["line-width"]/2,u=-1,s=0,m=0;t["line-gap-width"]>0&&(u=t["line-gap-width"]/2+.5*o,f=t["line-width"],s=u-o/2);var d,v=s+f+o/2+m,h=t["line-color"],_=r.transform.scale/(1<<n.zoom)/8,b=r.translateMatrix(a,n.zoom,t["line-translate"],t["line-translate-anchor"]),w=t["line-image"],p=w&&r.spriteAtlas.getPosition(w,!0);if(p){var x=8/Math.pow(2,r.transform.tileZoom-n.zoom);r.spriteAtlas.bind(e,!0),d=r.linepatternShader,e.switchShader(d,b,n.exMatrix),e.uniform2fv(d.u_linewidth,[v,u]),e.uniform1f(d.u_ratio,_),e.uniform1f(d.u_blur,l),e.uniform2fv(d.u_pattern_size,[p.size[0]*x,p.size[1]]),e.uniform2fv(d.u_pattern_tl,p.tl),e.uniform2fv(d.u_pattern_br,p.br),e.uniform1f(d.u_fade,r.transform.zoomFraction)}else d=r.lineShader,e.switchShader(d,b,n.exMatrix),e.uniform2fv(d.u_linewidth,[v,u]),e.uniform1f(d.u_ratio,_),e.uniform1f(d.u_blur,l),e.uniform4fv(d.u_color,h),e.uniform2fv(d.u_dasharray,t["line-dasharray"]);var S=i.buffers.lineVertex;S.bind(e);var c=i.buffers.lineElement;c.bind(e);for(var z=i.elementGroups.groups,g=0;g<z.length;g++){var A=z[g],E=A.vertexStartIndex*S.itemSize;e.vertexAttribPointer(d.a_pos,2,e.SHORT,!1,8,E+0),e.vertexAttribPointer(d.a_data,4,e.BYTE,!1,8,E+4);var I=3*A.elementLength,M=A.elementStartIndex*c.itemSize;e.drawElements(e.TRIANGLES,I,e.UNSIGNED_SHORT,M)}}};
},{"../util/browser":76}],26:[function(require,module,exports){
"use strict";function drawRaster(e,r,t,a,i,o,d,n,u){var s;if(u&&u.layers){if(!t.prerendered){t.prerendered=new PrerenderedTexture(e,t.layoutProperties,r),t.prerendered.bindFramebuffer(),e.clearStencil(128),e.stencilMask(255),e.clear(e.STENCIL_BUFFER_BIT|e.COLOR_BUFFER_BIT),e.stencilMask(0),e.viewport(0,0,t.prerendered.size,t.prerendered.size);var f=4096*t.prerendered.buffer,c=mat4.create();mat4.ortho(c,-f,4096+f,-4096-f,f,0,1),mat4.translate(c,c,[0,-4096,0]),d.padded=mat4.create(),mat4.ortho(d.padded,0,4096,-4096,0,0,1),mat4.translate(d.padded,d.padded,[0,-4096,0]),r.drawLayers(i,n,u.layers,d,c),delete d.padded,t.layoutProperties["raster-blur"]>0&&t.prerendered.blur(r,t.layoutProperties["raster-blur"]),t.prerendered.unbindFramebuffer(),e.viewport(0,0,r.width,r.height)}s=t.prerendered}else s=i;e.disable(e.STENCIL_TEST);var l=r.rasterShader;e.switchShader(l,o),e.uniform1f(l.u_brightness_low,a["raster-brightness"][0]),e.uniform1f(l.u_brightness_high,a["raster-brightness"][1]),e.uniform1f(l.u_saturation_factor,saturationFactor(a["raster-saturation"])),e.uniform1f(l.u_contrast_factor,contrastFactor(a["raster-contrast"])),e.uniform3fv(l.u_spin_weights,spinWeights(a["raster-hue-rotate"]));var p,m;u&&u.layers?(p=null,m=[a["raster-opacity"],0]):(p=s.source&&s.source._pyramid.findLoadedParent(s.id,0,{}),m=getOpacities(s,p,a,r.transform));var _,T;if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s.texture),p){e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,p.texture);var h=TileCoord.fromID(s.id),b=p&&TileCoord.fromID(p.id);_=Math.pow(2,b.z-h.z),T=[h.x*_%1,h.y*_%1]}else m[1]=0;var v=t.prerendered?4096*(1+2*t.prerendered.buffer)/4096:1;e.uniform2fv(l.u_tl_parent,T||[0,0]),e.uniform1f(l.u_scale_parent,_||1),e.uniform1f(l.u_buffer_scale,v),e.uniform1f(l.u_opacity0,m[0]),e.uniform1f(l.u_opacity1,m[1]),e.uniform1i(l.u_image0,0),e.uniform1i(l.u_image1,1),e.bindBuffer(e.ARRAY_BUFFER,s.boundsBuffer||r.tileExtentBuffer),e.vertexAttribPointer(l.a_pos,2,e.SHORT,!1,8,0),e.vertexAttribPointer(l.a_texture_pos,2,e.SHORT,!1,8,4),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.STENCIL_TEST)}function spinWeights(e){e*=Math.PI/180;var r=Math.sin(e),t=Math.cos(e);return[(2*t+1)/3,(-Math.sqrt(3)*r-t+1)/3,(Math.sqrt(3)*r-t+1)/3]}function contrastFactor(e){return e>0?1/(1-e):1+e}function saturationFactor(e){return e>0?1-1/(1.001-e):-e}function getOpacities(e,r,t,a){if(!e.source)return[1,0];var i=(new Date).getTime(),o=t["raster-fade-duration"],d=(i-e.timeAdded)/o,n=r?(i-r.timeAdded)/o:-1,u=TileCoord.fromID(e.id),s=r&&TileCoord.fromID(r.id),f=e.source._pyramid.coveringZoomLevel(a),c=r?Math.abs(s.z-f)>Math.abs(u.z-f):!1,l=[];!r||c?(l[0]=util.clamp(d,0,1),l[1]=1-l[0]):(l[0]=util.clamp(1-n,0,1),l[1]=1-l[0]);var p=t["raster-opacity"];return l[0]*=p,l[1]*=p,l}var TileCoord=require("../source/tile_coord"),PrerenderedTexture=require("./prerendered"),mat4=require("gl-matrix").mat4,util=require("../util/util");module.exports=drawRaster;
},{"../source/tile_coord":39,"../util/util":86,"./prerendered":32,"gl-matrix":94}],27:[function(require,module,exports){
"use strict";function drawSymbols(r,e,o,t,a,i){r.disable(r.STENCIL_TEST),o.elementGroups.text.groups.length&&drawSymbol(r,e,o,t,a,i,"text"),o.elementGroups.icon.groups.length&&drawSymbol(r,e,o,t,a,i,"icon"),r.enable(r.STENCIL_TEST)}function drawSymbol(r,e,o,t,a,i,u){i=e.translateMatrix(i,a.zoom,t[u+"-translate"],t[u+"-translate-anchor"]);var f=o.layoutProperties,n=mat4.clone(e.projectionMatrix),m="map"===f[u+"-rotation-alignment"],s=m?e.transform.angle:0;s&&mat4.rotateZ(n,n,s);var l=t[u+"-size"]||f[u+"-max-size"],d=l/defaultSizes[u];mat4.scale(n,n,[d,d,1]);var p,h,g,c="text"===u,x=c||o.elementGroups.sdfIcons;if(c||e.style.sprite.loaded()){r.activeTexture(r.TEXTURE0),p=x?e.sdfShader:e.iconShader,c?(e.glyphAtlas.updateTexture(r),h=o.buffers.glyphVertex,g=[e.glyphAtlas.width/4,e.glyphAtlas.height/4]):(e.spriteAtlas.bind(r,m||e.options.rotating||e.options.zooming||1!=d||x),h=o.buffers.iconVertex,g=[e.spriteAtlas.width/4,e.spriteAtlas.height/4]),r.switchShader(p,i,n),r.uniform1i(p.u_texture,0),r.uniform2fv(p.u_texsize,g),h.bind(r,p);var S=Math.round(e.transform.angle/Math.PI*128),b=Math.log(l/f[u+"-max-size"])/Math.LN2||0,_=m&&f[u+"-keep-upright"];r.uniform1f(p.u_flip,_?1:0),r.uniform1f(p.u_angle,(S+256)%256),r.uniform1f(p.u_zoom,10*(e.transform.zoom-b));var y=e.frameHistory.getFadeProperties(300);r.uniform1f(p.u_fadedist,10*y.fadedist),r.uniform1f(p.u_minfadezoom,Math.floor(10*y.minfadezoom)),r.uniform1f(p.u_maxfadezoom,Math.floor(10*y.maxfadezoom)),r.uniform1f(p.u_fadezoom,10*(e.transform.zoom+y.bump));var z=o.elementGroups[u].groups[0].vertexStartIndex,v=o.elementGroups[u].groups[0].vertexLength;if(x){var w=8,T=1.19,A=6,E=.105*defaultSizes[u]/l/browser.devicePixelRatio;r.uniform1f(p.u_gamma,E),r.uniform4fv(p.u_color,t[u+"-color"]),r.uniform1f(p.u_buffer,.75),r.drawArrays(r.TRIANGLES,z,v),t[u+"-halo-color"]&&(r.uniform1f(p.u_gamma,t[u+"-halo-blur"]*T/d/w+E),r.uniform4fv(p.u_color,t[u+"-halo-color"]),r.uniform1f(p.u_buffer,(A-t[u+"-halo-width"]/d)/w),r.drawArrays(r.TRIANGLES,z,v))}else r.uniform1f(p.u_opacity,t["icon-opacity"]),r.drawArrays(r.TRIANGLES,z,v)}}var browser=require("../util/browser"),mat4=require("gl-matrix").mat4;module.exports=drawSymbols;var defaultSizes={icon:1,text:24};
},{"../util/browser":76,"gl-matrix":94}],28:[function(require,module,exports){
"use strict";function drawVertices(r,e,t,o){r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.switchShader(e.dotShader,o.posMatrix),r.uniform1f(e.dotShader.u_size,4*browser.devicePixelRatio),r.uniform1f(e.dotShader.u_blur,.25),r.uniform4fv(e.dotShader.u_color,[.25,0,0,.25]);var a,i,d,s,n;if(t.layoutProperties.fill){a=t.buffers.fillVertex,a.bind(r),i=t.elementGroups.groups;for(var u=0;u<i.length;u++)d=i[u],s=d.vertexStartIndex,n=d.vertexLength,r.vertexAttribPointer(e.dotShader.a_pos,2,r.SHORT,!1,0,0),r.drawArrays(r.POINTS,s,n)}var l=mat4.clone(o.posMatrix);if(mat4.scale(l,l,[.5,.5,1]),r.switchShader(e.dotShader,l),t.layoutProperties.line){a=t.buffers.lineVertex,a.bind(r),i=t.elementGroups.groups;for(var S=0;S<i.length;S++)d=i[S],s=d.vertexStartIndex,n=d.vertexLength,r.vertexAttribPointer(e.dotShader.a_pos,2,r.SHORT,!1,0,0),r.drawArrays(r.POINTS,s,n)}r.blendFunc(r.ONE_MINUS_DST_ALPHA,r.ONE)}var browser=require("../util/browser"),mat4=require("gl-matrix").mat4;module.exports=drawVertices;
},{"../util/browser":76,"gl-matrix":94}],29:[function(require,module,exports){
"use strict";function FrameHistory(){this.frameHistory=[]}module.exports=FrameHistory,FrameHistory.prototype.getFadeProperties=function(t){void 0===t&&(t=300);for(var e=(new Date).getTime();this.frameHistory.length>3&&this.frameHistory[1].time+t<e;)this.frameHistory.shift();this.frameHistory[1].time+t<e&&(this.frameHistory[0].z=this.frameHistory[1].z);var r=this.frameHistory.length;3>r&&console.warn("there should never be less than three frames in the history");var i=this.frameHistory[0].z,s=this.frameHistory[r-1],o=s.z,a=Math.min(i,o),m=Math.max(i,o),h=s.z-this.frameHistory[1].z,f=s.time-this.frameHistory[1].time,y=h/(f/t);isNaN(y)&&console.warn("fadedist should never be NaN");var n=(e-s.time)/t*y;return{fadedist:y,minfadezoom:a,maxfadezoom:m,bump:n}},FrameHistory.prototype.record=function(t){var e=(new Date).getTime();this.frameHistory.length||this.frameHistory.push({time:0,z:t},{time:0,z:t}),(2===this.frameHistory.length||this.frameHistory[this.frameHistory.length-1].z!==t)&&this.frameHistory.push({time:e,z:t})};
},{}],30:[function(require,module,exports){
"use strict";var shaders=require("./shaders"),util=require("../util/util");exports.extend=function(r){var t=r.lineWidth,e=r.getParameter(r.ALIASED_LINE_WIDTH_RANGE);return r.lineWidth=function(a){t.call(r,util.clamp(a,e[0],e[1]))},r.getShader=function(r,t){var e=t==this.FRAGMENT_SHADER?"fragment":"vertex";if(!shaders[r]||!shaders[r][e])throw new Error("Could not find shader "+r);var a=this.createShader(t);if(this.shaderSource(a,shaders[r][e]),this.compileShader(a),!this.getShaderParameter(a,this.COMPILE_STATUS))throw new Error(this.getShaderInfoLog(a));return a},r.initializeShader=function(r,t,e){var a={program:this.createProgram(),fragment:this.getShader(r,this.FRAGMENT_SHADER),vertex:this.getShader(r,this.VERTEX_SHADER),attributes:[]};if(this.attachShader(a.program,a.vertex),this.attachShader(a.program,a.fragment),this.linkProgram(a.program),this.getProgramParameter(a.program,this.LINK_STATUS)){for(var i=0;i<t.length;i++)a[t[i]]=this.getAttribLocation(a.program,t[i]),a.attributes.push(a[t[i]]);for(var h=0;h<e.length;h++)a[e[h]]=this.getUniformLocation(a.program,e[h])}else console.error(this.getProgramInfoLog(a.program));return a},r.switchShader=function(r,t,e){if(t||console.trace("posMatrix does not have required argument"),this.currentShader!==r){this.useProgram(r.program);for(var a=this.currentShader?this.currentShader.attributes:[],i=r.attributes,h=0;h<a.length;h++)i.indexOf(a[h])<0&&this.disableVertexAttribArray(a[h]);for(var s=0;s<i.length;s++)a.indexOf(i[s])<0&&this.enableVertexAttribArray(i[s]);this.currentShader=r}r.posMatrix!==t&&(this.uniformMatrix4fv(r.u_matrix,!1,t),r.posMatrix=t),e&&r.exMatrix!==e&&r.u_exmatrix&&(this.uniformMatrix4fv(r.u_exmatrix,!1,e),r.exMatrix=e)},r};
},{"../util/util":86,"./shaders":33}],31:[function(require,module,exports){
"use strict";function GLPainter(t,e){this.gl=glutil.extend(t),this.transform=e,this.reusableTextures={},this.preFbos={},this.tileExtent=4096,this.frameHistory=new FrameHistory,this.setup()}var glutil=require("./gl_util"),browser=require("../util/browser"),mat4=require("gl-matrix").mat4,FrameHistory=require("./frame_history"),drawSymbol=require("./draw_symbol"),drawLine=require("./draw_line"),drawFill=require("./draw_fill"),drawRaster=require("./draw_raster"),drawDebug=require("./draw_debug"),drawBackground=require("./draw_background"),drawVertices=require("./draw_vertices");module.exports=GLPainter,GLPainter.prototype.resize=function(t,e){var r=this.gl;this.projectionMatrix=mat4.create(),mat4.ortho(this.projectionMatrix,0,t,e,0,0,-1),this.width=t*browser.devicePixelRatio,this.height=e*browser.devicePixelRatio,r.viewport(0,0,this.width,this.height)},GLPainter.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE),t.enable(t.STENCIL_TEST),this.debugShader=t.initializeShader("debug",["a_pos"],["u_matrix","u_pointsize","u_color"]),this.gaussianShader=t.initializeShader("gaussian",["a_pos"],["u_matrix","u_image","u_offset"]),this.rasterShader=t.initializeShader("raster",["a_pos","a_texture_pos"],["u_matrix","u_brightness_low","u_brightness_high","u_saturation_factor","u_spin_weights","u_contrast_factor","u_opacity0","u_opacity1","u_image0","u_image1","u_tl_parent","u_scale_parent","u_buffer_scale"]),this.lineShader=t.initializeShader("line",["a_pos","a_data"],["u_matrix","u_exmatrix","u_linewidth","u_color","u_ratio","u_dasharray","u_blur"]),this.linepatternShader=t.initializeShader("linepattern",["a_pos","a_data"],["u_matrix","u_exmatrix","u_linewidth","u_ratio","u_pattern_size","u_pattern_tl","u_pattern_br","u_point","u_blur","u_fade"]),this.dotShader=t.initializeShader("dot",["a_pos"],["u_matrix","u_size","u_color","u_blur"]),this.sdfShader=t.initializeShader("sdf",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_color","u_gamma","u_buffer","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom"]),this.iconShader=t.initializeShader("icon",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_opacity"]),this.outlineShader=t.initializeShader("outline",["a_pos"],["u_matrix","u_color","u_world"]),this.patternShader=t.initializeShader("pattern",["a_pos"],["u_matrix","u_pattern_tl","u_pattern_br","u_mix","u_patternmatrix","u_opacity","u_image"]),this.fillShader=t.initializeShader("fill",["a_pos"],["u_matrix","u_color"]),this.identityMatrix=mat4.create(),this.backgroundBuffer=t.createBuffer(),this.backgroundBuffer.itemSize=2,this.backgroundBuffer.itemCount=4,t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),this.tileExtentBuffer=t.createBuffer(),this.tileExtentBuffer.itemSize=4,this.tileExtentBuffer.itemCount=4,t.bindBuffer(t.ARRAY_BUFFER,this.tileExtentBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([0,0,0,0,this.tileExtent,0,32767,0,0,this.tileExtent,0,32767,this.tileExtent,this.tileExtent,32767,32767]),t.STATIC_DRAW),this.debugBuffer=t.createBuffer(),this.debugBuffer.itemSize=2,this.debugBuffer.itemCount=5,t.bindBuffer(t.ARRAY_BUFFER,this.debugBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([0,0,4095,0,4095,4095,0,4095,0,0]),t.STATIC_DRAW),this.debugTextBuffer=t.createBuffer(),this.debugTextBuffer.itemSize=2},GLPainter.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},GLPainter.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},GLPainter.prototype.drawClippingMask=function(t){var e=this.gl;e.switchShader(this.fillShader,t.posMatrix),e.colorMask(!1,!1,!1,!1),e.clearStencil(0),e.stencilMask(191),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.EQUAL,192,64),e.stencilMask(192),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.bindBuffer(e.ARRAY_BUFFER,this.tileExtentBuffer),e.vertexAttribPointer(this.fillShader.a_pos,this.tileExtentBuffer.itemSize,e.SHORT,!1,8,0),e.drawArrays(e.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),e.stencilFunc(e.EQUAL,128,128),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilMask(0),e.colorMask(!0,!0,!0,!0)},GLPainter.prototype.prepareBuffers=function(){},GLPainter.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},GLPainter.prototype.render=function(t,e){this.style=t,this.options=e,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphAtlas=t.glyphAtlas,this.glyphAtlas.bind(this.gl),this.frameHistory.record(this.transform.zoom),this.prepareBuffers();var r,i,a,s,u=t.layerGroups;for(r=0,i=u.length;i>r;r++)a=u[r],s=t.sources[a.source],s?(this.clearStencil(),s.render(a,this)):void 0===a.source&&this.drawLayers(void 0,t,a,{background:!0})},GLPainter.prototype.drawTile=function(t,e,r){this.drawClippingMask(t),this.drawLayers(t,e,r,{}),this.options.debug&&drawDebug(this.gl,this,t)},GLPainter.prototype.drawLayers=function(t,e,r,i,a){for(var s=0;s<r.length;s++)this.drawLayer(t,e,r[s],i,a,t&&t.buckets)},GLPainter.prototype.drawLayer=function(t,e,r,i,a,s){var u=this.gl,n=e.computed[r.id];if(n&&!n.hidden)if(r.layers&&"raster"===r.type)drawRaster(u,this,s[r.bucket],n,t,a||t.posMatrix,i,e,r);else if(i.background)drawBackground(u,this,void 0,n,this.identityMatrix,i);else{var o=s[r.bucket];if(!o||o.hasData&&!o.hasData())return;var l=o.type;if(o.minZoom&&this.transform.zoom<o.minZoom)return;if(o.maxZoom&&this.transform.zoom>=o.maxZoom)return;var h="symbol"===l?drawSymbol:"fill"===l?drawFill:"line"===l?drawLine:"raster"===l?drawRaster:null;h?h(u,this,o,n,t,a||t.posMatrix,i):console.warn("No bucket type specified"),this.options.vertices&&!r.layers&&drawVertices(u,this,o)}},GLPainter.prototype.drawStencilBuffer=function(){var t=this.gl;t.switchShader(this.fillShader,this.identityMatrix),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.stencilMask(0),t.stencilFunc(t.EQUAL,128,128),t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.vertexAttribPointer(this.fillShader.a_pos,this.backgroundBuffer.itemSize,t.SHORT,!1,0,0),t.uniform4fv(this.fillShader.u_color,[0,0,0,.5]),t.drawArrays(t.TRIANGLE_STRIP,0,this.backgroundBuffer.itemCount),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE)},GLPainter.prototype.translateMatrix=function(t,e,r,i){if(!r[0]&&!r[1])return t;if("viewport"===i){var a=Math.sin(-this.transform.angle),s=Math.cos(-this.transform.angle);r=[r[0]*s-r[1]*a,r[0]*a+r[1]*s]}var u=this.transform.scale/(1<<e)/8,n=[r[0]/u,r[1]/u,0],o=new Float32Array(16);return mat4.translate(o,t,n),o},GLPainter.prototype.saveTexture=function(t){var e=this.reusableTextures[t.size];e?e.push(t):this.reusableTextures[t.size]=[t]},GLPainter.prototype.getTexture=function(t){var e=this.reusableTextures[t];return e&&e.length>0?e.pop():null};
},{"../util/browser":76,"./draw_background":22,"./draw_debug":23,"./draw_fill":24,"./draw_line":25,"./draw_raster":26,"./draw_symbol":27,"./draw_vertices":28,"./frame_history":29,"./gl_util":30,"gl-matrix":94}],32:[function(require,module,exports){
"use strict";function PrerenderedTexture(e,t,r){this.gl=e,this.buffer=t["raster-buffer"]||1/32,this.size=(t["raster-size"]||512)*(1+2*this.buffer),this.painter=r,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.size]}var mat4=require("gl-matrix").mat4;module.exports=PrerenderedTexture,PrerenderedTexture.prototype.bindFramebuffer=function(){var e=this.gl;if(this.texture=this.painter.getTexture(this.size),this.texture?e.bindTexture(e.TEXTURE_2D,this.texture):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.size,this.size,0,e.RGBA,e.UNSIGNED_BYTE,null),this.texture.size=this.size),this.fbos)this.fbo=this.fbos.pop(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);else{this.fbo=e.createFramebuffer();var t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,this.size,this.size),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}},PrerenderedTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):this.painter.preFbos[this.size]=[this.fbo]},PrerenderedTexture.prototype.blur=function(e,t){var r=this.gl,i=this.texture,E=this.painter.getTexture(this.size);E?r.bindTexture(r.TEXTURE_2D,E):(E=r.createTexture(),r.bindTexture(r.TEXTURE_2D,E),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.size,this.size,0,r.RGBA,r.UNSIGNED_BYTE,null),E.size=this.size),r.bindTexture(r.TEXTURE_2D,null);var T=mat4.create();mat4.ortho(T,0,4096,-4096,0,0,1),mat4.translate(T,T,[0,-4096,0]),r.switchShader(e.gaussianShader,T),r.activeTexture(r.TEXTURE0),r.uniform1i(e.gaussianShader.u_image,0);for(var s=0;t>s;s++)r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,E,0),r.clear(r.COLOR_BUFFER_BIT),r.uniform2fv(e.gaussianShader.u_offset,[1/this.size,0]),r.bindTexture(r.TEXTURE_2D,i),r.bindBuffer(r.ARRAY_BUFFER,e.tileExtentBuffer),r.vertexAttribPointer(e.gaussianShader.a_pos,2,r.SHORT,!1,8,0),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),r.clear(r.COLOR_BUFFER_BIT),r.uniform2fv(e.gaussianShader.u_offset,[0,1/this.size]),r.bindTexture(r.TEXTURE_2D,E),r.bindBuffer(r.ARRAY_BUFFER,e.tileExtentBuffer),r.vertexAttribPointer(e.gaussianShader.a_pos,2,r.SHORT,!1,8,0),r.drawArrays(r.TRIANGLE_STRIP,0,4);this.painter.saveTexture(E)};
},{"gl-matrix":94}],33:[function(require,module,exports){
"use strict";var glify=void 0;module.exports={debug:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform float u_pointsize;\nuniform mat4 u_matrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.w = 1.0;\n  tmpvar_1.xy = a_pos;\n  tmpvar_1.z = float((a_pos.x >= 32767.0));\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = u_pointsize;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},dot:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform float u_size;\nattribute vec2 a_pos;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = u_size;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nuniform float u_blur;\nvoid main ()\n{\n  mediump vec2 x_1;\n  x_1 = (gl_PointCoord - 0.5);\n  mediump float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 0.5) / (\n    (0.5 - u_blur)\n   - 0.5)), 0.0, 1.0);\n  gl_FragColor = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n}\n\n"},fill:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = 2.0;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},gaussian:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nuniform vec2 u_offset;\nvarying highp vec2 a[3];\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_matrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  highp vec2 tmpvar_3;\n  tmpvar_3 = ((tmpvar_2.xy / 2.0) + 0.5);\n  a[0] = tmpvar_3;\n  vec2 cse_4;\n  cse_4 = (u_offset * 1.18243);\n  a[1] = (tmpvar_3 + cse_4);\n  a[2] = (tmpvar_3 - cse_4);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 a[3];\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (((texture2D (u_image, a[0]) * 0.40262) + (texture2D (u_image, a[1]) * 0.29869)) + (texture2D (u_image, a[2]) * 0.29869));\n  gl_FragColor = tmpvar_1;\n}\n\n"},line:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_data;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_ratio;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  vec2 e_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  e_1.x = tmpvar_2.x;\n  e_1.y = sign((tmpvar_2.y - 0.5));\n  a = e_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 0.0);\n  tmpvar_3.xy = ((u_linewidth.x * a_data.xy) * 0.015873);\n  vec4 tmpvar_4;\n  tmpvar_4.zw = vec2(0.0, 1.0);\n  tmpvar_4.xy = floor((a_pos * 0.5));\n  gl_Position = ((u_matrix * tmpvar_4) + (u_exmatrix * tmpvar_3));\n  b = (((a_data.z * 128.0) + a_data.w) * u_ratio);\n}\n\n",fragment:"precision mediump float;\nuniform vec2 u_linewidth;\nuniform vec2 u_dasharray;\nuniform vec4 u_color;\nuniform float u_blur;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float tmpvar_1;\n  tmpvar_1 = (sqrt(dot (a, a)) * u_linewidth.x);\n  float tmpvar_2;\n  tmpvar_2 = (float(mod (b, (u_dasharray.x + u_dasharray.y))));\n  gl_FragColor = (u_color * (clamp (\n    (min ((tmpvar_1 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_1)) / u_blur)\n  , 0.0, 1.0) * max (\n    float((-(u_dasharray.y) >= 0.0))\n  , \n    clamp (min (tmpvar_2, (u_dasharray.x - tmpvar_2)), 0.0, 1.0)\n  )));\n}\n\n"},linepattern:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_data;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_point;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  vec2 e_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  e_1.x = tmpvar_2.x;\n  e_1.y = sign((tmpvar_2.y - 0.5));\n  a = e_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 1.0);\n  tmpvar_3.xy = floor((a_pos / 2.0));\n  vec4 tmpvar_4;\n  tmpvar_4.w = 0.0;\n  tmpvar_4.xy = ((u_linewidth.x * (a_data.xy * 0.015873)) * (1.0 - u_point));\n  tmpvar_4.z = (float((a_pos.x >= 32767.0)) + (u_point * float(\n    (e_1.y >= 1.0)\n  )));\n  gl_Position = ((u_matrix * tmpvar_3) + (u_exmatrix * tmpvar_4));\n  b = ((a_data.z * 128.0) + a_data.w);\n  gl_PointSize = ((2.0 * u_linewidth.x) - 1.0);\n}\n\n",fragment:"precision mediump float;\nuniform vec2 u_linewidth;\nuniform vec2 u_pattern_size;\nuniform vec2 u_pattern_tl;\nuniform vec2 u_pattern_br;\nuniform float u_point;\nuniform float u_blur;\nuniform float u_fade;\nuniform sampler2D u_image;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  lowp vec4 j_1;\n  mediump vec2 x_2;\n  x_2 = ((gl_PointCoord * 2.0) - 1.0);\n  mediump float tmpvar_3;\n  tmpvar_3 = (((\n    sqrt(dot (a, a))\n   * \n    (1.0 - u_point)\n  ) + (u_point * \n    sqrt(dot (x_2, x_2))\n  )) * u_linewidth.x);\n  float tmpvar_4;\n  tmpvar_4 = (float(mod ((b / u_pattern_size.x), 1.0)));\n  float tmpvar_5;\n  tmpvar_5 = (0.5 + ((a.y * u_linewidth.x) / u_pattern_size.y));\n  vec2 tmpvar_6;\n  tmpvar_6.x = tmpvar_4;\n  tmpvar_6.y = tmpvar_5;\n  vec2 tmpvar_7;\n  tmpvar_7.x = (float(mod ((tmpvar_4 * 2.0), 1.0)));\n  tmpvar_7.y = tmpvar_5;\n  lowp vec4 tmpvar_8;\n  tmpvar_8 = ((texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_6)) * (1.0 - u_fade)) + (u_fade * texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_7))));\n  j_1.w = tmpvar_8.w;\n  j_1.xyz = (tmpvar_8.xyz * tmpvar_8.w);\n  gl_FragColor = (j_1 * clamp ((\n    min ((tmpvar_3 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_3))\n   / u_blur), 0.0, 1.0));\n}\n\n"},outline:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nuniform vec2 u_world;\nvarying highp vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_matrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  a = (((tmpvar_2.xy + 1.0) / 2.0) * u_world);\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvarying vec2 a;\nvoid main ()\n{\n  highp vec2 x_1;\n  x_1 = (a - gl_FragCoord.xy);\n  highp float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 1.0) / -1.0), 0.0, 1.0);\n  highp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n  gl_FragColor = tmpvar_3;\n}\n\n"},pattern:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform mat3 u_patternmatrix;\nattribute vec2 a_pos;\nvarying vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  vec3 tmpvar_2;\n  tmpvar_2.z = 1.0;\n  tmpvar_2.xy = a_pos;\n  a = (u_patternmatrix * tmpvar_2).xy;\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity;\nuniform float u_mix;\nuniform vec2 u_pattern_tl;\nuniform vec2 u_pattern_br;\nuniform sampler2D u_image;\nvarying vec2 a;\nvoid main ()\n{\n  vec2 tmpvar_1;\n  tmpvar_1 = (vec2(mod (a, 1.0)));\n  lowp vec4 tmpvar_2;\n  tmpvar_2 = (mix (texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_1)), texture2D (u_image, mix (u_pattern_tl, u_pattern_br, \n    (vec2(mod ((tmpvar_1 * 2.0), 1.0)))\n  )), u_mix) * u_opacity);\n  gl_FragColor = tmpvar_2;\n}\n\n"},raster:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\nvarying vec2 a;\nvarying vec2 b;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  vec2 tmpvar_2;\n  tmpvar_2 = (((\n    (a_texture_pos / 32767.0)\n   - 0.5) / u_buffer_scale) + 0.5);\n  a = tmpvar_2;\n  b = ((tmpvar_2 * u_scale_parent) + u_tl_parent);\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity0;\nuniform float u_opacity1;\nuniform float u_brightness_low;\nuniform float u_brightness_high;\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 a;\nvarying vec2 b;\nuniform vec3 u_spin_weights;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = ((texture2D (u_image0, a) * u_opacity0) + (texture2D (u_image1, b) * u_opacity1));\n  lowp vec3 tmpvar_2;\n  tmpvar_2.x = dot (tmpvar_1.xyz, u_spin_weights);\n  tmpvar_2.y = dot (tmpvar_1.xyz, u_spin_weights.zxy);\n  tmpvar_2.z = dot (tmpvar_1.xyz, u_spin_weights.yzx);\n  lowp vec4 tmpvar_3;\n  tmpvar_3.xyz = mix (vec3(u_brightness_low), vec3(u_brightness_high), ((\n    ((tmpvar_2 + ((\n      (((tmpvar_1.x + tmpvar_1.y) + tmpvar_1.z) / 3.0)\n     - tmpvar_2) * u_saturation_factor)) - 0.5)\n   * u_contrast_factor) + 0.5));\n  tmpvar_3.w = tmpvar_1.w;\n  gl_FragColor = tmpvar_3;\n}\n\n"},icon:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec4 a_data1;\nattribute vec4 a_data2;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform float u_opacity;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float m_1;\n  m_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_data1.w + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    m_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_data2.x))\n  ) - (1.0 - \n    float((u_zoom >= a_data2.y))\n  )) + m_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_data1.z) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_data1.z)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_data1.z)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_data2.z)\n  ) * (1.0 - \n    float((u_angle >= a_data2.w))\n  )));\n  gl_Position = ((u_matrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_data1.xy / u_texsize);\n  b = (b * u_opacity);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (texture2D (u_texture, a) * b);\n  gl_FragColor = tmpvar_1;\n}\n\n"},sdf:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec4 a_data1;\nattribute vec4 a_data2;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float l_1;\n  l_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_data1.w + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    l_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_data2.x))\n  ) - (1.0 - \n    float((u_zoom >= a_data2.y))\n  )) + l_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_data1.z) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_data1.z)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_data1.z)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_data2.z)\n  ) * (1.0 - \n    float((u_angle >= a_data2.w))\n  )));\n  gl_Position = ((u_matrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_data1.xy / u_texsize);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec4 u_color;\nuniform float u_buffer;\nuniform float u_gamma;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float edge0_1;\n  edge0_1 = (u_buffer - u_gamma);\n  lowp float tmpvar_2;\n  tmpvar_2 = clamp (((texture2D (u_texture, a).w - edge0_1) / (\n    (u_buffer + u_gamma)\n   - edge0_1)), 0.0, 1.0);\n  lowp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * ((tmpvar_2 * \n    (tmpvar_2 * (3.0 - (2.0 * tmpvar_2)))\n  ) * b));\n  gl_FragColor = tmpvar_3;\n}\n\n"}};
},{}],34:[function(require,module,exports){
"use strict";function GeoJSONSource(i){i=i||{},this._data=i.data,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),this._pyramid=new TilePyramid({tileSize:512,minzoom:this.minzoom,maxzoom:this.maxzoom,cacheSize:20,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this)})}var util=require("../util/util"),Evented=require("../util/evented"),TilePyramid=require("./tile_pyramid"),Source=require("./source");module.exports=GeoJSONSource,GeoJSONSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:14,_dirty:!0,setData:function(i){return this._data=i,this._dirty=!0,this.fire("change"),this},onAdd:function(i){this.map=i},loaded:function(){return this._loaded&&this._pyramid.loaded()},update:function(i){this._dirty&&this._updateData(),this._loaded&&this._pyramid.update(this.used,i)},render:Source._renderTiles,featuresAt:Source._vectorFeaturesAt,_updateData:function(){var i=this;this._dirty=!1,this.workerID=this.dispatcher.send("parse geojson",{data:this._data,tileSize:512,source:this.id,maxZoom:this.maxzoom},function(e){return e?void i.fire("error",{error:e}):(i._loaded=!0,i._pyramid.clearTiles(),void i.fire("change"))})},_loadTile:function(i){var e=this,t={id:i.uid,tileId:i.id,zoom:i.zoom,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,depth:i.zoom>=this.maxzoom?this.map.options.maxZoom-i.zoom:1};i.workerID=this.dispatcher.send("load geojson tile",t,function(t,o){if(!i.aborted){if(t)return e.fire("tile.error",{tile:i});i.loadVectorData(o,e.style.buckets),e.fire("tile.load",{tile:i})}},this.workerID)},_abortTile:function(i){i.aborted=!0},_addTile:function(i){this.fire("tile.add",{tile:i})},_removeTile:function(i){this.fire("tile.remove",{tile:i})},_unloadTile:function(i){i.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(i.uid),this.dispatcher.send("remove tile",{id:i.uid,source:this.id},null,i.workerID)}});
},{"../util/evented":81,"../util/util":86,"./source":37,"./tile_pyramid":40}],35:[function(require,module,exports){
"use strict";function GeoJSONWrapper(e){this.features=e,this.length=e.length}function FeatureWrapper(e){this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags}var Point=require("point-geometry");module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e])},FeatureWrapper.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],a=0;a<r.length;a++)o.push(new Point(r[a][0],r[a][1]));this.geometry.push(o)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,a=-1/0,p=0;p<e.length;p++)for(var i=e[p],n=0;n<i.length;n++){var h=i[n];t=Math.min(t,h.x),r=Math.max(r,h.x),o=Math.min(o,h.y),a=Math.max(a,h.y)}return[t,o,r,a]};
},{"point-geometry":99}],36:[function(require,module,exports){
"use strict";function RasterTileSource(e){util.extend(this,util.pick(e,"url","tileSize")),Source._loadTileJSON.call(this,e)}var util=require("../util/util"),ajax=require("../util/ajax"),Evented=require("../util/evented"),TileCoord=require("./tile_coord"),Source=require("./source");module.exports=RasterTileSource,RasterTileSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:22,tileSize:512,_loaded:!1,onAdd:function(e){this.map=e},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(e){this._pyramid&&this._pyramid.update(this.used,e,this.map.style.rasterFadeDuration)},render:Source._renderTiles,_loadTile:function(e){var t=this;ajax.getImage(TileCoord.url(e.id,this.tiles),function(i,r){if(!e.aborted){if(i)return t.fire("tile.error",{tile:e});var a=t.map.painter.gl;e.texture=t.map.painter.getTexture(r.width),e.texture?(a.bindTexture(a.TEXTURE_2D,e.texture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,r)):(e.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,e.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),e.texture.size=r.width),a.generateMipmap(a.TEXTURE_2D),e.timeAdded=(new Date).getTime(),t.map.animationLoop.set(t.style.rasterFadeDuration),e.source=t,e.buckets={};var u=t.style.buckets;for(var o in u){var l=u[o],T=l&&l.source;t.id===T&&(e.buckets[o]={layoutProperties:l.layout,type:"raster"})}e.loaded=!0,t.fire("tile.load",{tile:e})}})},_abortTile:function(e){e.aborted=!0},_addTile:function(e){this.fire("tile.add",{tile:e})},_removeTile:function(e){this.fire("tile.remove",{tile:e})},_unloadTile:function(e){e.texture&&this.map.painter.saveTexture(e.texture)},featuresAt:function(e,t,i){i(null,[])}});
},{"../util/ajax":75,"../util/evented":81,"../util/util":86,"./source":37,"./tile_coord":39}],37:[function(require,module,exports){
"use strict";var util=require("../util/util"),ajax=require("../util/ajax"),browser=require("../util/browser"),TileCoord=require("./tile_coord"),TilePyramid=require("./tile_pyramid"),normalizeURL=require("../util/mapbox").normalizeSourceURL;exports._loadTileJSON=function(e){var r=this,i=function(e,i){return e?void r.fire("error",{error:e}):(util.extend(r,util.pick(i,"tiles","minzoom","maxzoom","attribution")),r._pyramid=new TilePyramid({tileSize:r.tileSize,cacheSize:20,minzoom:r.minzoom,maxzoom:r.maxzoom,load:r._loadTile.bind(r),abort:r._abortTile.bind(r),unload:r._unloadTile.bind(r),add:r._addTile.bind(r),remove:r._removeTile.bind(r)}),void r.fire("load"))};e.url?ajax.getJSON(normalizeURL(e.url),i):browser.frame(i.bind(this,null,e))},exports._renderTiles=function(e,r){if(this._pyramid)for(var i=this._pyramid.renderedIDs(),o=0;o<i.length;o++){var t=TileCoord.fromID(i[o]),a=this._pyramid.getTile(i[o]),l=t.z,u=t.x,s=t.y,d=t.w;u+=d*(1<<l),a.calculateMatrices(l,u,s,r.transform,r),r.drawTile(a,r.style,e)}},exports._vectorFeaturesAt=function(e,r,i){if(!this._pyramid)return i(null,[]);var o=this._pyramid.tileAt(e);return o?void this.dispatcher.send("query features",{id:o.tile.uid,x:o.x,y:o.y,scale:o.scale,source:this.id,params:r},i,o.tile.workerID):i(null,[])};var sources={vector:require("./vector_tile_source"),raster:require("./raster_tile_source"),geojson:require("./geojson_source"),video:require("./video_source")};exports.create=function(e){return new sources[e.type](e)};
},{"../util/ajax":75,"../util/browser":76,"../util/mapbox":83,"../util/util":86,"./geojson_source":34,"./raster_tile_source":36,"./tile_coord":39,"./tile_pyramid":40,"./vector_tile_source":41,"./video_source":42}],38:[function(require,module,exports){
"use strict";function Tile(t){this.id=t,this.uid=util.uniqueId(),this.loaded=!1,this.zoom=TileCoord.fromID(t).z,this.uses=0}var glmatrix=require("gl-matrix"),mat2=glmatrix.mat2,mat4=glmatrix.mat4,vec2=glmatrix.vec2,TileCoord=require("./tile_coord"),util=require("../util/util"),BufferSet=require("../data/buffer/buffer_set"),createBucket=require("../data/create_bucket");module.exports=Tile,Tile.prototype={tileExtent:4096,calculateMatrices:function(t,i,e,r,a){var s=Math.pow(2,t),o=r.worldSize/s;this.scale=o,this.posMatrix=mat4.create(),mat4.translate(this.posMatrix,this.posMatrix,[r.centerPoint.x,r.centerPoint.y,0]),mat4.rotateZ(this.posMatrix,this.posMatrix,r.angle),mat4.translate(this.posMatrix,this.posMatrix,[-r.centerPoint.x,-r.centerPoint.y,0]);var n=r.width/2-r.x,h=r.height/2-r.y;mat4.translate(this.posMatrix,this.posMatrix,[n+i*o,h+e*o,1]),this.invPosMatrix=mat4.create(),mat4.invert(this.invPosMatrix,this.posMatrix),mat4.scale(this.posMatrix,this.posMatrix,[o/this.tileExtent,o/this.tileExtent,1]),mat4.multiply(this.posMatrix,a.projectionMatrix,this.posMatrix),this.exMatrix=mat4.clone(a.projectionMatrix),mat4.rotateZ(this.exMatrix,this.exMatrix,r.angle),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,r.angle)},positionAt:function(t){if(!this.invPosMatrix)return null;var i=vec2.transformMat4([],[t.x,t.y],this.invPosMatrix);return vec2.scale(i,i,4096/this.scale),{x:i[0],y:i[1],scale:this.scale}},loadVectorData:function(t,i){if(this.loaded=!0,this.buckets={},t){this.buffers=new BufferSet(t.buffers);for(var e in t.elementGroups)this.buckets[e]=createBucket(i[e],this.buffers,void 0,t.elementGroups[e])}},unloadVectorData:function(t){for(var i in this.buckets)this.buckets[i]&&this.buckets[i].prerendered&&t.saveTexture(this.buckets[i].prerendered.texture);if(this.buffers)for(var e in this.buffers)this.buffers[e].destroy(t.gl)}};
},{"../data/buffer/buffer_set":2,"../data/create_bucket":10,"../util/util":86,"./tile_coord":39,"gl-matrix":94}],39:[function(require,module,exports){
"use strict";function edge(o,r){if(o.row>r.row){var n=o;o=r,r=n}return{x0:o.column,y0:o.row,x1:r.column,y1:r.row,dx:r.column-o.column,dy:r.row-o.row}}function scanSpans(o,r,n,e,t){var a=Math.max(n,Math.floor(r.y0)),i=Math.min(e,Math.ceil(r.y1));if(o.x0==r.x0&&o.y0==r.y0?o.x0+r.dy/o.dy*o.dx<r.x1:o.x1-r.dy/o.dy*o.dx<r.x0){var d=o;o=r,r=d}for(var l=o.dx/o.dy,y=r.dx/r.dy,x=o.dx>0,c=r.dx<0,f=a;i>f;f++){var u=l*Math.max(0,Math.min(o.dy,f+x-o.y0))+o.x0,T=y*Math.max(0,Math.min(r.dy,f+c-r.y0))+r.x0;t(Math.floor(T),Math.ceil(u),f)}}function scanTriangle(o,r,n,e,t,a){var i,d=edge(o,r),l=edge(r,n),y=edge(n,o);d.dy>l.dy&&(i=d,d=l,l=i),d.dy>y.dy&&(i=d,d=y,y=i),l.dy>y.dy&&(i=l,l=y,y=i),d.dy&&scanSpans(y,d,e,t,a),l.dy&&scanSpans(y,l,e,t,a)}var TileCoord=exports;TileCoord.toID=function(o,r,n,e){e=e||0,e*=2,0>e&&(e=-1*e-1);var t=1<<o;return 32*(t*t*e+t*n+r)+o},TileCoord.asString=function(o){var r=TileCoord.fromID(o);return r.z+"/"+r.x+"/"+r.y},TileCoord.fromID=function(o){var r=o%32,n=1<<r,e=(o-r)/32,t=e%n,a=(e-t)/n%n,i=Math.floor(e/(n*n));return i%2!==0&&(i=-1*i-1),i/=2,{z:r,x:t,y:a,w:i}},TileCoord.zoom=function(o){return o%32},TileCoord.url=function(o,r){var n=TileCoord.fromID(o);return r[(n.x+n.y)%r.length].replace("{prefix}",(n.x%16).toString(16)+(n.y%16).toString(16)).replace("{z}",n.z).replace("{x}",n.x).replace("{y}",n.y)},TileCoord.parent=function(o){var r=TileCoord.fromID(o);return 0===r.z?void 0:TileCoord.toID(r.z-1,Math.floor(r.x/2),Math.floor(r.y/2),r.w)},TileCoord.parentWithZoom=function(o,r){for(var n=TileCoord.fromID(o);n.z>r;)n.z--,n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2);return TileCoord.toID(n.z,n.x,n.y,n.w)},TileCoord.children=function(o){var r=TileCoord.fromID(o);return r.z+=1,r.x*=2,r.y*=2,[TileCoord.toID(r.z,r.x,r.y,r.w),TileCoord.toID(r.z,r.x+1,r.y,r.w),TileCoord.toID(r.z,r.x,r.y+1,r.w),TileCoord.toID(r.z,r.x+1,r.y+1,r.w)]},TileCoord.zoomTo=function(o,r){return o.column=o.column*Math.pow(2,r-o.zoom),o.row=o.row*Math.pow(2,r-o.zoom),o.zoom=r,o},TileCoord.cover=function(o,r){function n(r,n,a){var i,d;if(a>=0&&e>=a)for(i=r;n>i;i++)d=(i+e)%e,t[TileCoord.toID(o,d,a,Math.floor(i/e))]={x:d,y:a}}var e=1<<o,t={};return scanTriangle(r[0],r[1],r[2],0,e,n),scanTriangle(r[2],r[3],r[0],0,e,n),Object.keys(t)};
},{}],40:[function(require,module,exports){
"use strict";function TilePyramid(i){var e=this;this.tileSize=i.tileSize,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this._load=i.load,this._abort=i.abort,this._unload=i.unload,this._add=i.add,this._remove=i.remove,this._tiles={},this._cache=new Cache(i.cacheSize,function(i){return e._unload(i)})}var Tile=require("./tile"),TileCoord=require("./tile_coord"),Point=require("point-geometry"),Cache=require("../util/mru_cache"),util=require("../util/util");module.exports=TilePyramid,TilePyramid.prototype={loaded:function(){for(var i in this._tiles)if(!this._tiles[i].loaded)return!1;return!0},orderedIDs:function(){return Object.keys(this._tiles).sort(function(i,e){return e%32-i%32}).map(function(i){return+i})},renderedIDs:function(){var i=this;return this.orderedIDs().filter(function(e){return i._tiles[e].loaded&&!i._coveredTiles[e]})},getTile:function(i){return this._tiles[i]},getZoom:function(i){return i.zoom+Math.log(i.tileSize/this.tileSize)/Math.LN2},coveringZoomLevel:function(i){return Math.floor(this.getZoom(i))},coveringTiles:function(i){var e=this.coveringZoomLevel(i);if(e<this.minzoom)return[];e>this.maxzoom&&(e=this.maxzoom);var t=i,o=TileCoord.zoomTo(t.locationCoordinate(t.center),e),r=new Point(o.column-.5,o.row-.5);return TileCoord.cover(e,[TileCoord.zoomTo(t.pointCoordinate(o,{x:0,y:0}),e),TileCoord.zoomTo(t.pointCoordinate(o,{x:t.width,y:0}),e),TileCoord.zoomTo(t.pointCoordinate(o,{x:t.width,y:t.height}),e),TileCoord.zoomTo(t.pointCoordinate(o,{x:0,y:t.height}),e)]).sort(function(i,e){return r.dist(TileCoord.fromID(i))-r.dist(TileCoord.fromID(e))})},findLoadedChildren:function(i,e,t){for(var o=!0,r=TileCoord.fromID(i).z,n=TileCoord.children(i),s=0;s<n.length;s++)this._tiles[n[s]]&&this._tiles[n[s]].loaded?t[n[s]]=!0:(o=!1,e>r&&this.findLoadedChildren(n[s],e,t));return o},findLoadedParent:function(i,e,t){for(var o=TileCoord.fromID(i).z;o>=e;o--){i=TileCoord.parent(i);var r=this._tiles[i];if(r&&r.loaded)return t[i]=!0,r}},update:function(i,e,t){var o,r,n,s=Math.floor(this.getZoom(e)),d=util.clamp(s-10,this.minzoom,this.maxzoom),l=util.clamp(s+1,this.minzoom,this.maxzoom),a={},h=(new Date).getTime();this._coveredTiles={};var u=i?this.coveringTiles(e):[];for(o=0;o<u.length;o++)r=+u[o],n=this.addTile(r),a[r]=!0,n.loaded||this.findLoadedChildren(r,l,a)||this.findLoadedParent(r,d,a);for(r in a)n=this._tiles[r],n&&n.timeAdded>h-(t||0)&&(this.findLoadedChildren(r,l,a)?(this._coveredTiles[r]=!0,a[r]=!0):this.findLoadedParent(r,d,a));var c=util.keysDifference(this._tiles,a);for(o=0;o<c.length;o++)this.removeTile(+c[o])},addTile:function(i){var e=this._tiles[i];if(e)return e;var t=this._wrappedID(i);return e=this._tiles[t]||this._cache.get(t),e||(e=new Tile(t),this._load(e)),e.uses++,this._tiles[i]=e,this._add(e,i),e},removeTile:function(i){var e=this._tiles[i];e&&(e.uses--,delete this._tiles[i],this._remove(e,i),e.uses>0||(e.loaded?this._cache.add(this._wrappedID(i),e):(this._abort(e),this._unload(e))))},clearTiles:function(){for(var i in this._tiles)this.removeTile(i);this._cache.reset()},tileAt:function(i){for(var e=this.orderedIDs(),t=0;t<e.length;t++){var o=this._tiles[e[t]],r=o.positionAt(i);if(r&&r.x>=0&&r.x<4096&&r.y>=0&&r.y<4096)return{tile:o,x:r.x,y:r.y,scale:r.scale}}},_wrappedID:function(i){var e=TileCoord.fromID(i);return 0===e.w?i:TileCoord.toID(e.z,e.x,e.y,0)}};
},{"../util/mru_cache":84,"../util/util":86,"./tile":38,"./tile_coord":39,"point-geometry":99}],41:[function(require,module,exports){
"use strict";function VectorTileSource(e){if(util.extend(this,util.pick(e,"url","tileSize")),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");Source._loadTileJSON.call(this,e)}var util=require("../util/util"),Evented=require("../util/evented"),TileCoord=require("./tile_coord"),Source=require("./source");module.exports=VectorTileSource,VectorTileSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:22,tileSize:512,_loaded:!1,onAdd:function(e){this.map=e},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(e){this._pyramid&&this._pyramid.update(this.used,e)},render:Source._renderTiles,featuresAt:Source._vectorFeaturesAt,_loadTile:function(e){var i=this,t={url:TileCoord.url(e.id,this.tiles),id:e.uid,tileId:e.id,zoom:e.zoom,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,depth:e.zoom>=this.maxzoom?this.map.options.maxZoom-e.zoom:1};e.workerID=this.dispatcher.send("load tile",t,function(t,o){if(!e.aborted){if(t)return i.fire("tile.error",{tile:e});e.loadVectorData(o,i.style.buckets),i.fire("tile.load",{tile:e})}})},_abortTile:function(e){e.aborted=!0,this.dispatcher.send("abort tile",{id:e.uid,source:this.id},null,e.workerID)},_addTile:function(e){this.fire("tile.add",{tile:e})},_removeTile:function(e){this.fire("tile.remove",{tile:e})},_unloadTile:function(e){e.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(e.uid),this.dispatcher.send("remove tile",{id:e.uid,source:this.id},null,e.workerID)}});
},{"../util/evented":81,"../util/util":86,"./source":37,"./tile_coord":39}],42:[function(require,module,exports){
"use strict";function VideoSource(e){this.coordinates=e.coordinates,ajax.getVideo("string"==typeof e.url?[e.url]:e.url,function(e,t){var i=this;if(!e){this.video=t,this.video.loop=!0;var r;this.video.addEventListener("playing",function(){r=i.map.style.animationLoop.set(1/0),i.map._rerender()}),this.video.addEventListener("pause",function(){i.map.style.animationLoop.cancel(r)}),this._loaded=!0,this.map&&(this.video.play(),this.createTile(),this.fire("change"))}}.bind(this))}var util=require("../util/util"),Tile=require("./tile"),TileCoord=require("./tile_coord"),LatLng=require("../geo/lat_lng"),Point=require("point-geometry"),Evented=require("../util/evented"),ajax=require("../util/ajax");module.exports=VideoSource,VideoSource.prototype=util.inherit(Evented,{onAdd:function(e){this.map=e,this.video&&(this.video.play(),this.createTile())},createTile:function(){for(var e=this.map,t=this.coordinates.map(function(t){var i=LatLng.convert(t);return TileCoord.zoomTo(e.transform.locationCoordinate(i),0)}),i=1/0,r=1/0,o=-1/0,a=-1/0,n=0;n<t.length;n++)i=Math.min(i,t[n].column),r=Math.min(r,t[n].row),o=Math.max(o,t[n].column),a=Math.max(a,t[n].row);var u=o-i,l=a-r,s=Math.max(u,l),d=TileCoord.zoomTo({column:(i+o)/2,row:(r+a)/2,zoom:0},Math.floor(-Math.log(s)/Math.LN2)),h=4096,T=t.map(function(e){var t=TileCoord.zoomTo(e,d.zoom);return new Point(Math.round((t.column-d.column)*h),Math.round((t.row-d.row)*h))}),c=e.painter.gl,E=32767,m=new Int16Array([T[0].x,T[0].y,0,0,T[1].x,T[1].y,E,0,T[3].x,T[3].y,0,E,T[2].x,T[2].y,E,E]);this.tile=new Tile,this.tile.buckets={},this.tile.boundsBuffer=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,this.tile.boundsBuffer),c.bufferData(c.ARRAY_BUFFER,m,c.STATIC_DRAW),this.center=d},loaded:function(){return this.video&&this.video.readyState>=2},update:function(){},render:function(e,t){if(this._loaded&&!(this.video.readyState<2)){var i=e[0],r={};r[i.bucket]={type:"raster"};var o=this.center;this.tile.calculateMatrices(o.zoom,o.column,o.row,this.map.transform,t);var a=t.gl;this.tile.texture?(a.bindTexture(a.TEXTURE_2D,this.tile.texture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.tile.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.tile.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.video)),t.drawLayer(this.tile,this.map.style,i,{},void 0,r)}},featuresAt:function(e,t,i){return i(null,[])}});
},{"../geo/lat_lng":17,"../util/ajax":75,"../util/evented":81,"../util/util":86,"./tile":38,"./tile_coord":39,"point-geometry":99}],43:[function(require,module,exports){
"use strict";function Worker(e){this.self=e,this.actor=new Actor(e,this),this.loading={},this.loaded={},this.buckets=[],this.geoJSONIndexes={}}var Actor=require("../util/actor"),featureFilter=require("feature-filter"),WorkerTile=require("./worker_tile"),util=require("../util/util"),ajax=require("../util/ajax"),vt=require("vector-tile"),Protobuf=require("pbf"),TileCoord=require("./tile_coord"),geojsonvt=require("geojson-vt"),GeoJSONWrapper=require("./geojson_wrapper");module.exports=Worker,util.extend(Worker.prototype,{"set buckets":function(e){this.buckets=e;for(var t=0;t<this.buckets.length;t++){var r=this.buckets[t];r.compare=featureFilter(r.filter)}},"load tile":function(e,t){var r=this,o=e.source,i=e.id;this.loading[o]||(this.loading[o]={}),this.loading[o][i]=ajax.getArrayBuffer(e.url,function(a,l){if(delete r.loading[o][i],a)return t(a);var s=new WorkerTile(e.id,e.zoom,e.maxZoom,e.tileSize,e.source,e.depth);s.parse(new vt.VectorTile(new Protobuf(new Uint8Array(l))),r.buckets,r.actor,t),r.loaded[o]=r.loaded[o]||{},r.loaded[o][i]=s})},"abort tile":function(e){var t=this.loading[e.source];t&&t[e.id]&&(t[e.id].abort(),delete t[e.id])},"remove tile":function(e){var t=e.source,r=e.id;this.loaded[t]&&this.loaded[t][r]&&delete this.loaded[t][r]},"parse geojson":function(e,t){var r=this,o=function(o,i){r.geoJSONIndexes[e.source]=geojsonvt(i,{baseZoom:e.maxZoom}),t(null)};"string"==typeof e.data?ajax.getJSON(e.data,o):o(null,e.data)},"load geojson tile":function(e,t){var r=e.source,o=e.tileId,i=e.id,a=TileCoord.fromID(o),l=this.geoJSONIndexes[r].getTile(a.z,a.x,a.y);if(!l)return t(null,null);var s=new WorkerTile(i,e.zoom,e.maxZoom,e.tileSize,r,e.depth);s.parse(new GeoJSONWrapper(l.features),this.buckets,this.actor,t),this.loaded[r]=this.loaded[r]||{},this.loaded[r][i]=s},"query features":function(e,t){var r=this.loaded[e.source]&&this.loaded[e.source][e.id];r?r.featureTree.query(e,t):t(null,[])}});
},{"../util/actor":74,"../util/ajax":75,"../util/util":86,"./geojson_wrapper":35,"./tile_coord":39,"./worker_tile":44,"feature-filter":88,"geojson-vt":91,"pbf":97,"vector-tile":102}],44:[function(require,module,exports){
"use strict";function WorkerTile(e,t,r,o,i,s){this.id=e,this.zoom=t,this.maxZoom=r,this.tileSize=o,this.source=i,this.depth=s,this.buffers=new BufferSet}function sortTileIntoBuckets(e,t,r){function o(r){var o=r.id,u=r.minzoom,f=r.maxzoom;if(r.ref&&a.push(r),r.source===e.source&&!(u&&e.zoom<u&&u<e.maxZoom||f&&e.zoom>=f)){var l=createBucket(r,e.buffers,e.collision);l&&(l.features=[],l.name=o,l["source-layer"]=r["source-layer"],n[o]=l,t.layers?(i=r["source-layer"],s[i]||(s[i]={}),s[i][o]=r):s[o]=r)}}for(var i,s={},n={},a=[],u=0;u<r.length;u++){var f=r[u];o(f)}for(;a.length;){var l=a.shift();if(n[l.ref]){var c=n[l.ref]["source-layer"],h=s[c][l.ref];Object.keys(h).forEach(function(e){"paint"===e||l[e]||(l[e]=h[e])}),s[c][l.id]=l;var d=createBucket(l,e.buffers,e.collision);d.features=[],d.name=l.id,n[l.id]=d}}if(t.layers)for(i in s){var v=t.layers[i];v&&sortLayerIntoBuckets(v,s[i],n)}else sortLayerIntoBuckets(t,s,n);return n}function sortLayerIntoBuckets(e,t,r){for(var o=0;o<e.length;o++){var i=e.feature(o);for(var s in t)t[s].compare(i)&&r[s].features.push(i)}}function getGeometry(e){return e.loadGeometry()}function getType(e){return vt.VectorTileFeature.types[e.type]}var FeatureTree=require("../data/feature_tree"),vt=require("vector-tile"),Collision=require("../symbol/collision"),BufferSet=require("../data/buffer/buffer_set"),createBucket=require("../data/create_bucket");module.exports=WorkerTile,WorkerTile.prototype.parse=function(e,t,r,o){function i(e){return function(t){e.dependenciesLoaded=!0,s(n,e,t)}}function s(e,t,r){if(!(t.getDependencies&&!t.dependenciesLoaded||t.collision&&!t.previousPlaced)){if(!r){var o=Date.now();"raster"!==t.type&&t.addFeatures();var i=Date.now()-o;if(t.interactive)for(var n=0;n<t.features.length;n++){var a=t.features[n];e.featureTree.insert(a.bbox(),t.info,a)}"undefined"!=typeof self&&(self.bucketStats=self.bucketStats||{_total:0},self.bucketStats._total+=i,self.bucketStats[t.name]=(self.bucketStats[t.name]||0)+i)}return h--,h?void(t.next&&(t.next.previousPlaced=!0,s(e,t.next))):e.done()}}var n=this;this.data=e,this.callback=o;var a=4096;this.collision=new Collision(this.zoom,a,this.tileSize,this.depth),this.featureTree=new FeatureTree(getGeometry,getType);for(var u,f,l,c=this.buckets=sortTileIntoBuckets(this,e,t),h=t.length,d=0;d<t.length;d++)f=c[t[d].id],f&&(f.info=t[d]),t[d].source===this.source&&f?(f.collision&&(l?(l.next=f,l.next.bucketInfo=t[d]):f.previousPlaced=!0,l=f),f.getDependencies&&f.getDependencies(this,r,i(f))):h--;for(u in c)f=c[u],f.getDependencies||f.collision||s(n,f)},WorkerTile.prototype.done=function(){var e=[];for(var t in this.buffers)e.push(this.buffers[t].array);var r=this.buckets,o={};for(var i in r)o[i]=r[i].elementGroups;this.callback(null,{elementGroups:o,buffers:this.buffers},e),this.buffers=null,this.collision=null,this.buckets=null};
},{"../data/buffer/buffer_set":2,"../data/create_bucket":10,"../data/feature_tree":12,"../symbol/collision":56,"vector-tile":102}],45:[function(require,module,exports){
"use strict";function AnimationLoop(){this.n=0,this.times=[]}module.exports=AnimationLoop,AnimationLoop.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},AnimationLoop.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},AnimationLoop.prototype.cancel=function(t){this.times=this.times.filter(function(i){return i.id!=t})};
},{}],46:[function(require,module,exports){
"use strict";function ImageSprite(t){var e=this;this.base=t,this.retina=browser.devicePixelRatio>1,t=this.base+(this.retina?"@2x":""),ajax.getJSON(t+".json",function(t,i){return t?void e.fire("error",{error:t}):(e.data=i,void(e.img&&e.fire("load")))}),ajax.getImage(t+".png",function(t,i){if(t)return void e.fire("error",{error:t});for(var r=i.getData(),a=i.data=new Uint8Array(r.length),o=0;o<r.length;o+=4){var n=r[o+3]/255;a[o+0]=r[o+0]*n,a[o+1]=r[o+1]*n,a[o+2]=r[o+2]*n,a[o+3]=r[o+3]}e.img=i,e.data&&e.fire("load")})}function SpritePosition(){}var Evented=require("../util/evented"),ajax=require("../util/ajax"),browser=require("../util/browser");module.exports=ImageSprite,ImageSprite.prototype=Object.create(Evented),ImageSprite.prototype.toJSON=function(){return this.base},ImageSprite.prototype.loaded=function(){return!(!this.data||!this.img)},ImageSprite.prototype.resize=function(){if(browser.devicePixelRatio>1!==this.retina){var t=new ImageSprite(this.base);t.on("load",function(){this.img=t.img,this.data=t.data,this.retina=t.retina}.bind(this))}},SpritePosition.prototype={x:0,y:0,width:0,height:0,pixelRatio:1,sdf:!1},ImageSprite.prototype.getSpritePosition=function(t){if(!this.loaded())return new SpritePosition;var e=this.data&&this.data[t];return e&&this.img?e:new SpritePosition};
},{"../util/ajax":75,"../util/browser":76,"../util/evented":81}],47:[function(require,module,exports){
"use strict";var reference=require("./reference");module.exports={},reference.layout.forEach(function(e){var r=function(e){for(var r in e)this[r]=e[r]},o=reference[e];for(var t in o)void 0!==o[t]["default"]&&(r.prototype[t]=o[t]["default"]);module.exports[e.replace("layout_","")]=r});
},{"./reference":49}],48:[function(require,module,exports){
"use strict";var reference=require("./reference"),parseCSSColor=require("csscolorparser").parseCSSColor;module.exports={},reference.paint.forEach(function(e){var r=function(){},o=reference[e];for(var p in o){var t=o[p],a=t["default"];void 0!==a&&("color"===t.type&&(a=parseCSSColor(a)),r.prototype[p]=a)}r.prototype.hidden=!1,module.exports[e.replace("paint_","")]=r});
},{"./reference":49,"csscolorparser":87}],49:[function(require,module,exports){
"use strict";module.exports=require("mapbox-gl-style-spec/reference/v6");
},{"mapbox-gl-style-spec/reference/v6":95}],50:[function(require,module,exports){
"use strict";function Style(e,t){var r=this;this.classes={},this.animationLoop=t,this.dispatcher=new Dispatcher(Math.max(browser.hardwareConcurrency-1,1),this),this.glyphAtlas=new GlyphAtlas(1024,1024),this.spriteAtlas=new SpriteAtlas(512,512),this.spriteAtlas.resize(browser.devicePixelRatio),this.buckets={},this.orderedBuckets=[],this.flattened=[],this.layerMap={},this.layerGroups=[],this.processedPaintProps={},this.transitions={},this.computed={},this.sources={},util.bindAll(["_forwardSourceEvent","_forwardTileEvent"],this);var s=function(e,t){if(e)return void r.fire("error",{error:e});r._loaded=!0,r.stylesheet=t,6!==t.version&&console.warn("Stylesheet version must be 6"),Array.isArray(t.layers)||console.warn("Stylesheet must have layers");var s=t.sources;for(var i in s)r.addSource(i,Source.create(s[i]));t.sprite&&(r.sprite=new ImageSprite(t.sprite),r.sprite.on("load",r.fire.bind(r,"change"))),r.glyphSource=new GlyphSource(t.glyphs,r.glyphAtlas),r.cascade({transition:!1}),r.fire("load")};"string"==typeof e?ajax.getJSON(normalizeURL(e),s):browser.frame(s.bind(this,null,e))}function premultiplyLayer(e,t){var r=t+"-color",s=t+"-halo-color",i=t+"-outline-color",a=e[r],o=e[s],n=e[i],l=e[t+"-opacity"],u=a&&l*a[3],c=o&&l*o[3],h=n&&l*n[3];void 0!==u&&1>u&&(e[r]=util.premultiply([a[0],a[1],a[2],u])),void 0!==c&&1>c&&(e[s]=util.premultiply([o[0],o[1],o[2],c])),void 0!==h&&1>h&&(e[i]=util.premultiply([n[0],n[1],n[2],h]))}var Evented=require("../util/evented"),Source=require("../source/source"),StyleTransition=require("./style_transition"),StyleDeclaration=require("./style_declaration"),StyleConstant=require("./style_constant"),LayoutProperties=require("./layout_properties"),PaintProperties=require("./paint_properties"),ImageSprite=require("./image_sprite"),GlyphSource=require("../symbol/glyph_source"),GlyphAtlas=require("../symbol/glyph_atlas"),SpriteAtlas=require("../symbol/sprite_atlas"),util=require("../util/util"),ajax=require("../util/ajax"),normalizeURL=require("../util/mapbox").normalizeStyleURL,browser=require("../util/browser"),Dispatcher=require("../util/dispatcher"),Point=require("point-geometry");module.exports=Style,Style.prototype=util.inherit(Evented,{_loaded:!1,loaded:function(){if(!this._loaded)return!1;for(var e in this.sources)if(!this.sources[e].loaded())return!1;return this.sprite&&!this.sprite.loaded()?!1:!0},recalculate:function(e){"number"!=typeof e&&console.warn("recalculate expects zoom level");var t=this.transitions,r={};for(var s in this.sources)this.sources[s].used=!1;this.rasterFadeDuration=300;for(var i in t){var a=t[i],o=this.buckets[a.ref||i],n=this.layerMap[i].type;if(PaintProperties[n]){var l=r[i]=new PaintProperties[n];for(var u in a){var c=a[u];l[u]=c.at(e)}if("symbol"===n?0!==l["text-opacity"]&&o.layout["text-field"]||0!==l["icon-opacity"]&&o.layout["icon-image"]?(premultiplyLayer(l,"text"),premultiplyLayer(l,"icon")):l.hidden=!0:0===l[n+"-opacity"]?l.hidden=!0:premultiplyLayer(l,n),!l.hidden){var h=o&&o.source;h&&(this.sources[h].used=!0)}l["raster-fade-duration"]&&(this.rasterFadeDuration=Math.max(this.rasterFadeDuration,l["raster-fade-duration"]))}else console.warn("unknown layer type "+n)}this.computed=r,this.z=e,this.fire("zoom")},_simpleLayer:function(e){var t={};t.id=e.id;var r=this.buckets[e.ref||e.id];if(r&&(t.bucket=r.id),e.type&&(t.type=e.type),e.layers){t.layers=[];for(var s=0;s<e.layers.length;s++)t.layers.push(this._simpleLayer(e.layers[s]))}return t},_groupLayers:function(e){for(var t,r=0,s=[],i=e.length-1;i>=0;i--){var a=e[i],o=this.buckets[a.ref||a.id],n=o&&o.source;t&&n!==t.source&&r++,s[r]||(t=[],t.source=n,s[r]=t),t.push(this._simpleLayer(a))}return s},cascade:function(e){function t(e,r,s){for(var i=0;i<s.length;i++){var a=s[i];if(a.layers&&(e=t(e,r,a.layers)),a.ref||a.source&&a.type){var o={id:a.id};for(n in a)/^paint/.test(n)||(o[n]=a[n]);o.layout=StyleConstant.resolve(o.layout,u),e[a.id]=o,r.push(o)}}return e}function r(e,t){if(!t.ref||!e[t.ref])return t;var s=r(e,e[t.ref]);return t.layout=s.layout,t.type=s.type,t.filter=s.filter,t.source=s.source,t["source-layer"]=s["source-layer"],t.minzoom=s.minzoom,t.maxzoom=s.maxzoom,t}function s(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]),e[r].layers&&t.push.apply(t,s(e[r].layers));return t}var i,a,o,n,l,u=this.stylesheet.constants,c=this.stylesheet.transition;this.orderedBuckets=[],this.buckets=t({},this.orderedBuckets,this.stylesheet.layers),this.dispatcher.broadcast("set buckets",this.orderedBuckets);var h=this.flattened=s(this.stylesheet.layers),d=this.layerMap={};for(i=0;i<h.length;i++){a=h[i];var f={};for(var y in a)"layers"!==y&&(f[y]=a[y]);d[a.id]=f,h[i]=f}for(i=0;i<h.length;i++)h[i]=r(d,h[i]);var p=this.processedPaintProps={};for(i=0;i<h.length;i++){a=h[i],o=a.id;var v=a.type;p[o]={};for(n in a)if(/^paint/.test(n)){var m=StyleConstant.resolve(a[n],u),w="paint"===n?"":n.slice(6),g=p[o][w]={};for(l in m){var S=l.match(/^(.*)-transition$/);S?(g[S[1]]||(g[S[1]]={}),g[S[1]].transition=m[l]):(g[l]||(g[l]={}),g[l].styleDeclaration=new StyleDeclaration(v,l,m[l]))}for(l in g)if(g[l].styleDeclaration){var _=g[l].transition,b={};b.duration=_&&_.duration>=0?_.duration:c&&c.duration>=0?c.duration:300,b.delay=_&&_.delay>=0?_.delay:c&&c.delay>=0?c.delay:0,g[l].transition=b}else delete g[l]}}this.layerGroups=this._groupLayers(this.stylesheet.layers),this.cascadeClasses(e)},cascadeClasses:function(e){if(this._loaded){e=e||{transition:!0};for(var t={},r=this.processedPaintProps,s=this.flattened,i=this.classes,a=0;a<s.length;a++){var o=s[a],n=o.id;t[n]={};for(var l in r[n])if(""===l||i[l]){var u=r[n][l];for(var c in u){var h=u[c].styleDeclaration,d=e.transition?u[c].transition:{duration:0,delay:0},f=this.transitions[n]&&this.transitions[n][c];if(f&&f.declaration.json===h.json)t[n][c]=f;else{var y=new StyleTransition(h,f,d);t[n][c]=y,y.instant()||(y.loopID=this.animationLoop.set(y.endTime-(new Date).getTime())),f&&this.animationLoop.cancel(f.loopID)}}}}this.transitions=t,this.fire("change")}},addSource:function(e,t){if(void 0!==this.sources[e])throw new Error("There is already a source with this ID");return this.sources[e]=t,t.id=e,t.style=this,t.dispatcher=this.dispatcher,t.glyphAtlas=this.glyphAtlas,t.on("load",this._forwardSourceEvent).on("error",this._forwardSourceEvent).on("change",this._forwardSourceEvent).on("tile.add",this._forwardTileEvent).on("tile.load",this._forwardTileEvent).on("tile.error",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent),this.fire("source.add",{source:t}),this},removeSource:function(e){if(void 0===this.sources[e])throw new Error("There is no source with this ID");var t=this.sources[e];return delete this.sources[e],t.off("load",this._forwardSourceEvent).off("error",this._forwardSourceEvent).off("change",this._forwardSourceEvent).off("tile.add",this._forwardTileEvent).off("tile.load",this._forwardTileEvent).off("tile.error",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent),this.fire("source.remove",{source:t}),this},getSource:function(e){return this.sources[e]},addClass:function(e,t){this.classes[e]||(this.classes[e]=!0,this.cascadeClasses(t))},removeClass:function(e,t){this.classes[e]&&(delete this.classes[e],this.cascadeClasses(t))},hasClass:function(e){return!!this.classes[e]},setClassList:function(e,t){this.classes={};for(var r=0;r<e.length;r++)this.classes[e[r]]=!0;this.cascadeClasses(t)},getClassList:function(){return Object.keys(this.classes)},getLayer:function(e){return this.layerMap[e]},featuresAt:function(e,t,r){var s=this,i=[],a=null;if(e=Point.convert(e),t.layer){var o=this.getLayer(t.layer);t.bucket=this.buckets[o.ref||o.id]}util.asyncEach(Object.keys(this.sources),function(r,o){var n=s.sources[r];n.featuresAt(e,t,function(e,t){t&&(i=i.concat(t)),e&&(a=e),o()})},function(){return a?r(a):(i.forEach(function(e){var t=e.layer;t.paint=s.computed[t.id],t.layout=new LayoutProperties[t.type](t.layout);var r=s.layerMap[t.id];Object.keys(r).forEach(function(e){t[e]||(t[e]=r[e])})}),void r(null,i))})},_remove:function(){this.dispatcher.remove()},_updateSources:function(e){for(var t in this.sources)this.sources[t].update(e)},_forwardSourceEvent:function(e){this.fire("source."+e.type,util.extend({source:e.target},e))},_forwardTileEvent:function(e){this.fire(e.type,util.extend({source:e.target},e))},"get sprite json":function(e,t){var r=this.sprite;r.loaded()?t(null,{sprite:r.data,retina:r.retina}):r.on("load",function(){t(null,{sprite:r.data,retina:r.retina})})},"get icons":function(e,t){var r=this.sprite,s=this.spriteAtlas;r.loaded()?(s.setSprite(r),s.addIcons(e.icons,t)):r.on("load",function(){s.setSprite(r),s.addIcons(e.icons,t)})},"get glyphs":function(e,t){this.glyphSource.getRects(e.fontstack,e.codepoints,e.id,t)}});
},{"../source/source":37,"../symbol/glyph_atlas":57,"../symbol/glyph_source":58,"../symbol/sprite_atlas":65,"../util/ajax":75,"../util/browser":76,"../util/dispatcher":78,"../util/evented":81,"../util/mapbox":83,"../util/util":86,"./image_sprite":46,"./layout_properties":47,"./paint_properties":48,"./style_constant":51,"./style_declaration":52,"./style_transition":53,"point-geometry":99}],51:[function(require,module,exports){
"use strict";var util=require("../util/util");module.exports.resolve=function(t,s){function r(t){return"string"==typeof t&&"@"===t[0]?s[t]:t}if(!s)return t;var i,e={};for(var o in t){var n=r(t[o]);if(Array.isArray(n))for(n=n.slice(),i=0;i<n.length;i++)n[i]in s&&(n[i]=r(n[i]));if(n.stops)for(n=util.extend({},n),n.stops=n.stops.slice(),i=0;i<n.stops.length;i++)n.stops[i][1]in s&&(n.stops[i]=[n.stops[i][0],r(n.stops[i][1])]);e[o]=n}return e};
},{"../util/util":86}],52:[function(require,module,exports){
"use strict";function StyleDeclaration(r,e,t){var o="paint_"+r,n=reference[o]&&reference[o][e];n&&(this.value=this.parseValue(t,n.type,n.values),this.prop=e,this.type=n.type,this.json=JSON.stringify(t))}function parseNumber(r){r.stops&&(r=stopsFn(r));var e=+r;return isNaN(e)?r:e}function parseNumberArray(r){var e=r.map(parseNumber);return function(r){for(var t=[],o=0;o<e.length;o++)t.push("function"==typeof e[o]?e[o](r):e[o]);return t}}function parseColor(r){if(r.stops)return stopsFn(r,!0);if(colorCache[r])return colorCache[r];var e=colorCache[r]=prepareColor(parseCSSColor(r));return e}function stopsFn(r,e){var t=r.stops,o=r.base||reference["function"].base["default"];return function(r){for(var n,a,i=0;i<t.length;i++){var u=t[i];if(u[0]<=r&&(n=u),u[0]>r){a=u;break}}if(n&&a){var p=a[0]-n[0],s=r-n[0],l=1===o?s/p:(Math.pow(o,s)-1)/(Math.pow(o,p)-1);return e?interpColor(parseColor(n[1]),parseColor(a[1]),l):util.interp(n[1],a[1],l)}return n?e?parseColor(n[1]):n[1]:a?e?parseColor(a[1]):a[1]:e?[0,0,0,1]:1}}function prepareColor(r){return[r[0]/255,r[1]/255,r[2]/255,r[3]/1]}function interpColor(r,e,t){return[util.interp(r[0],e[0],t),util.interp(r[1],e[1],t),util.interp(r[2],e[2],t),util.interp(r[3],e[3],t)]}var util=require("../util/util"),reference=require("./reference"),parseCSSColor=require("csscolorparser").parseCSSColor;module.exports=StyleDeclaration,StyleDeclaration.prototype.calculate=function(r){return"function"==typeof this.value?this.value(r):this.value},StyleDeclaration.prototype.parseValue=function(r,e,t){return"color"===e?parseColor(r):"number"===e?parseNumber(r):"boolean"===e?Boolean(r):"image"===e?String(r):"string"===e?String(r):"array"===e?parseNumberArray(r):"enum"===e&&Array.isArray(t)?t.indexOf(r)>=0?r:void 0:void console.warn(e+" is not a supported property type")};var colorCache={};
},{"../util/util":86,"./reference":49,"csscolorparser":87}],53:[function(require,module,exports){
"use strict";function StyleTransition(t,i,e){this.declaration=t,this.startTime=this.endTime=(new Date).getTime();var n=t.type;"number"===n?this.interp=util.interp:"color"===n?this.interp=interpColor:"array"===n&&(this.interp=interpNumberArray),this.oldTransition=i,this.duration=e.duration||0,this.delay=e.delay||0,this.instant()||(this.endTime=this.startTime+this.duration+this.delay,this.ease=util.easeCubicInOut),i&&i.endTime<=this.startTime&&delete i.oldTransition}function interpNumberArray(t,i,e){return t.map(function(t,n){return util.interp(t,i[n],e)})}function interpColor(t,i,e){return[util.interp(t[0],i[0],e),util.interp(t[1],i[1],e),util.interp(t[2],i[2],e),util.interp(t[3],i[3],e)]}var util=require("../util/util");module.exports=StyleTransition,StyleTransition.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},StyleTransition.prototype.at=function(t,i){var e=this.declaration.calculate(t);if(this.instant())return e;if(i=i||Date.now(),i<this.endTime){var n=this.oldTransition.at(t,this.startTime),r=this.ease((i-this.startTime-this.delay)/this.duration);e=this.interp(n,e,r)}return e};
},{"../util/util":86}],54:[function(require,module,exports){
"use strict";function Anchor(t,e,o,n,i){this.x=t,this.y=e,this.angle=o,this.scale=n,void 0!==i&&(this.segment=i)}var Point=require("point-geometry");module.exports=Anchor,Anchor.prototype=Object.create(Point.prototype),Anchor.prototype.clone=function(){return new Anchor(this.x,this.y,this.angle,this.scale,this.segment)};
},{"point-geometry":99}],55:[function(require,module,exports){
"use strict";function BinPack(e,h){this.width=e,this.height=h,this.free=[{x:0,y:0,w:e,h:h}]}module.exports=BinPack,BinPack.prototype.release=function(e){for(var h=0;h<this.free.length;h++){var i=this.free[h];if(i.y==e.y&&i.h==e.h&&i.x+i.w==e.x)i.w+=e.w;else if(i.x==e.x&&i.w==e.w&&i.y+i.h==e.y)i.h+=e.h;else if(e.y==i.y&&e.h==i.h&&e.x+e.w==i.x)i.x=e.x,i.w+=e.w;else{if(e.x!=i.x||e.w!=i.w||e.y+e.h!=i.y)continue;i.y=e.y,i.h+=e.h}return this.free.splice(h,1),void this.release(i)}this.free.push(e)},BinPack.prototype.allocate=function(e,h){for(var i={x:1/0,y:1/0,w:1/0,h:1/0},t=-1,s=0;s<this.free.length;s++){var r=this.free[s];e<=r.w&&h<=r.h&&r.y<=i.y&&r.x<=i.x&&(i=r,t=s)}return 0>t?{x:-1,y:-1}:(this.free.splice(t,1),i.w<i.h?(i.w>e&&this.free.push({x:i.x+e,y:i.y,w:i.w-e,h:h}),i.h>h&&this.free.push({x:i.x,y:i.y+h,w:i.w,h:i.h-h})):(i.w>e&&this.free.push({x:i.x+e,y:i.y,w:i.w-e,h:i.h}),i.h>h&&this.free.push({x:i.x,y:i.y+h,w:e,h:i.h-h})),{x:i.x,y:i.y,w:e,h:h})};
},{}],56:[function(require,module,exports){
"use strict";function Collision(a,e,t,n){this.hTree=rbush(),this.cTree=rbush(),this.tilePixelRatio=e/t,this.zoom=a,n=Math.min(3,n||1,25.5-this.zoom),this.maxPlacementScale=Math.exp(Math.LN2*n);var o=4096,i=o*this.tilePixelRatio*2,h=[2*Math.PI,0];this.left={anchor:new Point(0,0),box:{x1:-i,y1:-i,x2:0,y2:i},placementRange:h,placementScale:.5,maxScale:1/0,padding:0},this.top={anchor:new Point(0,0),box:{x1:-i,y1:-i,x2:i,y2:0},placementRange:h,placementScale:.5,maxScale:1/0,padding:0},this.bottom={anchor:new Point(o,o),box:{x1:-i,y1:0,x2:i,y2:i},placementRange:h,placementScale:.5,maxScale:1/0,padding:0},this.right={anchor:new Point(o,o),box:{x1:0,y1:-i,x2:i,y2:i},placementRange:h,placementScale:.5,maxScale:1/0,padding:0}}var rbush=require("rbush"),rotationRange=require("./rotation_range"),Point=require("point-geometry");module.exports=Collision,Collision.prototype.getPlacementScale=function(a,e,t){for(var n=this.left,o=this.right,i=this.top,h=this.bottom,r=0;r<a.length;r++){var x=a[r],l=x.box,c=x.hBox||l,m=x.anchor,s=x.padding,p=Math.max(e,x.minScale),y=x.maxScale||1/0;if(!(p>=y)){var g=this.getBox(m,c,p,y),u=this.hTree.search(g).concat(this.cTree.search(g));if(t&&(g[0]<0&&u.push(n),g[1]<0&&u.push(i),g[2]>=4096&&u.push(o),g[3]>=4096&&u.push(h)),u.length)for(var S=m,d=l,M=0;M<u.length;M++){var b=u[M].anchor,f=u[M].box;if(S.equals(b))return null;var v=8*Math.max(s,u[M].padding),P=(f.x1-d.x2-v)/(S.x-b.x),R=(f.x2-d.x1+v)/(S.x-b.x),B=(f.y1-d.y2-v)/(S.y-b.y),N=(f.y2-d.y1+v)/(S.y-b.y);(isNaN(P)||isNaN(R))&&(P=R=1),(isNaN(B)||isNaN(N))&&(B=N=1);var T=Math.min(Math.max(P,R),Math.max(B,N));if(T>e&&T>p&&y>T&&T<u[M].maxScale&&(e=T),e>this.maxPlacementScale)return null}}}return e},Collision.prototype.getPlacementRange=function(a,e,t){for(var n=[2*Math.PI,0],o=0;o<a.length;o++){var i=a[o],h=i.hBox||i.box,r=i.anchor,x=r.x+h.x1/e,l=r.y+h.y1/e,c=r.x+h.x2/e,m=r.y+h.y2/e,s=[x,l,c,m],p=this.hTree.search(s);t&&(p=p.concat(this.cTree.search(s)));for(var y=0;y<p.length;y++){var g,u,S,d,M,b,f=p[y],v=f.hBox||f.box;if(e>f.placementScale?(g=f.anchor.x+v.x1/e,S=f.anchor.y+v.y1/e,u=f.anchor.x+v.x2/e,d=f.anchor.y+v.y2/e,M=c>g&&u>x,b=m>S&&d>l):(g=r.x+h.x1/f.placementScale,S=r.y+h.y1/f.placementScale,u=r.x+h.x2/f.placementScale,d=r.y+h.y2/f.placementScale,M=g<f[2]&&u>f[0],b=S<f[3]&&d>f[1]),M&&b){var P=Math.max(e,f.placementScale),R=rotationRange.rotationRange(i,f,P);n[0]=Math.min(n[0],R[0]),n[1]=Math.max(n[1],R[1])}}}return n},Collision.prototype.insert=function(a,e,t,n,o){for(var i=[],h=0;h<a.length;h++){var r=a[h],x=r.hBox||r.box,l=Math.max(t,r.minScale),c=r.maxScale||1/0,m=this.getBox(e,x,l,c);m.anchor=e,m.box=r.box,r.hBox&&(m.hBox=x),m.placementRange=n,m.placementScale=l,m.maxScale=c,m.padding=r.padding,i.push(m)}(o?this.hTree:this.cTree).load(i)},Collision.prototype.getBox=function(a,e,t,n){return[a.x+Math.min(e.x1/t,e.x1/n),a.y+Math.min(e.y1/t,e.y1/n),a.x+Math.max(e.x2/t,e.x2/n),a.y+Math.max(e.y2/t,e.y2/n)]};
},{"./rotation_range":63,"point-geometry":99,"rbush":100}],57:[function(require,module,exports){
"use strict";function GlyphAtlas(t,i){this.width=t,this.height=i,this.bin=new BinPack(t,i),this.index={},this.ids={},this.data=new Uint8Array(t*i)}var BinPack=require("./bin_pack");module.exports=GlyphAtlas,GlyphAtlas.prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},GlyphAtlas.prototype.getGlyphs=function(){var t,i,e,s={};for(var h in this.ids)t=h.split("#"),i=t[0],e=t[1],s[i]||(s[i]=[]),s[i].push(e);return s},GlyphAtlas.prototype.getRects=function(){var t,i,e,s={};for(var h in this.ids)t=h.split("#"),i=t[0],e=t[1],s[i]||(s[i]={}),s[i][e]=this.index[h];return s},GlyphAtlas.prototype.removeGlyphs=function(t){for(var i in this.ids){var e=this.ids[i],s=e.indexOf(t);if(s>=0&&e.splice(s,1),this.ids[i]=e,!e.length){for(var h=this.index[i],a=this.data,r=0;r<h.h;r++)for(var n=this.width*(h.y+r)+h.x,d=0;d<h.w;d++)a[n+d]=0;this.dirty=!0,this.bin.release(h),delete this.index[i],delete this.ids[i]}}this.updateTexture(this.gl)},GlyphAtlas.prototype.addGlyph=function(t,i,e,s){if(!e)return null;var h=i+"#"+e.id;if(this.index[h])return this.ids[h].indexOf(t)<0&&this.ids[h].push(t),this.index[h];if(!e.bitmap)return null;var a=e.width+2*s,r=e.height+2*s,n=a,d=r;n+=4-n%4,d+=4-d%4;var l=this.bin.allocate(n,d);if(l.x<0)return console.warn("glyph bitmap overflow"),{glyph:e,rect:null};l.l=e.left,l.t=e.top,this.index[h]=l,this.ids[h]=[t];for(var o=this.data,c=e.bitmap,p=0;r>p;p++)for(var u=this.width*(l.y+p)+l.x,x=a*p,E=0;a>E;E++)o[u+E]=c[x+E];return this.dirty=!0,l},GlyphAtlas.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},GlyphAtlas.prototype.updateTexture=function(t){if(this.bind(t),this.dirty){if(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.ctx){for(var i=this.ctx.getImageData(0,0,this.width,this.height),e=0,s=0;e<this.data.length;e++,s+=4)i.data[s]=this.data[e],i.data[s+1]=this.data[e],i.data[s+2]=this.data[e],i.data[s+3]=255;this.ctx.putImageData(i,0,0),this.ctx.strokeStyle="red";for(var h=0;h<this.bin.free.length;h++){var a=this.bin.free[h];this.ctx.strokeRect(a.x,a.y,a.w,a.h)}}this.dirty=!1}};
},{"./bin_pack":55}],58:[function(require,module,exports){
"use strict";function GlyphSource(t,r){this.url=t&&normalizeURL(t),this.glyphAtlas=r,this.stacks={},this.loading={}}function simpleGlyph(t){return{advance:t.advance,left:t.left,top:t.top}}function glyphUrl(t,r,e,l){return l=l||"abc",e.replace("{s}",l[t.length%l.length]).replace("{fontstack}",t).replace("{range}",r)}var normalizeURL=require("../util/mapbox").normalizeGlyphsURL,getArrayBuffer=require("../util/ajax").getArrayBuffer,Glyphs=require("../util/glyphs"),Protobuf=require("pbf");module.exports=GlyphSource,GlyphSource.prototype.getRects=function(t,r,e,l){var a=this;void 0===this.stacks[t]&&(this.stacks[t]={});for(var s,i={},o={},h={rects:i,glyphs:o},n=this.stacks[t],p=this.glyphAtlas,u={},f=0,c=0;c<r.length;c++){var y=r[c];if(s=Math.floor(y/256),n[s]){var g=n[s].glyphs[y],d=3;i[y]=p.addGlyph(e,t,g,d),g&&(o[y]=simpleGlyph(g))}else void 0===u[s]&&(u[s]=[],f++),u[s].push(y)}f||l(void 0,h);var v=function(r,s,n){if(!r)for(var c=a.stacks[t][s]=n.stacks[t],y=0;y<u[s].length;y++){var g=u[s][y],d=c.glyphs[g],v=3;i[g]=p.addGlyph(e,t,d,v),d&&(o[g]=simpleGlyph(d))}f--,f||l(void 0,h)};for(var G in u)this.loadRange(t,G,v)},GlyphSource.prototype.loadRange=function(t,r,e){if(256*r>=65280)return e("gyphs > 65280 not supported");void 0===this.loading[t]&&(this.loading[t]={});var l=this.loading[t];if(l[r])l[r].push(e);else{l[r]=[e];var a=256*r+"-"+(256*r+255),s=glyphUrl(t,a,this.url);getArrayBuffer(s,function(t,e){for(var a=!t&&new Glyphs(new Protobuf(new Uint8Array(e))),s=0;s<l[r].length;s++)l[r][s](t,r,a);delete l[r]})}};
},{"../util/ajax":75,"../util/glyphs":82,"../util/mapbox":83,"pbf":97}],59:[function(require,module,exports){
"use strict";function interpolate(r,e,i,n,a,t){void 0===i&&(i=0),n=Math.round(Math.max(Math.min(8,n/2),1)),e*=a/n;for(var l=minScaleArrays[n],o=l.length,u=0,c=0,m=t||0,h=[],s=0;s<r.length-1;s++){for(var S=r[s],p=r[s+1],v=S.dist(p),y=p.angleTo(S);u+v>c+e;){c+=e;var d=(c-u)/v,x=util.interp(S.x,p.x,d),A=util.interp(S.y,p.y,d),f=l[m%o];x>=0&&4096>x&&A>=0&&4096>A&&h.push(new Anchor(x,A,y,f,s)),m++}u+=v}return h}var util=require("../util/util"),Anchor=require("../symbol/anchor");module.exports=interpolate;var minScale=.5,minScaleArrays={1:[minScale],2:[minScale,2],4:[minScale,4,2,4],8:[minScale,8,4,8,2,8,4,8]};
},{"../symbol/anchor":54,"../util/util":86}],60:[function(require,module,exports){
"use strict";function getIcon(a,t,e,n,x){var i=t.w/2,l=t.h/2,h=x["icon-offset"][0],o=x["icon-offset"][1],m=h-i,r=h+i,c=o-l,y=o+l,s=new Point(m,c),M=new Point(r,c),g=new Point(r,y),f=new Point(m,y),S=x["icon-rotate"]*Math.PI/180;if(void 0!==a.segment&&"viewport"!==x["icon-rotation-alignment"]){var p=n[a.segment];S+=-Math.atan2(p.x-a.x,p.y-a.y)+Math.PI/2}if(S){var u=Math.sin(S),v=Math.cos(S),d=[v,-u,u,v];s=s.matMult(d),M=M.matMult(d),f=f.matMult(d),g=g.matMult(d),m=Math.min(s.x,M.x,f.x,g.x),r=Math.max(s.x,M.x,f.x,g.x),c=Math.min(s.y,M.y,f.y,g.y),y=Math.max(s.y,M.y,f.y,g.y)}var P={x1:m*e,x2:r*e,y1:c*e,y2:y*e},b={box:P,anchor:a,minScale:minScale,maxScale:1/0,padding:x["icon-padding"]},I={tl:s,tr:M,br:g,bl:f,tex:t,angle:0,anchor:a,minScale:minScale,maxScale:1/0};return{shapes:[I],boxes:[b],minScale:a.scale}}function getGlyphs(a,t,e,n,x,i,l,h){for(var o=h["text-max-angle"]*Math.PI/180,m=h["text-rotate"]*Math.PI/180,r=h["text-padding"],c="viewport"!==h["text-rotation-alignment"],y=h["text-keep-upright"],s=[],M=[],g=3,f=0;f<e.length;f++){var S=e[f],p=n[S.fontstack],u=p.glyphs[S.glyph],v=p.rects[S.glyph];if(u&&v&&v.w>0&&v.h>0){var d,P=(t.x+S.x+u.left-g+v.w/2)*x;void 0!==a.segment&&c?(d=[],getSegmentGlyphs(d,a,P,l,a.segment,1,o),y&&getSegmentGlyphs(d,a,P,l,a.segment,-1,o)):d=[{anchor:a,offset:0,angle:0,maxScale:1/0,minScale:minScale}];for(var b=t.x+S.x+u.left-g,I=t.y+S.y-u.top-g,w=b+v.w,G=I+v.h,k=new Point(b,I),q=new Point(w,I),B=new Point(b,G),_=new Point(w,G),j={x1:x*b,y1:x*I,x2:x*w,y2:x*G},z=0;z<d.length;z++){var A=d[z],C=k,D=q,E=B,F=_,H=j,J=A.angle+m;if(J){var K=Math.sin(J),L=Math.cos(J),N=[L,-K,K,L];C=C.matMult(N),D=D.matMult(N),E=E.matMult(N),F=F.matMult(N)}var O=Math.max(A.minScale,a.scale);s.push({tl:C,tr:D,bl:E,br:F,tex:v,angle:(a.angle+m+A.offset+2*Math.PI)%(2*Math.PI),anchor:A.anchor,minScale:O,maxScale:A.maxScale}),A.offset||(J&&(H={x1:x*Math.min(C.x,D.x,E.x,F.x),y1:x*Math.min(C.y,D.y,E.y,F.y),x2:x*Math.max(C.x,D.x,E.x,F.x),y2:x*Math.max(C.y,D.y,E.y,F.y)}),M.push({box:H,anchor:A.anchor,minScale:O,maxScale:A.maxScale,padding:r}))}}}i&&(M=[getMergedBoxes(M,a)]);for(var Q=a.scale,R=1/0,T=0;T<M.length;T++)R=Math.min(R,M[T].minScale);return R=Math.max(Q,minScale),{boxes:M,shapes:s,minScale:R}}function getSegmentGlyphs(a,t,e,n,x,i,l){var h=0>i;0>e&&(i*=-1),i>0&&x++;var o,m=t,r=n[x],c=1/0;e=Math.abs(e);var y=t.scale;a:for(;;){var s=m.dist(r),M=e/s,g=-Math.atan2(r.x-m.x,r.y-m.y)+i*Math.PI/2;h&&(g+=Math.PI);var f=(g-o)%(2*Math.PI);if(o&&Math.abs(f)>l){t.scale=c;break}if(a.push({anchor:m,offset:h?Math.PI:0,minScale:M,maxScale:c,angle:(g+2*Math.PI)%(2*Math.PI)}),y>=M)break;for(m=r;m.equals(r);)if(x+=i,r=n[x],!r){t.scale=M;break a}var S=r.sub(m)._unit();m=m.sub(S._mult(s)),c=M,o=g}}function getMergedBoxes(a,t){for(var e={box:{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0},anchor:t,minScale:0,padding:-1/0},n=e.box,x=0;x<a.length;x++){var i=a[x].box;n.x1=Math.min(n.x1,i.x1),n.y1=Math.min(n.y1,i.y1),n.x2=Math.max(n.x2,i.x2),n.y2=Math.max(n.y2,i.y2),e.minScale=Math.max(e.minScale,a[x].minScale),e.padding=Math.max(e.padding,a[x].padding)}var l=n.x1*n.x1,h=n.y1*n.y1,o=n.x2*n.x2,m=n.y2*n.y2,r=Math.sqrt(Math.max(l+h,l+m,o+h,o+m));return e.hBox={x1:-r,y1:-r,x2:r,y2:r},e}var Point=require("point-geometry");module.exports={getIcon:getIcon,getGlyphs:getGlyphs};var minScale=.5;
},{"point-geometry":99}],61:[function(require,module,exports){
"use strict";function resolveIcons(e,r){for(var o=[],s=0,n=e.length;n>s;s++){var t=resolveTokens(e[s].properties,r["icon-image"]);t&&o.indexOf(t)<0&&o.push(t)}return o}var resolveTokens=require("../util/token");module.exports=resolveIcons;
},{"../util/token":85}],62:[function(require,module,exports){
"use strict";function resolveText(e,r,t){for(var o=[],s=[],n=0,u=e.length;u>n;n++){var a=resolveTokens(e[n].properties,r["text-field"]),i=!1;if(a){a=a.toString();var l=r["text-transform"];"uppercase"===l?a=a.toLocaleUpperCase():"lowercase"===l&&(a=a.toLocaleLowerCase());for(var c=0,v=a.length;v>c;c++)a.charCodeAt(c)<=65533&&(s.push(a.charCodeAt(c)),i=!0);i&&(o[n]=a)}}return s=uniq(s,t),{textFeatures:o,codepoints:s}}function uniq(e,r){var t,o=[];e.sort(sortNumbers);for(var s=0;s<e.length;s++)e[s]!==t&&(t=e[s],r[t]||o.push(e[s]));return o}function sortNumbers(e,r){return e-r}var resolveTokens=require("../util/token");module.exports=resolveText;
},{"../util/token":85}],63:[function(require,module,exports){
"use strict";function rotationRange(o,n,t){var i,r,e=o,a=n,s=new Point((a.anchor.x-e.anchor.x)*t,(a.anchor.y-e.anchor.y)*t);return e.hBox&&a.hBox?i=rotatingRotatingCollisions(e.box,a.box,s):e.hBox?(r={x1:a.box.x1+s.x,y1:a.box.y1+s.y,x2:a.box.x2+s.x,y2:a.box.y2+s.y},i=rotatingFixedCollisions(e.box,r)):a.hBox?(r={x1:e.box.x1-s.x,y1:e.box.y1-s.y,x2:e.box.x2-s.x,y2:e.box.y2-s.y},i=rotatingFixedCollisions(a.box,r)):i=[],mergeCollisions(i,n.placementRange)}function mergeCollisions(o,n){for(var t=2*Math.PI,i=0,r=0;r<o.length;r++){var e=o[r],a=n[0]<=e[0]&&e[0]<=n[1],s=n[0]<=e[1]&&e[1]<=n[1];a&&s||(a?(t=Math.min(t,n[1]),i=Math.max(i,e[1])):s?(t=Math.min(t,e[0]),i=Math.max(i,n[0])):(t=Math.min(t,e[0]),i=Math.max(i,e[1])))}return[t,i]}function rotatingRotatingCollisions(o,n,t){var i,r=t.mag(),e=t.angleWith(horizontal),a=[],s=[];a[0]=Math.asin((o.y2-n.y1)/r),a[1]=Math.asin((o.y2-n.y1)/r)+Math.PI,a[2]=2*Math.PI-Math.asin((-o.y1+n.y2)/r),a[3]=Math.PI-Math.asin((-o.y1+n.y2)/r),a[4]=2*Math.PI-Math.acos((o.x2-n.x1)/r),a[5]=Math.acos((o.x2-n.x1)/r),a[6]=Math.PI-Math.acos((-o.x1+n.x2)/r),a[7]=Math.PI+Math.acos((-o.x1+n.x2)/r);var x=o.x2-n.x1,l=-o.x1+n.x2,h=o.y2-n.y1,g=-o.y1+n.y2,y=[];for(y[0]=x*x+h*h,y[1]=l*l+h*h,y[2]=x*x+g*g,y[3]=l*l+g*g,y[4]=x*x+h*h,y[5]=x*x+g*g,y[6]=l*l+g*g,y[7]=l*l+h*h,a=a.filter(function(o,n){return!isNaN(o)&&r*r<=y[n]}).map(function(o){return(o+e+2*Math.PI)%(2*Math.PI)}),a.sort(),i=0;i<a.length;i+=2)s.push([a[i],a[i+1]]);return s}function rotatingFixedCollisions(o,n){for(var t=getCorners(o),i=getCorners(n),r=[],e=0;4>e;e++)cornerBoxCollisions(r,t[e],i),cornerBoxCollisions(r,i[e],t,!0);return r}function cornerBoxCollisions(o,n,t,i){for(var r=n.mag(),e=[],a=0,s=3;4>a;s=a++)circleEdgeCollisions(e,n,r,t[s],t[a]);if(e.length%2!==0)throw"expecting an even number of intersections";e.sort();for(var x=0;x<e.length;x+=2)o[x/2]=i?[2*Math.PI-e[x+1],2*Math.PI-e[x]]:[e[x],e[x+1]];return o}function circleEdgeCollisions(o,n,t,i,r){var e=r.x-i.x,a=r.y-i.y,s=e*e+a*a,x=2*(e*i.x+a*i.y),l=i.x*i.x+i.y*i.y-t*t,h=x*x-4*s*l;if(h>0){var g=(-x-Math.sqrt(h))/(2*s),y=(-x+Math.sqrt(h))/(2*s);g>0&&1>g&&o.push(getAngle(i,r,g,n)),y>0&&1>y&&o.push(getAngle(i,r,y,n))}return o}function getAngle(o,n,t,i){return(-i.angleWithSep(util.interp(o.x,n.x,t),util.interp(o.y,n.y,t))+2*Math.PI)%(2*Math.PI)}function getCorners(o){return[new Point(o.x1,o.y1),new Point(o.x1,o.y2),new Point(o.x2,o.y2),new Point(o.x2,o.y1)]}var util=require("../util/util"),Point=require("point-geometry");module.exports={rotationRange:rotationRange,mergeCollisions:mergeCollisions,rotatingFixedCollisions:rotatingFixedCollisions,rotatingRotatingCollisions:rotatingRotatingCollisions,cornerBoxCollisions:cornerBoxCollisions,circleEdgeCollisions:circleEdgeCollisions,getCorners:getCorners};var horizontal=new Point(1,0);
},{"../util/util":86,"point-geometry":99}],64:[function(require,module,exports){
"use strict";function shape(n,a,e,r,l,t,i,h,f,u){for(var o,g,s=e[a].glyphs,p=[],v=u[0],x=u[1],y=0;y<n.length;y++)g=n.charCodeAt(y),o=s[g],0!==g&&o&&(p.push({fontstack:a,glyph:g,x:v,y:x}),v+=o.advance+f);return p.length?p=linewrap(p,s,l,r,t,i,h):!1}function linewrap(n,a,e,r,l,t,i){var h=null,f=0,u=0,o=0,g=0;if(r)for(var s=0;s<n.length;s++){var p=n[s];if(p.x-=f,p.y+=e*o,p.x>r&&null!==h){var v=n[h+1].x;g=Math.max(v,g);for(var x=h+1;s>=x;x++)n[x].y+=e,n[x].x-=v;i&&justifyLine(n,a,u,h-1,i),u=h+1,h=null,f+=v,o++}breakable[p.glyph]&&(h=s)}return g=g||n[n.length-1].x,justifyLine(n,a,u,n.length-1,i),align(n,i,l,t,g,e,o),n}function justifyLine(n,a,e,r,l){for(var t=a[n[r].glyph].advance,i=(n[r].x+t)*l,h=e;r>=h;h++)n[h].x-=i}function align(n,a,e,r,l,t,i){for(var h=(a-e)*l,f=(-r*(i+1)+.5)*t,u=0;u<n.length;u++)n[u].x+=h,n[u].y+=f}module.exports={shape:shape};var breakable={32:!0};
},{}],65:[function(require,module,exports){
"use strict";function SpriteAtlas(t,i){this.width=t,this.height=i,this.bin=new BinPack(t,i),this.images={},this.data=!1,this.texture=0,this.filter=0,this.buffer=1,this.pixelRatio=1,this.dirty=!0}function copy_bitmap(t,i,e,h,a,s,r,o,n,l){for(var p=h*i+e,d=o*s+r,c=0;l>c;c++,p+=i,d+=s)for(var x=0;n>x;x++)a[d+x]=t[p+x]}var BinPack=require("./bin_pack");module.exports=SpriteAtlas,SpriteAtlas.prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.canvas.style.width=this.width+"px",this.canvas.style.width=this.width+"px",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},SpriteAtlas.prototype.resize=function(t){if(this.pixelRatio==t)return!1;var i=this.pixelRatio;if(this.pixelRatio=t,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio),this.data){var e=this.data;this.data=!1,this.allocate(),this.texture=!1;for(var h=this.width*i,a=this.height*i,s=this.width*t,r=this.height*t,o=this.data,n=e,l=0;r>l;l++)for(var p=Math.floor(l*a/r)*h,d=l*s,c=0;s>c;c++){var x=Math.floor(c*h/s);o[d+c]=n[p+x]}e=null,this.dirty=!0}return this.dirty},SpriteAtlas.prototype.allocateImage=function(t,i){var e=t+(4-t%4),h=i+(4-t%4),a=this.bin.allocate(e,h);return 0===a.w?a:(a.x+=this.buffer,a.y+=this.buffer,a)},SpriteAtlas.prototype.getImage=function(t){if(this.images[t])return this.images[t];if(!this.sprite)return null;var i=this.sprite.getSpritePosition(t);if(!i.width||!i.height)return null;var e=this.allocateImage(i.width/i.pixelRatio,i.height/i.pixelRatio);return 0===e.w?e:(e.sdf=i.sdf,this.images[t]=e,this.copy(e,i),e)},SpriteAtlas.prototype.getPosition=function(t,i){var e=this.getImage(t);if(!e)return null;if(i){var h=this.sprite.getSpritePosition(t);if(!h.width||!h.height)return null;e.w=h.width/h.pixelRatio,e.h=h.height/h.pixelRatio}return{size:[e.w,e.h],tl:[e.x/this.width,e.y/this.height],br:[(e.x+e.w)/this.width,(e.y+e.h)/this.height]}},SpriteAtlas.prototype.allocate=function(){if(!this.data){var t=Math.floor(this.width*this.pixelRatio),i=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(t*i);for(var e=0;e<this.data.length;e++)this.data[e]=0}},SpriteAtlas.prototype.copy=function(t,i){if(this.sprite.img.data){var e=new Uint32Array(this.sprite.img.data.buffer);this.allocate();var h=this.data;copy_bitmap(e,this.sprite.img.width,i.x,i.y,h,this.width*this.pixelRatio,t.x*this.pixelRatio,t.y*this.pixelRatio,i.width,i.height),this.dirty=!0}},SpriteAtlas.prototype.setSprite=function(t){this.sprite=t},SpriteAtlas.prototype.addIcons=function(t,i){for(var e=0;e<t.length;e++)this.getImage(t[e]);i(null,this.images)},SpriteAtlas.prototype.bind=function(t,i){var e=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e=!0);var h=i?t.LINEAR:t.NEAREST;if(h!=this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,h),this.filter=h),this.dirty&&(this.allocate(),e?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1,this.ctx)){var a=this.ctx.getImageData(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio);a.data.set(new Uint8ClampedArray(this.data.buffer)),this.ctx.putImageData(a,0,0),this.ctx.strokeStyle="red";for(var s=0;s<this.bin.free.length;s++){var r=this.bin.free[s];this.ctx.strokeRect(r.x*this.pixelRatio,r.y*this.pixelRatio,r.w*this.pixelRatio,r.h*this.pixelRatio)}}};
},{"./bin_pack":55}],66:[function(require,module,exports){
"use strict";function Attribution(){}var Control=require("./control"),DOM=require("../../util/dom"),util=require("../../util/util");module.exports=Attribution,Attribution.prototype=util.inherit(Control,{onAdd:function(t){var i="mapboxgl-ctrl-attrib",e=this._container=DOM.create("div",i,t.container);return this._update(),t.on("source.add",this._update.bind(this)),t.on("source.change",this._update.bind(this)),t.on("source.remove",this._update.bind(this)),t.on("moveend",this._updateEditLink.bind(this)),e},_update:function(){var t={};for(var i in this._map.sources){var e=this._map.sources[i];e.attribution&&(t[e.attribution]=!0)}var n=[];for(var r in t)n.push(r);this._container.innerHTML=n.join(" | "),this._editLink=this._container.getElementsByClassName("mapbox-improve-map")[0],this._updateEditLink()},_updateEditLink:function(){if(this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}}});
},{"../../util/dom":80,"../../util/util":86,"./control":67}],67:[function(require,module,exports){
"use strict";function Control(){}module.exports=Control,Control.prototype={addTo:function(t){return this._map=t,this._container=this.onAdd(t),this.opts&&this.opts.position&&(this._container.className+=" mapboxgl-ctrl-"+this.opts.position),this},remove:function(){return this._container.parentNode.removeChild(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this}};
},{}],68:[function(require,module,exports){
"use strict";function Navigation(t){this.opts=t||{}}var Control=require("./control"),DOM=require("../../util/dom"),util=require("../../util/util");module.exports=Navigation,Navigation.prototype=util.inherit(Control,{onAdd:function(t){this.opts.position||(this.opts.position="topright");var o="mapboxgl-ctrl-nav",e=this._container=DOM.create("div",o,t.container);this._zoomInButton=this._createButton(o+"-zoom-in",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(o+"-zoom-out",t.zoomOut.bind(t)),this._compass=this._createButton(o+"-compass",t.resetNorth.bind(t));var s=this._compassCanvas=DOM.create("canvas",o+"-compass-canvas",this._compass);return s.style.cssText="width:26px; height:26px;",s.width=52,s.height=52,this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._compassCtx=s.getContext("2d"),t.on("rotate",this._drawNorth.bind(this)),this._drawNorth(),e},_onCompassDown:function(t){DOM.disableDrag(),document.addEventListener("mousemove",this._onCompassMove),document.addEventListener("mouseup",this._onCompassUp),this._prevX=t.screenX,t.stopPropagation()},_onCompassMove:function(t){var o=t.screenX,e=2>o?-5:o>window.screen.width-2?5:(o-this._prevX)/4;this._map.setBearing(this._map.getBearing()-e),this._prevX=t.screenX,t.preventDefault()},_onCompassUp:function(){document.removeEventListener("mousemove",this._onCompassMove),document.removeEventListener("mouseup",this._onCompassUp),DOM.enableDrag()},_createButton:function(t,o){var e=DOM.create("a",t,this._container);return e.href="#",e.addEventListener("click",function(t){o(),t.preventDefault(),t.stopPropagation()}),e.addEventListener("dblclick",function(t){t.preventDefault(),t.stopPropagation()}),e},_drawNorth:function(){var t=20,o=8,e=26,s=this._map.transform.angle+Math.PI/2,i=this._compassCtx;this._compassCanvas.width=this._compassCanvas.width,i.translate(e,e),i.rotate(s),i.beginPath(),i.fillStyle="#000",i.lineTo(0,-o),i.lineTo(-t,0),i.lineTo(0,o),i.fill(),i.beginPath(),i.fillStyle="#bbb",i.moveTo(0,0),i.lineTo(0,o),i.lineTo(t,0),i.lineTo(0,-o),i.fill(),i.beginPath(),i.strokeStyle="#fff",i.lineWidth=4,i.moveTo(0,-o),i.lineTo(0,o),i.stroke()}});
},{"../../util/dom":80,"../../util/util":86,"./control":67}],69:[function(require,module,exports){
"use strict";var util=require("../util/util"),browser=require("../util/browser"),LatLng=require("../geo/lat_lng"),LatLngBounds=require("../geo/lat_lng_bounds"),Point=require("point-geometry");util.extend(exports,{isEasing:function(){return!!this._abortFn},stop:function(){return this._abortFn&&(this._abortFn.call(this),delete this._abortFn,this._finishFn.call(this),delete this._finishFn),this},_ease:function(t,i,e){this._finishFn=i,this._abortFn=browser.timed(function(i){t.call(this,e.easing(i)),1===i&&(delete this._abortFn,this._finishFn.call(this),delete this._finishFn)},e.animate===!1?0:e.duration,this)},panBy:function(t,i){return this.panTo(this.transform.center,util.extend({offset:Point.convert(t).mult(-1)},i)),this},panTo:function(t,i){this.stop(),t=LatLng.convert(t),i=util.extend({duration:500,easing:util.ease,offset:[0,0]},i);var e=this.transform,n=Point.convert(i.offset).rotate(-e.angle),o=e.point,r=e.project(t).sub(n);return i.noMoveStart||this.fire("movestart"),this._ease(function(t){e.center=e.unproject(o.add(r.sub(o).mult(t))),this._move()},function(){this.fire("moveend")},i),this},zoomTo:function(t,i){var e=this;this.stop(),i=util.extend({duration:500},i),i.easing=this._updateEasing(i.duration,t,i.easing);var n=this.transform,o=n.center,r=n.zoom;return i.around?o=LatLng.convert(i.around):i.offset&&(o=n.pointLocation(n.centerPoint.add(Point.convert(i.offset)))),i.animate===!1&&(i.duration=0),this.zooming||(this.zooming=!0,this.fire("movestart")),this._ease(function(i){n.setZoomAround(util.interp(r,t,i),o),this.animationLoop.set(300),this._move(!0)},function(){this.ease=null,i.duration>=200&&(this.zooming=!1,this.fire("moveend"))},i),i.duration<200&&(clearTimeout(this._onZoomEnd),this._onZoomEnd=setTimeout(function(){e.zooming=!1,e._rerender(),e.fire("moveend")},200)),this},zoomIn:function(t){this.zoomTo(this.getZoom()+1,t)},zoomOut:function(t){this.zoomTo(this.getZoom()-1,t)},rotateTo:function(t,i){this.stop(),i=util.extend({duration:500,easing:util.ease},i);var e=this.transform,n=this.getBearing(),o=e.center;return i.around?o=LatLng.convert(i.around):i.offset&&(o=e.pointLocation(e.centerPoint.add(Point.convert(i.offset)))),t=this._normalizeBearing(t,n),this.rotating=!0,this.fire("movestart"),this._ease(function(i){e.setBearingAround(util.interp(n,t,i),o),this._move(!1,!0)},function(){this.rotating=!1,this.fire("moveend")},i),this},resetNorth:function(t){return this.rotateTo(0,util.extend({duration:1e3},t))},fitBounds:function(t,i){i=util.extend({padding:0,offset:[0,0],maxZoom:1/0},i),t=LatLngBounds.convert(t);var e=Point.convert(i.offset),n=this.transform,o=n.project(t.getNorthWest()),r=n.project(t.getSouthEast()),s=r.sub(o),a=n.unproject(o.add(r).div(2)),u=(n.width-2*i.padding-2*Math.abs(e.x))/s.x,h=(n.height-2*i.padding-2*Math.abs(e.y))/s.y,f=Math.min(n.scaleZoom(n.scale*Math.min(u,h)),i.maxZoom);return i.linear?this.easeTo(a,f,0,i):this.flyTo(a,f,0,i)},easeTo:function(t,i,e,n){this.stop(),n=util.extend({offset:[0,0],duration:500,easing:util.ease},n);var o=this.transform,r=Point.convert(n.offset).rotate(-o.angle),s=this.getZoom(),a=this.getBearing();t=LatLng.convert(t),i=void 0===i?s:i,e=void 0===e?a:this._normalizeBearing(e,a);var u=o.zoomScale(i-s),h=o.point,f=LatLng.convert(n.around),d=t&&!f?o.project(t).sub(r.div(u)):h;return i!==s&&(this.zooming=!0),a!==e&&(this.rotating=!0),this.zooming&&t&&!f&&(f=o.pointLocation(o.centerPoint.add(d.sub(h).div(1-1/u)))),this.fire("movestart"),this._ease(function(t){this.zooming?o.setZoomAround(util.interp(s,i,t),f):o.center=o.unproject(h.add(d.sub(h).mult(t))),this.rotating&&o.setBearingAround(util.interp(a,e,t),n.around),this.animationLoop.set(300),this._move(i!==s,e!==a)},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},n),this},flyTo:function(t,i,e,n){function o(t){var i=(b*b-_*_+(t?-1:1)*L*L*z*z)/(2*(t?b:_)*L*z);return Math.log(Math.sqrt(i*i+1)-i)}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function a(t){return r(t)/s(t)}this.stop(),n=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},n),t=LatLng.convert(t);var u=Point.convert(n.offset),h=this.transform,f=this.getZoom(),d=this.getBearing();i=void 0===i?f:i,e=void 0===e?d:this._normalizeBearing(e,d);var c=h.zoomScale(i-f),m=h.point,g=h.project(t).sub(u.div(c));if(n.animate===!1)return this.setView(t,i,e);var l=h.worldSize,v=n.curve,p=n.speed,_=Math.max(h.width,h.height),b=_/c,z=g.sub(m).mag(),L=v*v,M=o(0),x=function(t){return s(M)/s(M+v*t)},T=function(t){return _*((s(M)*a(M+v*t)-r(M))/L)/z},B=(o(1)-M)/v;if(Math.abs(z)<1e-6){if(Math.abs(_-b)<1e-6)return this;var Z=_>b?-1:1;B=Math.abs(Math.log(b/_))/v,T=function(){return 0},x=function(t){return Math.exp(Z*v*t)}}return n.duration=1e3*B/p,this.zooming=!0,d!=e&&(this.rotating=!0),this.fire("movestart"),this._ease(function(t){var i=t*B,n=T(i);h.zoom=f+h.scaleZoom(1/x(i)),h.center=h.unproject(m.add(g.sub(m).mult(n)),l),e!==d&&(h.bearing=util.interp(d,e,t)),this.animationLoop.set(300),this._move(!0,e!==d)},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},n),this},_normalizeBearing:function(t,i){t=util.wrap(t,-180,180);var e=Math.abs(t-i);return Math.abs(t-360-i)<e&&(t-=360),Math.abs(t+360-i)<e&&(t+=360),t},_updateEasing:function(t,i,e){var n;if(this.ease){var o=this.ease,r=(Date.now()-o.start)/o.duration,s=o.easing(r+.01)-o.easing(r),a=.27/Math.sqrt(s*s+1e-4)*.01,u=Math.sqrt(.0729-a*a);n=util.bezier(a,u,.25,1)}else n=e?util.bezier.apply(util,e):util.ease;return this.ease={start:(new Date).getTime(),to:Math.pow(2,i),duration:t,easing:n},n}});
},{"../geo/lat_lng":17,"../geo/lat_lng_bounds":18,"../util/browser":76,"../util/util":86,"point-geometry":99}],70:[function(require,module,exports){
"use strict";function Handlers(n){var t,e,o,r=.2,a=util.bezier(0,0,r,1);this.interaction=new Interaction(n.container).on("click",function(t){n.fire("click",t)}).on("hover",function(t){n.fire("hover",t)}).on("down",function(){n.fire("movestart")}).on("resize",function(){n.stop(),n.resize(),n.update()}).on("pan",function(t){n.stop(),n.transform.panBy(t.offset),n._move()}).on("panend",function(t){if(t.inertia){var e=t.inertia.mult(1e3*r),o=e.mag(),i=4e3;o>=i&&(o=i,e._unit()._mult(i));var u=8e3,s=o/(u*r),c=e.mult(-s/2).round();n.panBy(c,{duration:1e3*s,easing:a,noMoveStart:!0})}else n.fire("moveend")}).on("zoom",function(t){var e=2/(1+Math.exp(-Math.abs(t.delta/100)));t.delta<0&&0!==e&&(e=1/e);var o=n.ease&&isFinite(t.delta)?n.ease.to:n.transform.scale,r=n.transform.scaleZoom(o*e),a=isFinite(t.delta)?"trackpad"===t.source?0:300:800;n.zoomTo(r,{duration:a,around:n.unproject(t.point)})}).on("pinchstart",function(){e=n.transform.scale,o=n.transform.bearing}).on("pinch",function(t){var r=n.transform.scaleZoom(e*t.scale),a=o+t.bearing;n.easeTo(null,r,a,{duration:0,around:n.unproject(t.point)})}).on("rotate",function(e){var o=n.transform.centerPoint,r=e.start.sub(o),a=r.mag();n.rotating=!0,200>a&&(o=e.start.add(new Point(-200,0)._rotate(r.angle())));var i=e.prev.sub(o).angleWith(e.current.sub(o))/Math.PI*180;n.transform.bearing=n.getBearing()-i,n._move(!1,!0),window.clearTimeout(t),t=window.setTimeout(function(){n.rotating=!1,n._rerender()},200)})}var Interaction=require("./interaction"),Point=require("point-geometry"),util=require("../util/util");module.exports=Handlers;
},{"../util/util":86,"./interaction":72,"point-geometry":99}],71:[function(require,module,exports){
"use strict";function Hash(t){this.map=t,window.addEventListener("hashchange",this.onhash.bind(this),!1),t.on("move",util.debounce(this.updateHash.bind(this),100))}module.exports=Hash;var util=require("../util/util");Hash.prototype={onhash:function(){var t=location.hash.replace("#","").split("/");return t.length>=3?(this.map.setView([+t[1],+t[2]],+t[0],+(t[3]||0)),!0):!1},updateHash:function(){var t=this.map.getCenter(),a=this.map.getZoom(),e=this.map.getBearing(),h=Math.max(0,Math.ceil(Math.log(a)/Math.LN2)),i="#"+Math.round(100*a)/100+"/"+t.lat.toFixed(h)+"/"+t.lng.toFixed(h)+(e?"/"+Math.round(10*e)/10:"");window.history.replaceState("","",i)}};
},{"../util/util":86}],72:[function(require,module,exports){
"use strict";function Interaction(e){function t(t){var n=e.getBoundingClientRect();return t=t.touches?t.touches[0]:t,new Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)}function n(e,t,n){E.fire("zoom",{source:e,delta:t,point:n}),k=null,g=null}function i(e,t,n){E.fire("pinch",{scale:e,bearing:t,point:n}),k=null,g=null}function o(e){E.fire("click",{point:e})}function r(e){E.fire("hover",{point:e})}function u(e){if(M){var t=M.sub(e);if(E.fire("pan",{offset:t}),k){var n=Date.now()-g;if(n){var i=n+g;for(k.push([i,e]);k.length>2&&i-k[0][0]>100;)k.shift()}}else k=[];g=Date.now(),M=e}}function l(){E.fire("resize")}function a(e){M&&(E.fire("rotate",{start:b,prev:M,current:e}),M=e)}function c(e){E.fire("dblclick",{point:e})}function s(e){b=M=t(e),E.fire("down")}function f(){if(D=M&&b&&(M.x!=b.x||M.y!=b.y),L=!1,M=null,k&&k.length>=2&&g>Date.now()-100){var e=k[k.length-1],t=k[0],n=e[1].sub(t[1]).div(e[0]-t[0]);E.fire("panend",{inertia:n})}else E.fire("panend");k=null,g=null}function d(n){var i=t(n);if(L)a(i);else if(M)u(i);else{for(var o=n.toElement;o&&o!=e&&o.parentNode;)o=o.parentNode;o==e&&r(i)}}function v(e){D||o(t(e))}function h(e){c(t(e)),n("wheel",1/0*(e.shiftKey?-1:1),t(e)),e.preventDefault()}function p(e){1===e.touches.length?s(e):2===e.touches.length&&(x=t(e.touches[0]).sub(t(e.touches[1])),E.fire("pinchstart"))}function w(e){if(1===e.touches.length)d(e);else if(2===e.touches.length){var n=t(e.touches[0]),o=t(e.touches[1]),r=n.add(o).div(2),u=n.sub(o),l=u.mag()/x.mag(),a=180*u.angleWith(x)/Math.PI;i(l,a,r)}e.preventDefault()}function m(n){function i(e,i){var o=a.now(),r=o-c;c=o;var u=t(i);0!==e&&e%4.000244140625===0?s="wheel":0!==e&&Math.abs(e)<4?s="trackpad":r>400?(s=null,d=e,f=setTimeout(function(){s="wheel",n(s,-d,u)},40)):null===s&&(s=Math.abs(r*e)<200?"trackpad":"wheel",f&&(clearTimeout(f),f=null,e+=d)),null!==s&&n(s,-e,u)}function o(e){var t=e.deltaY;u&&e.deltaMode==window.WheelEvent.DOM_DELTA_PIXEL&&(t/=browser.devicePixelRatio),e.deltaMode==window.WheelEvent.DOM_DELTA_LINE&&(t*=40),i(t,e),e.preventDefault()}function r(e){var t=-e.wheelDeltaY;l&&(t/=3),i(t,e),e.preventDefault()}var u=/Firefox/i.test(navigator.userAgent),l=/Safari/i.test(navigator.userAgent)&&!/Chrom(ium|e)/i.test(navigator.userAgent),a=window.performance||Date;e.addEventListener("wheel",o,!1),e.addEventListener("mousewheel",r,!1);var c=0,s=null,f=null,d=null}var E=this;if(e){var g,L=!1,D=!1,b=null,M=null,k=null;e.addEventListener("contextmenu",function(e){L=!0,b=M=t(e),e.preventDefault()},!1),e.addEventListener("mousedown",s,!1),e.addEventListener("touchstart",p,!1),document.addEventListener("mouseup",f,!1),document.addEventListener("touchend",f,!1),document.addEventListener("mousemove",d,!1),document.addEventListener("touchmove",w,!1),e.addEventListener("click",v,!1),m(n),e.addEventListener("dblclick",h,!1),window.addEventListener("resize",l,!1);var x}}var Evented=require("../util/evented"),browser=require("../util/browser"),Point=require("point-geometry");module.exports=Interaction,Interaction.prototype=Object.create(Evented);
},{"../util/browser":76,"../util/evented":81,"point-geometry":99}],73:[function(require,module,exports){
"use strict";var Canvas=require("../util/canvas"),util=require("../util/util"),browser=require("../util/browser"),Evented=require("../util/evented"),Style=require("../style/style"),AnimationLoop=require("../style/animation_loop"),GLPainter=require("../render/painter"),Transform=require("../geo/transform"),Hash=require("./hash"),Handlers=require("./handlers"),Easings=require("./easings"),LatLng=require("../geo/lat_lng"),LatLngBounds=require("../geo/lat_lng_bounds"),Point=require("point-geometry"),Attribution=require("./control/attribution"),Map=module.exports=function(t){if(t=this.options=util.inherit(this.options,t),this.animationLoop=new AnimationLoop,this.transform=new Transform(t.minZoom,t.maxZoom),this.hash=t.hash&&new Hash(this),t.maxBounds){var e=LatLngBounds.convert(t.maxBounds);this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform.lngRange=[e.getWest(),e.getEast()]}util.bindAll(["_forwardStyleEvent","_forwardSourceEvent","_forwardTileEvent","_onStyleChange","_onSourceAdd","_onSourceRemove","_onSourceUpdate","update","render"],this),this._setupContainer(),this._setupPainter(),this.handlers=t.interactive&&new Handlers(this),this.hash&&this.hash.onhash()||this.setView(t.center,t.zoom,t.bearing),this.sources={},this.stacks={},this.resize(),t.style&&this.setStyle(t.style),t.attributionControl&&this.addControl(new Attribution)};util.extend(Map.prototype,Evented),util.extend(Map.prototype,Easings),util.extend(Map.prototype,{options:{center:[0,0],zoom:0,bearing:0,minZoom:0,maxZoom:20,interactive:!0,hash:!1,attributionControl:!0},addSource:function(t,e){return this.style.addSource(t,e),this},removeSource:function(t){return this.style.removeSource(t),this},addControl:function(t){return t.addTo(this),this},setView:function(t,e,i){this.stop();var r=this.transform,o=r.zoom!==+e,n=r.bearing!==+i;return r.center=LatLng.convert(t),r.zoom=+e,r.bearing=+i,this.fire("movestart")._move(o,n).fire("moveend")},setCenter:function(t){this.setView(t,this.getZoom(),this.getBearing())},setZoom:function(t){this.setView(this.getCenter(),t,this.getBearing())},setBearing:function(t){this.setView(this.getCenter(),this.getZoom(),t)},getCenter:function(){return this.transform.center},getZoom:function(){return this.transform.zoom},getBearing:function(){return this.transform.bearing},resize:function(){var t=0,e=0;return this.container&&(t=this.container.offsetWidth||400,e=this.container.offsetHeight||300),this.canvas.resize(t,e),this.transform.width=t,this.transform.height=e,this.transform._constrain(),this.painter.resize(t,e),this.fire("movestart")._move().fire("resize").fire("moveend")},getBounds:function(){return new LatLngBounds(this.transform.pointLocation(new Point(0,0)),this.transform.pointLocation(this.transform.size))},project:function(t){return this.transform.locationPoint(LatLng.convert(t))},unproject:function(t){return this.transform.pointLocation(Point.convert(t))},featuresAt:function(t,e,i){return this.style.featuresAt(t,e,i),this},setStyle:function(t){return this.style&&this.style.off("load",this._forwardStyleEvent).off("error",this._forwardStyleEvent).off("change",this._onStyleChange).off("source.add",this._onSourceAdd).off("source.remove",this._onSourceRemove).off("source.load",this._onSourceUpdate).off("source.error",this._forwardSourceEvent).off("source.change",this._onSourceUpdate).off("tile.add",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent).off("tile.load",this.update).off("tile.error",this._forwardTileEvent)._remove(),t?(this.style=t instanceof Style?t:new Style(t,this.animationLoop),this.style.on("load",this._forwardStyleEvent).on("error",this._forwardStyleEvent).on("change",this._onStyleChange).on("source.add",this._onSourceAdd).on("source.remove",this._onSourceRemove).on("source.load",this._onSourceUpdate).on("source.error",this._forwardSourceEvent).on("source.change",this._onSourceUpdate).on("tile.add",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent).on("tile.load",this.update).on("tile.error",this._forwardTileEvent),this):void(this.style=null)},_move:function(t,e){return this.update(t).fire("move"),t&&this.fire("zoom"),e&&this.fire("rotate"),this},_setupContainer:function(){var t=this.options.container,e=this.container="string"==typeof t?document.getElementById(t):t;e&&e.classList.add("mapboxgl-map"),this.canvas=new Canvas(this,e)},_setupPainter:function(){var t=this.canvas.getWebGLContext();return t?void(this.painter=new GLPainter(t,this.transform)):void console.error("Failed to initialize WebGL")},_contextLost:function(t){t.preventDefault(),this._frameId&&browser.cancelFrame(this._frameId)},_contextRestored:function(){this._setupPainter(),this.resize(),this.update()},loaded:function(){return this._styleDirty||this._sourcesDirty?!1:this.style&&!this.style.loaded()?!1:!0},update:function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},render:function(){var t=this;return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&!this._sourcesDirtyTimeout&&(this._sourcesDirty=!1,this._sourcesDirtyTimeout=setTimeout(function(){t._sourcesDirtyTimeout=null},50),this.style._updateSources(this.transform)),this.painter.render(this.style,{debug:this.debug,vertices:this.vertices,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||!this.animationLoop.stopped())&&this._rerender(),this},remove:function(){return browser.cancelFrame(this._frameId),clearTimeout(this._sourcesDirtyTimeout),this.setStyle(null),this},_rerender:function(){this.style&&!this._frameId&&(this._frameId=browser.frame(this.render))},_forwardStyleEvent:function(t){this.fire("style."+t.type,util.extend({style:t.target},t))},_forwardSourceEvent:function(t){this.fire(t.type,util.extend({style:t.target},t))},_forwardTileEvent:function(t){this.fire(t.type,util.extend({style:t.target},t))},_onStyleChange:function(t){this.update(!0),this._forwardStyleEvent(t)},_onSourceAdd:function(t){var e=t.source;e.onAdd&&e.onAdd(this),this._forwardSourceEvent(t)},_onSourceRemove:function(t){var e=t.source;e.onRemove&&e.onRemove(this),this._forwardSourceEvent(t)},_onSourceUpdate:function(t){this.update(),this._forwardSourceEvent(t)}}),util.extendAll(Map.prototype,{_debug:!1,get debug(){return this._debug},set debug(t){this._debug=t,this.update()},_repaint:!1,get repaint(){return this._repaint},set repaint(t){this._repaint=t,this.update()},_vertices:!1,get vertices(){return this._vertices},set vertices(t){this._vertices=t,this.update()}});
},{"../geo/lat_lng":17,"../geo/lat_lng_bounds":18,"../geo/transform":19,"../render/painter":31,"../style/animation_loop":45,"../style/style":50,"../util/browser":76,"../util/canvas":77,"../util/evented":81,"../util/util":86,"./control/attribution":66,"./easings":69,"./handlers":70,"./hash":71,"point-geometry":99}],74:[function(require,module,exports){
"use strict";function Actor(t,e){this.target=t,this.parent=e,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)}module.exports=Actor,Actor.prototype.receive=function(t){var e,s=this,i=t.data;if("<response>"==i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e(i.error||null,i.data);else if("undefined"!=typeof i.id){var a=i.id;this.parent[i.type](i.data,function(t,e,i){s.postMessage({type:"<response>",id:String(a),error:t?String(t):null,data:e},i)})}else this.parent[i.type](i.data)},Actor.prototype.send=function(t,e,s,i){var a=null;s&&(this.callbacks[a=this.callbackID++]=s),this.postMessage({type:t,id:String(a),data:e},i)},Actor.prototype.postMessage=function(t,e){try{this.target.postMessage(t,e)}catch(s){this.target.postMessage(t)}};
},{}],75:[function(require,module,exports){
"use strict";exports.getJSON=function(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.onerror=function(e){t(e)},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var e;try{e=JSON.parse(n.response)}catch(r){return t(r)}t(null,e)}else t(new Error(n.statusText))},n.send(),n},exports.getArrayBuffer=function(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(e){t(e)},n.onload=function(){n.status>=200&&n.status<300&&n.response?t(null,n.response):t(new Error(n.statusText))},n.send(),n},exports.getImage=function(e,t){var n=new Image;return n.crossOrigin="Anonymous",n.onload=function(){t(null,n)},n.src=e,n.getData=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height).data},n},exports.getVideo=function(e,t){var n=document.createElement("video");n.crossOrigin="Anonymous",n.onloadstart=function(){t(null,n)};for(var r=0;r<e.length;r++){var o=document.createElement("source");o.src=e[r],n.appendChild(o)}return n.getData=function(){return n},n};
},{}],76:[function(require,module,exports){
"use strict";var frameName=function(){return window.requestAnimationFrame?"requestAnimationFrame":window.mozRequestAnimationFrame?"mozRequestAnimationFrame":window.webkitRequestAnimationFrame?"webkitRequestAnimationFrame":window.msRequestAnimationFrame?"msRequestAnimationFrame":void 0}();exports.frame=function(e){return window[frameName](e)},exports.cancelFrame=function(e){(window.cancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame)(e)},exports.timed=function(e,t,r){function n(a){o||(window.performance||(a=Date.now()),a>=i+t?e.call(r,1):(e.call(r,(a-i)/t),exports.frame(n)))}if(!t)return void e.call(r,1);var o=!1,i=window.performance?window.performance.now():Date.now();return exports.frame(n),function(){o=!0}},exports.supported=function(){for(var e=([function(){return"undefined"!=typeof window},function(){return"undefined"!=typeof document},function(){return!!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)},function(){return!(!Function.prototype||!Function.prototype.bind),!!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)},function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},function(){var e=document.createElement("canvas");return"supportsContext"in e?e.supportsContext("webgl")||e.supportsContext("experimental-webgl"):!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},function(){return"Worker"in window}]),t=0;t<e.length;t++)if(!e[t]())return!1;return!0},exports.hardwareConcurrency=navigator.hardwareConcurrency||8,Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}});
},{}],77:[function(require,module,exports){
"use strict";function Canvas(t,a){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.classList.add("mapboxgl-canvas"),t.options.interactive&&this.canvas.classList.add("mapboxgl-interactive"),this.canvas.addEventListener("webglcontextlost",t._contextLost.bind(t),!1),this.canvas.addEventListener("webglcontextrestored",t._contextRestored.bind(t),!1),a.appendChild(this.canvas)}module.exports=Canvas,Canvas.prototype.resize=function(t,a){var e=window.devicePixelRatio||1;this.canvas.width=e*t,this.canvas.height=e*a,this.canvas.style.width=t+"px",this.canvas.style.height=a+"px"},Canvas.prototype.getWebGLContext=function(){return this.canvas.getContext("experimental-webgl",{antialias:!1,alpha:!0,stencil:!0,depth:!1})};
},{}],78:[function(require,module,exports){
"use strict";function Dispatcher(t,r){this.actors=[],this.currentActor=0;var e,s,o;for(o=0;t>o;o++){absolute?(s=new Blob(['importScripts("'+workerFile+'");'],{type:"application/javascript"}),e=window.URL.createObjectURL(s)):e=workerFile;var c=new window.Worker(e),i=new Actor(c,r);i.name="Worker "+o,this.actors.push(i)}}var Actor=require("../actor"),scripts=document.getElementsByTagName("script"),workerFile=(document.currentScript||scripts[scripts.length-1]).getAttribute("src"),absolute=-1!==workerFile.indexOf("http");module.exports=Dispatcher,Dispatcher.prototype={broadcast:function(t,r){for(var e=0;e<this.actors.length;e++)this.actors[e].send(t,r)},send:function(t,r,e,s,o){return("number"!=typeof s||isNaN(s))&&(s=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[s].send(t,r,e,o),s},remove:function(){for(var t=0;t<this.actors.length;t++)this.actors[t].target.terminate();this.actors=[]}};
},{"../actor":74}],79:[function(require,module,exports){
"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com",HTTPS_URL:"https://a.tiles.mapbox.com",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0};
},{}],80:[function(require,module,exports){
"use strict";function preventDefault(e){e.preventDefault()}exports.create=function(e,t,n){var r=document.createElement(e);return t&&(r.className=t),n&&n.appendChild(r),r};var docEl="undefined"!=typeof document?document.documentElement:{},selectProp="userSelect"in docEl?"userSelect":"MozUserSelect"in docEl?"MozUserSelect":"WebkitUserSelect"in docEl?"WebkitUserSelect":null,userSelect;exports.disableDrag=function(){window.addEventListener("dragstart",preventDefault),"onselectstart"in document?window.addEventListener("selectstart",preventDefault):selectProp&&(userSelect=docEl.style[selectProp],docEl.style[selectProp]="none")},exports.enableDrag=function(){window.removeEventListener("dragstart",preventDefault),"onselectstart"in document?window.removeEventListener("selectstart",preventDefault):selectProp&&(docEl.style[selectProp]=userSelect)};
},{}],81:[function(require,module,exports){
"use strict";var util=require("./util");module.exports={on:function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),this},off:function(t,e){if(!t)return delete this._events,this;if(!this.listens(t))return this;if(e){var s=this._events[t].indexOf(e);s>=0&&this._events[t].splice(s,1),this._events[t].length||delete this._events[t]}else delete this._events[t];return this},once:function(t,e){var s=function(i){this.off(t,s),e.call(this,i)}.bind(this);return this.on(t,s),this},fire:function(t,e){if(!this.listens(t))return this;e=util.extend({},e),util.extend(e,{type:t,target:this});for(var s=this._events[t].slice(),i=0;i<s.length;i++)s[i].call(this,e);return this},listens:function(t){return!(!this._events||!this._events[t])}};
},{"./util":86}],82:[function(require,module,exports){
"use strict";function Glyphs(a,e){this.stacks=a.readFields(readFontstacks,{},e)}function readFontstacks(a,e,r){if(1==a){var t=r.readMessage(readFontstack,{glyphs:{}});e[t.name]=t}}function readFontstack(a,e,r){if(1==a)e.name=r.readString();else if(2==a)e.range=r.readString();else if(3==a){var t=r.readMessage(readGlyph,{});e.glyphs[t.id]=t}}function readGlyph(a,e,r){1==a?e.id=r.readVarint():2==a?e.bitmap=r.readBytes():3==a?e.width=r.readVarint():4==a?e.height=r.readVarint():5==a?e.left=r.readSVarint():6==a?e.top=r.readSVarint():7==a&&(e.advance=r.readVarint())}module.exports=Glyphs;
},{}],83:[function(require,module,exports){
"use strict";function normalizeURL(e,o,n){if(n=n||config.ACCESS_TOKEN,!n&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox GL. See https://www.mapbox.com/developers/api/#access-tokens");var t=config.FORCE_HTTPS||"undefined"!=typeof document&&"https:"===document.location.protocol;if(e=e.replace(/^mapbox:\/\//,(t?config.HTTPS_URL:config.HTTP_URL)+o),e+=-1!==e.indexOf("?")?"&access_token=":"?access_token=",config.REQUIRE_ACCESS_TOKEN){if("s"===n[0])throw new Error("Use a public access token (pk.*) with Mapbox GL JS, not a secret access token (sk.*). See https://www.mapbox.com/developers/api/#access-tokens");e+=n}return e}var config=require("./config");module.exports.normalizeStyleURL=function(e,o){var n=e.match(/^mapbox:\/\/([^.]+)/);return n?normalizeURL(e,"/styles/v1/"+n[1]+"/",o):e},module.exports.normalizeSourceURL=function(e,o){return e.match(/^mapbox:\/\//)?(e=normalizeURL(e+".json","/v4/",o),0===e.indexOf("https")&&(e+="&secure"),e):e},module.exports.normalizeGlyphsURL=function(e,o){return e.match(/^mapbox:\/\//)?normalizeURL(e,"/v4/",o):e};
},{"./config":79}],84:[function(require,module,exports){
"use strict";function MRUCache(t,e){this.max=t,this.onRemove=e,this.reset()}module.exports=MRUCache,MRUCache.prototype.reset=function(){for(var t in this.list)this.onRemove(this.list[t]);return this.list={},this.order=[],this},MRUCache.prototype.add=function(t,e){if(this.list[t]=e,this.order.push(t),this.order.length>this.max){var i=this.get(this.order[0]);i&&this.onRemove(i)}return this},MRUCache.prototype.has=function(t){return t in this.list},MRUCache.prototype.keys=function(){return this.order},MRUCache.prototype.get=function(t){if(!this.has(t))return null;var e=this.list[t];return delete this.list[t],this.order.splice(this.order.indexOf(t),1),e};
},{}],85:[function(require,module,exports){
"use strict";function resolveTokens(e,t){for(var r,n,o=t;r=o.match(tokenPattern);)n="undefined"==typeof e[r[1]]?"":e[r[1]],o=o.replace(r[0],n);return o}module.exports=resolveTokens;var tokenPattern=/{([^{}()\[\]<>$=:;.,^]+)}/;
},{}],86:[function(require,module,exports){
"use strict";var UnitBezier=require("unitbezier");exports.easeCubicInOut=function(r){if(0>=r)return 0;if(r>=1)return 1;var t=r*r,e=t*r;return 4*(.5>r?e:3*(r-t)+e-.75)},exports.bezier=function(r,t,e,n){var u=new UnitBezier(r,t,e,n);return function(r){return u.solve(r)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.interp=function(r,t,e){return r*(1-e)+t*e},exports.premultiply=function(r){return r[0]*=r[3],r[1]*=r[3],r[2]*=r[3],r},exports.clamp=function(r,t,e){return Math.min(e,Math.max(t,r))},exports.wrap=function(r,t,e){var n=e-t;return r===e?r:((r-t)%n+n)%n+t},exports.asyncEach=function(r,t,e){function n(){0===--u&&e()}var u=r.length;if(0===u)return e();for(var o=0;o<r.length;o++)t(r[o],n)},exports.keysDifference=function(r,t){var e=[];for(var n in r)n in t||e.push(n);return e},exports.extend=function(r,t){for(var e in t)r[e]=t[e];return r},exports.extendAll=function(r,t){for(var e in t)Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e));return r},exports.inherit=function(r,t){var e="function"==typeof r?r.prototype:r,n=Object.create(e);return exports.extendAll(n,t),n},exports.pick=function(r){for(var t={},e=1;e<arguments.length;e++){var n=arguments[e];n in r&&(t[n]=r[n])}return t};var id=1;exports.uniqueId=function(){return id++},exports.throttle=function(r,t,e){var n,u,o,i;return i=function(){n=!1,u&&(o.apply(e,u),u=!1)},o=function(){n?u=arguments:(r.apply(e,arguments),setTimeout(i,t),n=!0)}},exports.debounce=function(r,t){var e,n;return function(){n=arguments,clearTimeout(e),e=setTimeout(function(){r.apply(null,n)},t)}},exports.bindAll=function(r,t){r.forEach(function(r){return t[r]=t[r].bind(t)})};
},{"unitbezier":101}],87:[function(require,module,exports){
function clamp_css_byte(e){return e=Math.round(e),0>e?0:e>255?255:e}function clamp_css_float(e){return 0>e?0:e>1?1:e}function parse_css_int(e){return clamp_css_byte("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function parse_css_float(e){return clamp_css_float("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function css_hue_to_rgb(e,r,l){return 0>l?l+=1:l>1&&(l-=1),1>6*l?e+(r-e)*l*6:1>2*l?r:2>3*l?e+(r-e)*(2/3-l)*6:e}function parseCSSColor(e){var r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0]){if(4===r.length){var l=parseInt(r.substr(1),16);return l>=0&&4095>=l?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null}if(7===r.length){var l=parseInt(r.substr(1),16);return l>=0&&16777215>=l?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null}return null}var a=r.indexOf("("),t=r.indexOf(")");if(-1!==a&&t+1===r.length){var n=r.substr(0,a),s=r.substr(a+1,t-(a+1)).split(","),o=1;switch(n){case"rgba":if(4!==s.length)return null;o=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),o];case"hsla":if(4!==s.length)return null;o=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var i=(parseFloat(s[0])%360+360)%360/360,u=parse_css_float(s[1]),g=parse_css_float(s[2]),d=.5>=g?g*(u+1):g+u-g*u,c=2*g-d;return[clamp_css_byte(255*css_hue_to_rgb(c,d,i+1/3)),clamp_css_byte(255*css_hue_to_rgb(c,d,i)),clamp_css_byte(255*css_hue_to_rgb(c,d,i-1/3)),o];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}
},{}],88:[function(require,module,exports){
"use strict";function infix(t){return function(n,r,i){return"$type"===r?"t"+t+VectorTileFeatureTypes.indexOf(i):"p["+JSON.stringify(r)+"]"+t+JSON.stringify(i)}}function strictInfix(t){var n=infix(t);return function(t,r,i){return"$type"===r?n(t,r,i):"typeof(p["+JSON.stringify(r)+"]) === typeof("+JSON.stringify(i)+") && "+n(t,r,i)}}function compile(t){return operators[t[0]].apply(t,t)}function truth(){return!0}var VectorTileFeatureTypes=["Unknown","Point","LineString","Polygon"],operators={"==":infix("==="),"!=":infix("!=="),">":strictInfix(">"),"<":strictInfix("<"),"<=":strictInfix("<="),">=":strictInfix(">="),"in":function(t,n){return Array.prototype.slice.call(arguments,2).map(function(r){return"("+operators["=="](t,n,r)+")"}).join("||")||"false"},"!in":function(){return"!("+operators["in"].apply(this,arguments)+")"},any:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+compile(t)+")"}).join("||")||"false"},all:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+compile(t)+")"}).join("&&")||"true"},none:function(){return"!("+operators.any.apply(this,arguments)+")"}};module.exports=function(t){if(!t)return truth;var n="var p = f.properties || f.tags || {}, t = f.type; return "+compile(t)+";";return new Function("f",n)};
},{}],89:[function(require,module,exports){
"use strict";function clip(e,n,t,i,r,u){t/=n,i/=n;for(var l=[],p=0;p<e.length;p++){var s,h,c=e[p],o=c.geometry,a=c.type;if(c.min){if(s=c.min[r],h=c.max[r],s>=t&&i>=h){l.push(c);continue}if(s>i||t>h)continue}var g=1===a?clipPoints(o,t,i,r):clipGeometry(o,t,i,r,u,3===a);g.length&&l.push({geometry:g,type:a,tags:e[p].tags||null})}return l.length?l:null}function clipPoints(e,n,t,i){for(var r=[],u=0;u<e.length;u++){var l=e[u],p=l[i];p>=n&&t>=p&&r.push(l)}return r}function clipGeometry(e,n,t,i,r,u){for(var l=[],p=0;p<e.length;p++){var s,h,c=0,o=0,a=null,g=e[p],f=g.area,m=g.dist,v=g.length,w=[];for(h=0;v-1>h;h++)s=a||g[h],a=g[h+1],c=o||s[i],o=a[i],n>c?o>t?(w.push(r(s,a,n),r(s,a,t)),u||(w=newSlice(l,w,f,m))):o>=n&&w.push(r(s,a,n)):c>t?n>o?(w.push(r(s,a,t),r(s,a,n)),u||(w=newSlice(l,w,f,m))):t>=o&&w.push(r(s,a,t)):(w.push(s),n>o?(w.push(r(s,a,n)),u||(w=newSlice(l,w,f,m))):o>t&&(w.push(r(s,a,t)),u||(w=newSlice(l,w,f,m))));s=g[v-1],c=s[i],c>=n&&t>=c&&w.push(s);var y=w.length;u&&w[0]!==w[y-1]&&w.push(w[0]),newSlice(l,w,f,m)}return l}function newSlice(e,n,t,i){return n.length&&(n.area=t,n.dist=i,e.push(n)),[]}module.exports=clip;
},{}],90:[function(require,module,exports){
"use strict";function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)convertFeature(r,e.features[o],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){var o,n,a,i=t.geometry,c=i.type,l=i.coordinates,u=t.properties;if("Point"===c)e.push(create(u,1,[projectPoint(l)]));else if("MultiPoint"===c)e.push(create(u,1,project(l)));else if("LineString"===c)e.push(create(u,2,[project(l,r)]));else if("MultiLineString"===c||"Polygon"===c){for(a=[],o=0;o<l.length;o++)a.push(project(l[o],r));e.push(create(u,"Polygon"===c?3:2,a))}else if("MultiPolygon"===c){for(a=[],o=0;o<l.length;o++)for(n=0;n<l[o].length;n++)a.push(project(l[o][n],r));e.push(create(u,3,a))}else if("GeometryCollection"===c)for(o=0;o<i.geometries.length;o++)convertFeature(e,{geometry:i.geometries[o],properties:u},r);else console.warn("Unsupported GeoJSON type: "+i.type)}function create(e,t,r){var o={geometry:r,type:t,tags:e||null,min:[1,1],max:[0,0]};return calcBBox(o),o}function project(e,t){for(var r=[],o=0;o<e.length;o++)r.push(projectPoint(e[o]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return[r,o,0]}function calcSize(e){for(var t,r,o=0,n=0,a=0;a<e.length-1;a++)t=r||e[a],r=e[a+1],o+=t[0]*r[1]-r[0]*t[1],n+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(o/2),e.dist=n}function calcBBox(e){var t=e.geometry,r=e.min,o=e.max;if(1===e.type)calcRingBBOX(r,o,t);else for(var n=0;n<t.length;n++)calcRingBBOX(r,o,t[n]);return e}function calcRingBBOX(e,t,r){for(var o,n=0;n<r.length;n++)o=r[n],e[0]=Math.min(o[0],e[0]),t[0]=Math.max(o[0],t[0]),e[1]=Math.min(o[1],e[1]),t[1]=Math.max(o[1],t[1])}module.exports=convert;var simplify=require("./simplify");
},{"./simplify":92}],91:[function(require,module,exports){
"use strict";function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var i=t.debug;i&&console.time("preprocess data");var o=1<<t.baseZoom,n=convert(e,t.tolerance/(o*extent));this.tiles={},i&&(console.timeEnd("preprocess data"),console.time("generate tiles up to z"+t.maxZoom),this.stats=[],this.total=0),this.splitTile(n,0,0,0),i&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles up to z"+t.maxZoom),console.log("tiles generated:",this.total,this.stats))}function isClippedSquare(e){if(1!==e.length)return!1;var t=e[0];if(3!==t.type||t.geometry.length>1)return!1;for(var i=0;i<t.geometry[0].length;i++){var o=t.geometry[0][i];if(o[0]!==minPx&&o[0]!==maxPx||o[1]!==minPx&&o[1]!==maxPx)return!1}return!0}function toID(e,t,i){return 32*((1<<e)*i+t)+e}function intersectX(e,t,i){return[i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function intersectY(e,t,i){return[(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i,1]}function extend(e,t){for(var i in t)e[i]=t[i];return e}module.exports=geojsonvt;var clip=require("./clip"),convert=require("./convert"),createTile=require("./tile"),extent=4096,padding=8/512,minPx=Math.round(-padding*extent),maxPx=Math.round((1+padding)*extent);GeoJSONVT.prototype.options={maxZoom:4,baseZoom:14,maxPoints:100,tolerance:3,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,i,o,n,s,r){for(var l=[e,t,i,o],a=this.options,c=a.debug;l.length;){e=l.shift(),t=l.shift(),i=l.shift(),o=l.shift();var u=1<<t,p=toID(t,i,o),d=this.tiles[p],m=t===a.baseZoom?0:a.tolerance/(u*extent);if(d||(c>1&&console.time("creation"),d=this.tiles[p]=createTile(e,u,i,o,m,extent,t===a.baseZoom),c&&(c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,o,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation")),this.stats[t]=(this.stats[t]||0)+1,this.total++)),!n&&(t===a.maxZoom||d.numPoints<=a.maxPoints||isClippedSquare(d.features))||t===a.baseZoom||t===n)d.source=e;else{d.source=n?e:null,c>1&&console.time("clipping");var h,f,g,x,v,P,T,b,S,Z=.5*padding,y=.5-Z,q=.5+Z,O=1+Z;n&&(T=1<<n-t,b=.5>s/T-i,S=.5>r/T-o),h=f=g=x=v=P=null,(!n||b)&&(v=clip(e,u,i-Z,i+q,0,intersectX)),n&&b||(P=clip(e,u,i+y,i+O,0,intersectX)),v&&((!n||S)&&(h=clip(v,u,o-Z,o+q,1,intersectY)),n&&S||(f=clip(v,u,o+y,o+O,1,intersectY))),P&&((!n||S)&&(g=clip(P,u,o-Z,o+q,1,intersectY)),n&&S||(x=clip(P,u,o+y,o+O,1,intersectY))),c>1&&console.timeEnd("clipping"),h&&l.push(h,t+1,2*i,2*o),f&&l.push(f,t+1,2*i,2*o+1),g&&l.push(g,t+1,2*i+1,2*o),x&&l.push(x,t+1,2*i+1,2*o+1)}}},GeoJSONVT.prototype.getTile=function(e,t,i){var o=toID(e,t,i);if(this.tiles[o])return this.tiles[o];var n=this.options.debug;n>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var s,r=e,l=t,a=i;!s&&r>0;)r--,l=Math.floor(l/2),a=Math.floor(a/2),s=this.tiles[toID(r,l,a)];if(n>1&&console.log("found parent tile z%d-%d-%d",r,l,a),s.source){if(isClippedSquare(s.features))return s;n&&console.time("drilling down"),this.splitTile(s.source,r,l,a,e,t,i),n&&console.timeEnd("drilling down")}return this.tiles[o]};
},{"./clip":89,"./convert":90,"./tile":93}],92:[function(require,module,exports){
"use strict";function simplify(t,i){var e,r,o,p,s=i*i,f=t.length,n=0,u=f-1,g=[];for(t[n][2]=1,t[u][2]=1;u;){for(r=0,e=n+1;u>e;e++)o=getSqSegDist(t[e],t[n],t[u]),o>r&&(p=e,r=o);r>s&&(t[p][2]=r,g.push(n,p,p,u)),u=g.pop(),n=g.pop()}}function getSqSegDist(t,i,e){var r=i[0],o=i[1],p=e[0],s=e[1],f=t[0],n=t[1],u=p-r,g=s-o;if(0!==u||0!==g){var l=((f-r)*u+(n-o)*g)/(u*u+g*g);l>1?(r=p,o=s):l>0&&(r+=u*l,o+=g*l)}return u=f-r,g=n-o,u*u+g*g}module.exports=simplify;
},{}],93:[function(require,module,exports){
"use strict";function createTile(e,t,n,r,u,i,o){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null},a=0;a<e.length;a++)s.numFeatures++,addFeature(s,e[a],t,n,r,u,i,o);return s}function addFeature(e,t,n,r,u,i,o,s){var a,l,m,f,h=t.geometry,d=t.type,g=[],p=i*i;if(1===d)for(a=0;a<h.length;a++)g.push(transformPoint(h[a],n,r,u,o)),e.numPoints++,e.numSimplified++;else for(a=0;a<h.length;a++)if(m=h[a],s||!(2===d&&m.dist<i||3===d&&m.area<p)){var c=[];for(l=0;l<m.length;l++)f=m[l],(s||f[2]>p)&&(c.push(transformPoint(f,n,r,u,o)),e.numSimplified++),e.numPoints++;g.push(c)}else e.numPoints+=m.length;g.length&&e.features.push({geometry:g,type:d,tags:t.tags||null})}function transformPoint(e,t,n,r,u){var i=Math.round(u*(e[0]*t-n)),o=Math.round(u*(e[1]*t-r));return[i,o]}module.exports=createTile;
},{}],94:[function(require,module,exports){
!function(t){"use strict";var n={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(n.exports={},define(function(){return n.exports})):n.exports="undefined"!=typeof window?window:t:n.exports=exports,function(t){if(!n)var n=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!e)var e=Math.random;var a={};a.setMatrixArrayType=function(t){r=t},"undefined"!=typeof t&&(t.glMatrix=a);var u=Math.PI/180;a.toRadian=function(t){return t*u};var o={};o.create=function(){var t=new r(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var n=new r(2);return n[0]=t[0],n[1]=t[1],n},o.fromValues=function(t,n){var e=new r(2);return e[0]=t,e[1]=n,e},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},o.set=function(t,n,r){return t[0]=n,t[1]=r,t},o.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},o.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},o.sub=o.subtract,o.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},o.mul=o.multiply,o.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},o.div=o.divide,o.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t},o.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t},o.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},o.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t},o.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)},o.dist=o.distance,o.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return r*r+e*e},o.sqrDist=o.squaredDistance,o.length=function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},o.len=o.length,o.squaredLength=function(t){var n=t[0],r=t[1];return n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t},o.normalize=function(t,n){var r=n[0],e=n[1],a=r*r+e*e;return a>0&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a),t},o.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]},o.cross=function(t,n,r){var e=n[0]*r[1]-n[1]*r[0];return t[0]=t[1]=0,t[2]=e,t},o.lerp=function(t,n,r,e){var a=n[0],u=n[1];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t},o.random=function(t,n){n=n||1;var r=2*e()*Math.PI;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t},o.transformMat2=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[2]*a,t[1]=r[1]*e+r[3]*a,t},o.transformMat2d=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[2]*a+r[4],t[1]=r[1]*e+r[3]*a+r[5],t},o.transformMat3=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[3]*a+r[6],t[1]=r[1]*e+r[4]*a+r[7],t},o.transformMat4=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[4]*a+r[12],t[1]=r[1]*e+r[5]*a+r[13],t},o.forEach=function(){var t=o.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=2),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],u(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=o);var i={};i.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},i.clone=function(t){var n=new r(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},i.fromValues=function(t,n,e){var a=new r(3);return a[0]=t,a[1]=n,a[2]=e,a},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},i.set=function(t,n,r,e){return t[0]=n,t[1]=r,t[2]=e,t},i.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},i.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t},i.sub=i.subtract,i.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t},i.mul=i.multiply,i.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t},i.div=i.divide,i.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},i.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},i.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t},i.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t},i.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2];return Math.sqrt(r*r+e*e+a*a)},i.dist=i.distance,i.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2];return r*r+e*e+a*a},i.sqrDist=i.squaredDistance,i.length=function(t){var n=t[0],r=t[1],e=t[2];return Math.sqrt(n*n+r*r+e*e)},i.len=i.length,i.squaredLength=function(t){var n=t[0],r=t[1],e=t[2];return n*n+r*r+e*e},i.sqrLen=i.squaredLength,i.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},i.normalize=function(t,n){var r=n[0],e=n[1],a=n[2],u=r*r+e*e+a*a;return u>0&&(u=1/Math.sqrt(u),t[0]=n[0]*u,t[1]=n[1]*u,t[2]=n[2]*u),t},i.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},i.cross=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2];return t[0]=a*c-u*i,t[1]=u*o-e*c,t[2]=e*i-a*o,t},i.lerp=function(t,n,r,e){var a=n[0],u=n[1],o=n[2];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t[2]=o+e*(r[2]-o),t},i.random=function(t,n){n=n||1;var r=2*e()*Math.PI,a=2*e()-1,u=Math.sqrt(1-a*a)*n;return t[0]=Math.cos(r)*u,t[1]=Math.sin(r)*u,t[2]=a*n,t},i.transformMat4=function(t,n,r){var e=n[0],a=n[1],u=n[2];return t[0]=r[0]*e+r[4]*a+r[8]*u+r[12],t[1]=r[1]*e+r[5]*a+r[9]*u+r[13],t[2]=r[2]*e+r[6]*a+r[10]*u+r[14],t},i.transformMat3=function(t,n,r){var e=n[0],a=n[1],u=n[2];return t[0]=e*r[0]+a*r[3]+u*r[6],t[1]=e*r[1]+a*r[4]+u*r[7],t[2]=e*r[2]+a*r[5]+u*r[8],t},i.transformQuat=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2],f=r[3],s=f*e+i*u-c*a,h=f*a+c*e-o*u,v=f*u+o*a-i*e,M=-o*e-i*a-c*u;return t[0]=s*f+M*-o+h*-c-v*-i,t[1]=h*f+M*-i+v*-o-s*-c,t[2]=v*f+M*-c+s*-i-h*-o,t},i.rotateX=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[0],u[1]=a[1]*Math.cos(e)-a[2]*Math.sin(e),u[2]=a[1]*Math.sin(e)+a[2]*Math.cos(e),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.rotateY=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[2]*Math.sin(e)+a[0]*Math.cos(e),u[1]=a[1],u[2]=a[2]*Math.cos(e)-a[0]*Math.sin(e),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.rotateZ=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[0]*Math.cos(e)-a[1]*Math.sin(e),u[1]=a[0]*Math.sin(e)+a[1]*Math.cos(e),u[2]=a[2],t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.forEach=function(){var t=i.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=3),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],u(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2];return n}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=i);var c={};c.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},c.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},c.fromValues=function(t,n,e,a){var u=new r(4);return u[0]=t,u[1]=n,u[2]=e,u[3]=a,u},c.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},c.set=function(t,n,r,e,a){return t[0]=n,t[1]=r,t[2]=e,t[3]=a,t},c.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},c.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t},c.sub=c.subtract,c.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t},c.mul=c.multiply,c.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t},c.div=c.divide,c.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},c.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},c.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},c.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t[3]=n[3]+r[3]*e,t},c.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2],u=n[3]-t[3];return Math.sqrt(r*r+e*e+a*a+u*u)},c.dist=c.distance,c.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2],u=n[3]-t[3];return r*r+e*e+a*a+u*u},c.sqrDist=c.squaredDistance,c.length=function(t){var n=t[0],r=t[1],e=t[2],a=t[3];return Math.sqrt(n*n+r*r+e*e+a*a)},c.len=c.length,c.squaredLength=function(t){var n=t[0],r=t[1],e=t[2],a=t[3];return n*n+r*r+e*e+a*a},c.sqrLen=c.squaredLength,c.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},c.normalize=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*r+e*e+a*a+u*u;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o,t[3]=n[3]*o),t},c.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},c.lerp=function(t,n,r,e){var a=n[0],u=n[1],o=n[2],i=n[3];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t[2]=o+e*(r[2]-o),t[3]=i+e*(r[3]-i),t},c.random=function(t,n){return n=n||1,t[0]=e(),t[1]=e(),t[2]=e(),t[3]=e(),c.normalize(t,t),c.scale(t,t,n),t},c.transformMat4=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3];return t[0]=r[0]*e+r[4]*a+r[8]*u+r[12]*o,t[1]=r[1]*e+r[5]*a+r[9]*u+r[13]*o,t[2]=r[2]*e+r[6]*a+r[10]*u+r[14]*o,t[3]=r[3]*e+r[7]*a+r[11]*u+r[15]*o,t},c.transformQuat=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2],f=r[3],s=f*e+i*u-c*a,h=f*a+c*e-o*u,v=f*u+o*a-i*e,M=-o*e-i*a-c*u;return t[0]=s*f+M*-o+h*-c-v*-i,t[1]=h*f+M*-i+v*-o-s*-c,t[2]=v*f+M*-c+s*-i-h*-o,t},c.forEach=function(){var t=c.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=4),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],u(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),c.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=c);var f={};f.create=function(){var t=new r(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},f.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.transpose=function(t,n){if(t===n){var r=n[1];t[1]=n[2],t[2]=r}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},f.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*u-a*e;return o?(o=1/o,t[0]=u*o,t[1]=-e*o,t[2]=-a*o,t[3]=r*o,t):null},f.adjoint=function(t,n){var r=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=r,t},f.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},f.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1],f=r[2],s=r[3];return t[0]=e*i+u*c,t[1]=a*i+o*c,t[2]=e*f+u*s,t[3]=a*f+o*s,t},f.mul=f.multiply,f.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+u*i,t[1]=a*c+o*i,t[2]=e*-i+u*c,t[3]=a*-i+o*c,t},f.scale=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1];return t[0]=e*i,t[1]=a*i,t[2]=u*c,t[3]=o*c,t},f.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},f.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},f.LDU=function(t,n,r,e){return t[2]=e[2]/e[0],r[0]=e[0],r[1]=e[1],r[3]=e[3]-t[2]*r[1],[t,n,r]},"undefined"!=typeof t&&(t.mat2=f);var s={};s.create=function(){var t=new r(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},s.clone=function(t){var n=new r(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},s.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},s.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=r*u-e*a;return c?(c=1/c,t[0]=u*c,t[1]=-e*c,t[2]=-a*c,t[3]=r*c,t[4]=(a*i-u*o)*c,t[5]=(e*o-r*i)*c,t):null},s.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},s.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1],h=r[2],v=r[3],M=r[4],l=r[5];return t[0]=e*f+u*s,t[1]=a*f+o*s,t[2]=e*h+u*v,t[3]=a*h+o*v,t[4]=e*M+u*l+i,t[5]=a*M+o*l+c,t},s.mul=s.multiply,s.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=Math.sin(r),s=Math.cos(r);return t[0]=e*s+u*f,t[1]=a*s+o*f,t[2]=e*-f+u*s,t[3]=a*-f+o*s,t[4]=i,t[5]=c,t},s.scale=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1];return t[0]=e*f,t[1]=a*f,t[2]=u*s,t[3]=o*s,t[4]=i,t[5]=c,t},s.translate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1];return t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=e*f+u*s+i,t[5]=a*f+o*s+c,t},s.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},s.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=s);var h={};h.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.fromMat4=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},h.clone=function(t){var n=new r(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},h.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],a=n[5];t[1]=n[3],t[2]=n[6],t[3]=r,t[5]=n[7],t[6]=e,t[7]=a}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},h.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=s*o-i*f,v=-s*u+i*c,M=f*u-o*c,l=r*h+e*v+a*M;return l?(l=1/l,t[0]=h*l,t[1]=(-s*e+a*f)*l,t[2]=(i*e-a*o)*l,t[3]=v*l,t[4]=(s*r-a*c)*l,t[5]=(-i*r+a*u)*l,t[6]=M*l,t[7]=(-f*r+e*c)*l,t[8]=(o*r-e*u)*l,t):null},h.adjoint=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8];return t[0]=o*s-i*f,t[1]=a*f-e*s,t[2]=e*i-a*o,t[3]=i*c-u*s,t[4]=r*s-a*c,t[5]=a*u-r*i,t[6]=u*f-o*c,t[7]=e*c-r*f,t[8]=r*o-e*u,t},h.determinant=function(t){var n=t[0],r=t[1],e=t[2],a=t[3],u=t[4],o=t[5],i=t[6],c=t[7],f=t[8];return n*(f*u-o*c)+r*(-f*a+o*i)+e*(c*a-u*i)},h.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=r[0],M=r[1],l=r[2],d=r[3],m=r[4],p=r[5],w=r[6],y=r[7],q=r[8];return t[0]=v*e+M*o+l*f,t[1]=v*a+M*i+l*s,t[2]=v*u+M*c+l*h,t[3]=d*e+m*o+p*f,t[4]=d*a+m*i+p*s,t[5]=d*u+m*c+p*h,t[6]=w*e+y*o+q*f,t[7]=w*a+y*i+q*s,t[8]=w*u+y*c+q*h,t},h.mul=h.multiply,h.translate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=r[0],M=r[1];return t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=i,t[5]=c,t[6]=v*e+M*o+f,t[7]=v*a+M*i+s,t[8]=v*u+M*c+h,t},h.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=Math.sin(r),M=Math.cos(r);return t[0]=M*e+v*o,t[1]=M*a+v*i,t[2]=M*u+v*c,t[3]=M*o-v*e,t[4]=M*i-v*a,t[5]=M*c-v*u,t[6]=f,t[7]=s,t[8]=h,t},h.scale=function(t,n,r){var e=r[0],a=r[1];return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=a*n[3],t[4]=a*n[4],t[5]=a*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},h.fromMat2d=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},h.fromQuat=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r+r,i=e+e,c=a+a,f=r*o,s=e*o,h=e*i,v=a*o,M=a*i,l=a*c,d=u*o,m=u*i,p=u*c;return t[0]=1-h-l,t[3]=s-p,t[6]=v+m,t[1]=s+p,t[4]=1-f-l,t[7]=M-d,t[2]=v-m,t[5]=M+d,t[8]=1-f-h,t},h.normalFromMat4=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15],w=r*i-e*o,y=r*c-a*o,q=r*f-u*o,g=e*c-a*i,x=e*f-u*i,b=a*f-u*c,A=s*d-h*l,L=s*m-v*l,D=s*p-M*l,z=h*m-v*d,V=h*p-M*d,j=v*p-M*m,I=w*j-y*V+q*z+g*D-x*L+b*A;return I?(I=1/I,t[0]=(i*j-c*V+f*z)*I,t[1]=(c*D-o*j-f*L)*I,t[2]=(o*V-i*D+f*A)*I,t[3]=(a*V-e*j-u*z)*I,t[4]=(r*j-a*D+u*L)*I,t[5]=(e*D-r*V-u*A)*I,t[6]=(d*b-m*x+p*g)*I,t[7]=(m*q-l*b-p*y)*I,t[8]=(l*x-d*q+p*w)*I,t):null},h.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},h.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=h);var v={};v.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.clone=function(t){var n=new r(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},v.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},v.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],a=n[3],u=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[6]=n[9],t[7]=n[13],t[8]=e,t[9]=u,t[11]=n[14],t[12]=a,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},v.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15],w=r*i-e*o,y=r*c-a*o,q=r*f-u*o,g=e*c-a*i,x=e*f-u*i,b=a*f-u*c,A=s*d-h*l,L=s*m-v*l,D=s*p-M*l,z=h*m-v*d,V=h*p-M*d,j=v*p-M*m,I=w*j-y*V+q*z+g*D-x*L+b*A;return I?(I=1/I,t[0]=(i*j-c*V+f*z)*I,t[1]=(a*V-e*j-u*z)*I,t[2]=(d*b-m*x+p*g)*I,t[3]=(v*x-h*b-M*g)*I,t[4]=(c*D-o*j-f*L)*I,t[5]=(r*j-a*D+u*L)*I,t[6]=(m*q-l*b-p*y)*I,t[7]=(s*b-v*q+M*y)*I,t[8]=(o*V-i*D+f*A)*I,t[9]=(e*D-r*V-u*A)*I,t[10]=(l*x-d*q+p*w)*I,t[11]=(h*q-s*x-M*w)*I,t[12]=(i*L-o*z-c*A)*I,t[13]=(r*z-e*L+a*A)*I,t[14]=(d*y-l*g-m*w)*I,t[15]=(s*g-h*y+v*w)*I,t):null},v.adjoint=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15];return t[0]=i*(v*p-M*m)-h*(c*p-f*m)+d*(c*M-f*v),t[1]=-(e*(v*p-M*m)-h*(a*p-u*m)+d*(a*M-u*v)),t[2]=e*(c*p-f*m)-i*(a*p-u*m)+d*(a*f-u*c),t[3]=-(e*(c*M-f*v)-i*(a*M-u*v)+h*(a*f-u*c)),t[4]=-(o*(v*p-M*m)-s*(c*p-f*m)+l*(c*M-f*v)),t[5]=r*(v*p-M*m)-s*(a*p-u*m)+l*(a*M-u*v),t[6]=-(r*(c*p-f*m)-o*(a*p-u*m)+l*(a*f-u*c)),t[7]=r*(c*M-f*v)-o*(a*M-u*v)+s*(a*f-u*c),t[8]=o*(h*p-M*d)-s*(i*p-f*d)+l*(i*M-f*h),t[9]=-(r*(h*p-M*d)-s*(e*p-u*d)+l*(e*M-u*h)),t[10]=r*(i*p-f*d)-o*(e*p-u*d)+l*(e*f-u*i),t[11]=-(r*(i*M-f*h)-o*(e*M-u*h)+s*(e*f-u*i)),t[12]=-(o*(h*m-v*d)-s*(i*m-c*d)+l*(i*v-c*h)),t[13]=r*(h*m-v*d)-s*(e*m-a*d)+l*(e*v-a*h),t[14]=-(r*(i*m-c*d)-o*(e*m-a*d)+l*(e*c-a*i)),t[15]=r*(i*v-c*h)-o*(e*v-a*h)+s*(e*c-a*i),t},v.determinant=function(t){var n=t[0],r=t[1],e=t[2],a=t[3],u=t[4],o=t[5],i=t[6],c=t[7],f=t[8],s=t[9],h=t[10],v=t[11],M=t[12],l=t[13],d=t[14],m=t[15],p=n*o-r*u,w=n*i-e*u,y=n*c-a*u,q=r*i-e*o,g=r*c-a*o,x=e*c-a*i,b=f*l-s*M,A=f*d-h*M,L=f*m-v*M,D=s*d-h*l,z=s*m-v*l,V=h*m-v*d;return p*V-w*z+y*D+q*L-g*A+x*b},v.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=n[9],M=n[10],l=n[11],d=n[12],m=n[13],p=n[14],w=n[15],y=r[0],q=r[1],g=r[2],x=r[3];return t[0]=y*e+q*i+g*h+x*d,t[1]=y*a+q*c+g*v+x*m,t[2]=y*u+q*f+g*M+x*p,t[3]=y*o+q*s+g*l+x*w,y=r[4],q=r[5],g=r[6],x=r[7],t[4]=y*e+q*i+g*h+x*d,t[5]=y*a+q*c+g*v+x*m,t[6]=y*u+q*f+g*M+x*p,t[7]=y*o+q*s+g*l+x*w,y=r[8],q=r[9],g=r[10],x=r[11],t[8]=y*e+q*i+g*h+x*d,t[9]=y*a+q*c+g*v+x*m,t[10]=y*u+q*f+g*M+x*p,t[11]=y*o+q*s+g*l+x*w,y=r[12],q=r[13],g=r[14],x=r[15],t[12]=y*e+q*i+g*h+x*d,t[13]=y*a+q*c+g*v+x*m,t[14]=y*u+q*f+g*M+x*p,t[15]=y*o+q*s+g*l+x*w,t},v.mul=v.multiply,v.translate=function(t,n,r){var e,a,u,o,i,c,f,s,h,v,M,l,d=r[0],m=r[1],p=r[2];return n===t?(t[12]=n[0]*d+n[4]*m+n[8]*p+n[12],t[13]=n[1]*d+n[5]*m+n[9]*p+n[13],t[14]=n[2]*d+n[6]*m+n[10]*p+n[14],t[15]=n[3]*d+n[7]*m+n[11]*p+n[15]):(e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=n[9],M=n[10],l=n[11],t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=i,t[5]=c,t[6]=f,t[7]=s,t[8]=h,t[9]=v,t[10]=M,t[11]=l,t[12]=e*d+i*m+h*p+n[12],t[13]=a*d+c*m+v*p+n[13],t[14]=u*d+f*m+M*p+n[14],t[15]=o*d+s*m+l*p+n[15]),t},v.scale=function(t,n,r){var e=r[0],a=r[1],u=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*u,t[9]=n[9]*u,t[10]=n[10]*u,t[11]=n[11]*u,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},v.rotate=function(t,r,e,a){var u,o,i,c,f,s,h,v,M,l,d,m,p,w,y,q,g,x,b,A,L,D,z,V,j=a[0],I=a[1],P=a[2],Q=Math.sqrt(j*j+I*I+P*P);return Math.abs(Q)<n?null:(Q=1/Q,j*=Q,I*=Q,P*=Q,u=Math.sin(e),o=Math.cos(e),i=1-o,c=r[0],f=r[1],s=r[2],h=r[3],v=r[4],M=r[5],l=r[6],d=r[7],m=r[8],p=r[9],w=r[10],y=r[11],q=j*j*i+o,g=I*j*i+P*u,x=P*j*i-I*u,b=j*I*i-P*u,A=I*I*i+o,L=P*I*i+j*u,D=j*P*i+I*u,z=I*P*i-j*u,V=P*P*i+o,t[0]=c*q+v*g+m*x,t[1]=f*q+M*g+p*x,t[2]=s*q+l*g+w*x,t[3]=h*q+d*g+y*x,t[4]=c*b+v*A+m*L,t[5]=f*b+M*A+p*L,t[6]=s*b+l*A+w*L,t[7]=h*b+d*A+y*L,t[8]=c*D+v*z+m*V,t[9]=f*D+M*z+p*V,t[10]=s*D+l*z+w*V,t[11]=h*D+d*z+y*V,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},v.rotateX=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[4],o=n[5],i=n[6],c=n[7],f=n[8],s=n[9],h=n[10],v=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=u*a+f*e,t[5]=o*a+s*e,t[6]=i*a+h*e,t[7]=c*a+v*e,t[8]=f*a-u*e,t[9]=s*a-o*e,t[10]=h*a-i*e,t[11]=v*a-c*e,t},v.rotateY=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[0],o=n[1],i=n[2],c=n[3],f=n[8],s=n[9],h=n[10],v=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*a-f*e,t[1]=o*a-s*e,t[2]=i*a-h*e,t[3]=c*a-v*e,t[8]=u*e+f*a,t[9]=o*e+s*a,t[10]=i*e+h*a,t[11]=c*e+v*a,t},v.rotateZ=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[0],o=n[1],i=n[2],c=n[3],f=n[4],s=n[5],h=n[6],v=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*a+f*e,t[1]=o*a+s*e,t[2]=i*a+h*e,t[3]=c*a+v*e,t[4]=f*a-u*e,t[5]=s*a-o*e,t[6]=h*a-i*e,t[7]=v*a-c*e,t},v.fromRotationTranslation=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=e+e,c=a+a,f=u+u,s=e*i,h=e*c,v=e*f,M=a*c,l=a*f,d=u*f,m=o*i,p=o*c,w=o*f;return t[0]=1-(M+d),t[1]=h+w,t[2]=v-p,t[3]=0,t[4]=h-w,t[5]=1-(s+d),t[6]=l+m,t[7]=0,t[8]=v+p,t[9]=l-m,t[10]=1-(s+M),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},v.fromQuat=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r+r,i=e+e,c=a+a,f=r*o,s=e*o,h=e*i,v=a*o,M=a*i,l=a*c,d=u*o,m=u*i,p=u*c;return t[0]=1-h-l,t[1]=s+p,t[2]=v-m,t[3]=0,t[4]=s-p,t[5]=1-f-l,t[6]=M+d,t[7]=0,t[8]=v+m,t[9]=M-d,t[10]=1-f-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.frustum=function(t,n,r,e,a,u,o){var i=1/(r-n),c=1/(a-e),f=1/(u-o);return t[0]=2*u*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*c,t[6]=0,t[7]=0,t[8]=(r+n)*i,t[9]=(a+e)*c,t[10]=(o+u)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*u*2*f,t[15]=0,t},v.perspective=function(t,n,r,e,a){var u=1/Math.tan(n/2),o=1/(e-a);return t[0]=u/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*o,t[15]=0,t},v.ortho=function(t,n,r,e,a,u,o){var i=1/(n-r),c=1/(e-a),f=1/(u-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(n+r)*i,t[13]=(a+e)*c,t[14]=(o+u)*f,t[15]=1,t},v.lookAt=function(t,r,e,a){var u,o,i,c,f,s,h,M,l,d,m=r[0],p=r[1],w=r[2],y=a[0],q=a[1],g=a[2],x=e[0],b=e[1],A=e[2];return Math.abs(m-x)<n&&Math.abs(p-b)<n&&Math.abs(w-A)<n?v.identity(t):(h=m-x,M=p-b,l=w-A,d=1/Math.sqrt(h*h+M*M+l*l),h*=d,M*=d,l*=d,u=q*l-g*M,o=g*h-y*l,i=y*M-q*h,d=Math.sqrt(u*u+o*o+i*i),d?(d=1/d,u*=d,o*=d,i*=d):(u=0,o=0,i=0),c=M*i-l*o,f=l*u-h*i,s=h*o-M*u,d=Math.sqrt(c*c+f*f+s*s),d?(d=1/d,c*=d,f*=d,s*=d):(c=0,f=0,s=0),t[0]=u,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=f,t[6]=M,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(u*m+o*p+i*w),t[13]=-(c*m+f*p+s*w),t[14]=-(h*m+M*p+l*w),t[15]=1,t)},v.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},v.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=v);var M={};M.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},M.rotationTo=function(){var t=i.create(),n=i.fromValues(1,0,0),r=i.fromValues(0,1,0);return function(e,a,u){var o=i.dot(a,u);return-.999999>o?(i.cross(t,n,a),i.length(t)<1e-6&&i.cross(t,r,a),i.normalize(t,t),M.setAxisAngle(e,t,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.cross(t,a,u),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+o,M.normalize(e,e))}}(),M.setAxes=function(){var t=h.create();return function(n,r,e,a){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],M.normalize(n,M.fromMat3(n,t))}}(),M.clone=c.clone,M.fromValues=c.fromValues,M.copy=c.copy,M.set=c.set,M.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},M.setAxisAngle=function(t,n,r){r=.5*r;var e=Math.sin(r);return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=Math.cos(r),t},M.add=c.add,M.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1],f=r[2],s=r[3];return t[0]=e*s+o*i+a*f-u*c,t[1]=a*s+o*c+u*i-e*f,t[2]=u*s+o*f+e*c-a*i,t[3]=o*s-e*i-a*c-u*f,t},M.mul=M.multiply,M.scale=c.scale,M.rotateX=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+o*i,t[1]=a*c+u*i,t[2]=u*c-a*i,t[3]=o*c-e*i,t},M.rotateY=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c-u*i,t[1]=a*c+o*i,t[2]=u*c+e*i,t[3]=o*c-a*i,t},M.rotateZ=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+a*i,t[1]=a*c-e*i,t[2]=u*c+o*i,t[3]=o*c-u*i,t},M.calculateW=function(t,n){var r=n[0],e=n[1],a=n[2];return t[0]=r,t[1]=e,t[2]=a,t[3]=-Math.sqrt(Math.abs(1-r*r-e*e-a*a)),t},M.dot=c.dot,M.lerp=c.lerp,M.slerp=function(t,n,r,e){var a,u,o,i,c,f=n[0],s=n[1],h=n[2],v=n[3],M=r[0],l=r[1],d=r[2],m=r[3];return u=f*M+s*l+h*d+v*m,0>u&&(u=-u,M=-M,l=-l,d=-d,m=-m),1-u>1e-6?(a=Math.acos(u),o=Math.sin(a),i=Math.sin((1-e)*a)/o,c=Math.sin(e*a)/o):(i=1-e,c=e),t[0]=i*f+c*M,t[1]=i*s+c*l,t[2]=i*h+c*d,t[3]=i*v+c*m,t},M.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*r+e*e+a*a+u*u,i=o?1/o:0;return t[0]=-r*i,t[1]=-e*i,t[2]=-a*i,t[3]=u*i,t},M.conjugate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},M.length=c.length,M.len=M.length,M.squaredLength=c.squaredLength,M.sqrLen=M.squaredLength,M.normalize=c.normalize,M.fromMat3=function(t,n){var r,e=n[0]+n[4]+n[8];if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[7]-n[5])*r,t[1]=(n[2]-n[6])*r,t[2]=(n[3]-n[1])*r;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var u=(a+1)%3,o=(a+2)%3;r=Math.sqrt(n[3*a+a]-n[3*u+u]-n[3*o+o]+1),t[a]=.5*r,r=.5/r,t[3]=(n[3*o+u]-n[3*u+o])*r,t[u]=(n[3*u+a]+n[3*a+u])*r,t[o]=(n[3*o+a]+n[3*a+o])*r}return t},M.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=M)}(n.exports)}(this);
},{}],95:[function(require,module,exports){
module.exports={
  "$version": 6,
  "$root": {
    "version": {
      "required": true,
      "type": "enum",
      "values": [
        6
      ],
      "doc": "Stylesheet version number. Must be 6."
    },
    "constants": {
      "type": "constants",
      "doc": "An object of constants to be referenced in layers."
    },
    "sources": {
      "required": true,
      "type": "sources",
      "doc": "Data source specifications for layers to pull from."
    },
    "sprite": {
      "type": "string",
      "doc": "A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended."
    },
    "glyphs": {
      "type": "string",
      "doc": "A URL template for loading signed-distance-field glyph sets in PBF format. Valid tokens are {fontstack} and {range}."
    },
    "transition": {
      "type": "transition",
      "doc": "A global transition definition to use as a default across properties."
    },
    "layers": {
      "required": true,
      "type": "array",
      "value": "layer",
      "doc": "Layers will be drawn in the order of this array."
    }
  },
  "constants": {
    "*": {
      "type": "*",
      "doc": "A constant that will be replaced verbatim in the referencing place. This can be anything, including objects and arrays. All variable names must be prefixed with an `@` symbol."
    }
  },
  "sources": {
    "*": {
      "type": "source",
      "doc": "Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For GeoJSON and video sources, a URL must be provided."
    }
  },
  "source": {
    "type": {
      "required": true,
      "type": "enum",
      "values": [
        "vector",
        "raster",
        "geojson",
        "video"
      ],
      "doc": "The data type of the source."
    },
    "url": {
      "type": "string",
      "doc": "A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."
    },
    "tiles": {
      "type": "string",
      "doc": "An array of one or more tile source URLs, as in the TileJSON spec."
    },
    "minzoom": {
      "type": "number",
      "default": 0,
      "doc": "Minimum zoom level for which tiles are available, as in the TileJSON spec."
    },
    "maxzoom": {
      "type": "number",
      "default": 22,
      "doc": "Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."
    },
    "tileSize": {
      "type": "number",
      "default": 512,
      "units": "pixels",
      "doc": "The minimum visual size to display tiles for this layer. Only configurable for raster layers."
    },
    "*": {
      "type": "*",
      "doc": "Other keys to configure the data source."
    }
  },
  "layer": {
    "id": {
      "type": "string",
      "doc": "Unique layer name."
    },
    "type": {
      "type": "enum",
      "values": [
        "fill",
        "line",
        "symbol",
        "raster",
        "background"
      ],
      "doc": "Rendering type of this layer."
    },
    "ref": {
      "type": "string",
      "doc": "References another layer to copy `type`, `source`, `source-layer`, `minzoom`, `maxzoom`, `filter`, and `layout` properties from. This allows the layers to share processing and be more efficient."
    },
    "source": {
      "type": "string",
      "doc": "Name of a source description to be used for this layer."
    },
    "source-layer": {
      "type": "string",
      "doc": "Layer to use from a vector tile source. Required if the source supports multiple layers."
    },
    "minzoom": {
      "type": "number",
      "minimum": 0,
      "maximum": 22,
      "doc": "The minimum zoom level on which the layer gets parsed and appears on."
    },
    "maxzoom": {
      "type": "number",
      "minimum": 0,
      "maximum": 22,
      "doc": "The maximum zoom level on which the layer gets parsed and appears on."
    },
    "interactive": {
      "type": "boolean",
      "doc": "Enable querying of feature data from this layer for interactivity.",
      "default": false
    },
    "filter": {
      "type": "filter",
      "doc": "A expression specifying conditions on source features. Only features that match the filter are displayed."
    },
    "layers": {
      "type": "array",
      "value": "layer",
      "doc": "If `type` is `raster`, the child layers are composited together onto the previous level layer level."
    },
    "layout": {
      "type": "layout",
      "doc": "Layout properties for the layer."
    },
    "paint": {
      "type": "paint",
      "doc": "Default paint properties for this layer."
    },
    "paint.*": {
      "type": "paint",
      "doc": "Class-specific paint properties for this layer. The class name is the part after the first dot."
    }
  },
  "layout": [
    "layout_fill",
    "layout_line",
    "layout_symbol",
    "layout_raster",
    "layout_background"
  ],
  "layout_background": {
  },
  "layout_fill": {
  },
  "layout_line": {
    "line-cap": {
      "type": "enum",
      "values": [
        "butt",
        "round",
        "square"
      ],
      "default": "butt",
      "doc": "The display of line endings."
    },
    "line-join": {
      "type": "enum",
      "values": [
        "bevel",
        "round",
        "miter"
      ],
      "default": "miter",
      "doc": "The display of lines when joining."
    },
    "line-miter-limit": {
      "type": "number",
      "default": 2,
      "doc": "Used to automatically convert miter joins to bevel joins for sharp angles.",
      "requires": [
        {
          "line-join": "miter"
        }
      ]
    },
    "line-round-limit": {
      "type": "number",
      "default": 1,
      "doc": "Used to automatically convert round joins to miter joins for shallow angles.",
      "requires": [
        {
          "line-join": "round"
        }
      ]
    }
  },
  "layout_symbol": {
    "symbol-placement": {
      "type": "enum",
      "values": [
          "point",
          "line"
      ],
      "default": "point",
      "doc": "Label placement relative to its geometry. `Line` can only be used on LineStrings and Polygons."
    },
    "symbol-min-distance": {
      "type": "number",
      "default": 250,
      "minimum": 0,
      "units": "pixels",
      "doc": "Minimum distance between two symbol anchors.",
      "requires": [
        {
          "symbol-placement": "line"
        }
      ]
    },
    "symbol-avoid-edges": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer."
    },
    "icon-allow-overlap": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the icon will be visible even if it collides with other icons and text.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-ignore-placement": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the icon won't affect placement of other icons and text.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-optional": {
      "type": "boolean",
      "default": false,
      "doc": "If true, text can be shown without its corresponding icon.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-rotation-alignment": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "default": "viewport",
      "doc": "Orientation of icon when map is rotated",
      "requires": [
        "icon-image"
      ]
    },
    "icon-max-size": {
      "type": "number",
      "default": 1,
      "minimum": 0,
      "doc": "The maximum factor to scale the icon.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-image": {
      "type": "string",
      "doc": "A string with {tokens} replaced, referencing the data property to pull from.",
      "tokens": true
    },
    "icon-rotate": {
      "type": "number",
      "default": 0,
      "period": 360,
      "units": "degrees",
      "doc": "Rotates the icon clockwise.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-padding": {
      "type": "number",
      "default": 2,
      "minimum": 0,
      "units": "pixels",
      "doc": "Padding value around icon bounding box to avoid icon collisions.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-keep-upright": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the icon may be flipped to prevent it from being rendered upside-down",
      "requires": [
        "icon-image"
      ]
    },
    "icon-offset": {
      "type": "array",
      "value": "number",
      "length": 2,
      "default": [
        0,
        0
      ],
      "doc": "Icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.",
      "requires": [
        "icon-image"
      ]
    },
    "text-rotation-alignment": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "default": "viewport",
      "doc": "Orientation of icon or text when map is rotated",
      "requires": [
        "text-field"
      ]
    },
    "text-field": {
      "type": "string",
      "default": "",
      "tokens": true,
      "doc": "Value to use for a text label. Feature properties are specified using tokens like {field_name}."
    },
    "text-font": {
      "type": "string",
      "default": "Open Sans Regular, Arial Unicode MS Regular",
      "doc": "Font stack to use for displaying text.",
      "requires": [
        "text-field"
      ]
    },
    "text-max-size": {
      "type": "number",
      "default": 16,
      "minimum": 0,
      "units": "pixels",
      "doc": "The maximum size text will be laid out, to calculate collisions with.",
      "requires": [
        "text-field"
      ]
    },
    "text-max-width": {
      "type": "number",
      "default": 15,
      "minimum": 0,
      "units": "em",
      "doc": "The maximum line width for text wrapping.",
      "requires": [
        "text-field"
      ]
    },
    "text-line-height": {
      "type": "number",
      "default": 1.2,
      "doc": "Text leading value for multi-line text.",
      "requires": [
        "text-field"
      ]
    },
    "text-letter-spacing": {
      "type": "number",
      "default": 0,
      "units": "em",
      "doc": "Text kerning value.",
      "requires": [
        "text-field"
      ]
    },
    "text-justify": {
      "type": "enum",
      "values": [
        "center",
        "left",
        "right"
      ],
      "default": "center",
      "doc": "Text justification options.",
      "requires": [
        "text-field"
      ]
    },
    "text-anchor": {
      "type": "enum",
      "values": [
        "center",
        "left",
        "right",
        "top",
        "bottom",
        "top-left",
        "top-right",
        "bottom-left",
        "bottom-right"
      ],
      "default": "center",
      "doc": "Which part of the text to place closest to the anchor.",
      "requires": [
        "text-field"
      ]
    },
    "text-max-angle": {
      "type": "number",
      "default": 45,
      "units": "degrees",
      "doc": "Maximum angle change between adjacent characters.",
      "requires": [
        "text-field"
      ]
    },
    "text-rotate": {
      "type": "number",
      "default": 0,
      "period": 360,
      "units": "degrees",
      "doc": "Rotates the text clockwise.",
      "requires": [
        "text-field"
      ]
    },
    "text-padding": {
      "type": "number",
      "default": 2,
      "minimum": 0,
      "units": "pixels",
      "doc": "Padding value around text bounding box to avoid label collisions.",
      "requires": [
        "text-field"
      ]
    },
    "text-keep-upright": {
      "type": "boolean",
      "default": true,
      "doc": "If true, the text may be flipped vertically to prevent it from being rendered upside-down.",
      "requires": [
        "text-field"
      ]
    },
    "text-transform": {
      "type": "enum",
      "values": [
        "none",
        "uppercase",
        "lowercase"
      ],
      "default": "none",
      "doc": "Specifies how to capitalize text, similar to the CSS `text-transform` property.",
      "requires": [
        "text-field"
      ]
    },
    "text-offset": {
      "type": "array",
      "doc": "Specifies the distance that text is offset from its anchor horizontally and vertically.",
      "value": "number",
      "units": "ems",
      "length": 2,
      "default": [
        0,
        0
      ],
      "requires": [
        "text-field"
      ]
    },
    "text-allow-overlap": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the text will be visible even if it collides with other icons and labels.",
      "requires": [
        "text-field"
      ]
    },
    "text-ignore-placement": {
      "type": "boolean",
      "default": false,
      "doc": "If true, the text won't affect placement of other icons and labels.",
      "requires": [
        "text-field"
      ]
    },
    "text-optional": {
      "type": "boolean",
      "default": false,
      "doc": "If true, icons can be shown without their corresponding text.",
      "requires": [
        "text-field"
      ]
    }
  },
  "layout_raster": {
    "raster-size": {
      "type": "number",
      "function": true,
      "default": 256,
      "minimum": 0,
      "maximum": 3855,
      "units": "pixels",
      "doc": "The texture image size at which vector layers will be rasterized. Will scale to match the visual tile size."
    },
    "raster-blur": {
      "type": "number",
      "function": true,
      "default": 0,
      "minimum": 0,
      "units": "pixels",
      "doc": "Blur radius applied to the raster texture before display."
    }
  },
  "filter": {
    "type": "array",
    "value": "*"
  },
  "filter_operator": {
    "type": "enum",
    "values": [
      "==",
      "!=",
      ">",
      ">=",
      "<",
      "<=",
      "in",
      "!in",
      "all",
      "any",
      "none"
    ]
  },
  "geometry_type": {
    "type": "enum",
    "values": [
      "Point",
      "LineString",
      "Polygon"
    ]
  },
  "function": {
    "stops": {
      "type": "array",
      "required": true,
      "doc": "An array of stops.",
      "value": "function_stop"
    },
    "base": {
      "type": "number",
      "default": 1,
      "minimum": 0,
      "doc": "The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."
    }
  },
  "function_stop": {
    "type": "array",
    "minimum": 0,
    "maximum": 22,
    "value": [
      "number",
      "color"
    ],
    "length": 2,
    "doc": "Zoom level and value pair."
  },
  "paint": [
    "paint_fill",
    "paint_line",
    "paint_symbol",
    "paint_raster",
    "paint_background"
  ],
  "paint_fill": {
    "fill-antialias": {
      "type": "boolean",
      "default": true,
      "function": true,
      "doc": "Whether or not the fill should be antialiased."
    },
    "fill-opacity": {
      "type": "number",
      "function": true,
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "doc": "The opacity given to the fill color",
      "transition": true
    },
    "fill-color": {
      "type": "color",
      "default": "#000000",
      "doc": "The color of the fill.",
      "function": true,
      "transition": true,
      "requires": [
        {
          "!": "fill-image"
        }
      ]
    },
    "fill-outline-color": {
      "type": "color",
      "doc": "The outline color of the fill. Matches the value of `fill-color` if unspecified.",
      "function": true,
      "transition": true,
      "requires": [
        {
          "!": "fill-image"
        },
        {
          "fill-antialias": true
        }
      ]
    },
    "fill-translate": {
      "type": "array",
      "value": "number",
      "length": 2,
      "default": [
        0,
        0
      ],
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."
    },
    "fill-translate-anchor": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "doc": "Control whether the translation is relative to the map (north) or viewport (screen)",
      "default": "map",
      "requires": [
        "fill-translate"
      ]
    },
    "fill-image": {
      "type": "string",
      "doc": "Name of image in sprite to use for drawing image fills."
    }
  },
  "paint_line": {
    "line-opacity": {
      "type": "number",
      "doc": "The opacity at which the line will be drawn",
      "function": true,
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "transition": true
    },
    "line-color": {
      "type": "color",
      "doc": "The color with which the line will be drawn",
      "default": "#000000",
      "function": true,
      "transition": true,
      "requires": [
        {
          "!": "line-image"
        }
      ]
    },
    "line-translate": {
      "type": "array",
      "value": "number",
      "length": 2,
      "default": [
        0,
        0
      ],
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."
    },
    "line-translate-anchor": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "doc": "Control whether the translation is relative to the map (north) or viewport (screen)",
      "default": "map",
      "requires": [
        "line-translate"
      ]
    },
    "line-width": {
      "type": "number",
      "default": 1,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Stroke thickness"
    },
    "line-gap-width": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "doc": "Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",
      "function": true,
      "transition": true,
      "units": "pixels"
    },
    "line-blur": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Line blur"
    },
    "line-dasharray": {
      "type": "array",
      "value": "number",
      "doc": "Specifies the size and gap between dashes in a line.",
      "length": 2,
      "default": [
        1,
        -1
      ],
      "minimum": 0,
      "function": true,
      "transition": true,
      "requires": [
        {
          "!": "line-image"
        }
      ]
    },
    "line-image": {
      "type": "string",
      "doc": "Name of image in sprite to use for drawing image lines."
    }
  },
  "paint_symbol": {
    "icon-opacity": {
      "doc": "The opacity at which the icon will be drawn",
      "type": "number",
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "function": true,
      "transition": true,
      "requires": [
        "icon-image"
      ]
    },
    "icon-size": {
      "type": "number",
      "default": 1,
      "function": true,
      "transition": true,
      "doc": "Scale factor for icon. 1 is original size, 3 triples the size.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-color": {
      "type": "color",
      "default": "#000000",
      "function": true,
      "transition": true,
      "doc": "The color of the icon. This can only be used with sdf icons.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-halo-color": {
      "type": "color",
      "default": "rgba(0, 0, 0, 0)",
      "function": true,
      "transition": true,
      "doc": "The color of the icon's halo. Icon halos can only be used with sdf icons.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-halo-width": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Distance of halo to the icon outline.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-halo-blur": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Fade out the halo towards the outside.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-translate": {
      "type": "array",
      "value": "number",
      "length": 2,
      "default": [
        0,
        0
      ],
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "An icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.",
      "requires": [
        "icon-image"
      ]
    },
    "icon-translate-anchor": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "doc": "Control whether the translation is relative to the map (north) or viewport (screen)",
      "default": "map",
      "requires": [
        "icon-image",
        "icon-translate"
      ]
    },
    "text-opacity": {
      "type": "number",
      "doc": "The opacity at which the text will be drawn",
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "function": true,
      "transition": true,
      "requires": [
        "text-field"
      ]
    },
    "text-size": {
      "type": "number",
      "default": 16,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Font size. If unspecified, the text will be as big as allowed by the layer definition.",
      "requires": [
        "text-field"
      ]
    },
    "text-color": {
      "type": "color",
      "doc": "The color with which the text will be drawn",
      "default": "#000000",
      "function": true,
      "transition": true,
      "requires": [
        "text-field"
      ]
    },
    "text-halo-color": {
      "type": "color",
      "default": "rgba(0, 0, 0, 0)",
      "function": true,
      "transition": true,
      "doc": "The color of the text's halo, which helps it stand out from backgrounds.",
      "requires": [
        "text-field"
      ]
    },
    "text-halo-width": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",
      "requires": [
        "text-field"
      ]
    },
    "text-halo-blur": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "The halo's fadeout distance towards the outside.",
      "requires": [
        "text-field"
      ]
    },
    "text-translate": {
      "type": "array",
      "value": "number",
      "length": 2,
      "default": [
        0,
        0
      ],
      "function": true,
      "transition": true,
      "units": "pixels",
      "doc": "Label offset. Values are [x, y] where negatives indicate left and up, respectively.",
      "requires": [
        "text-field"
      ]
    },
    "text-translate-anchor": {
      "type": "enum",
      "values": [
        "map",
        "viewport"
      ],
      "doc": "Control whether the translation is relative to the map (north) or viewport (screen)",
      "default": "map",
      "requires": [
        "text-field",
        "text-translate"
      ]
    }
  },
  "paint_raster": {
    "raster-opacity": {
      "type": "number",
      "doc": "The opacity at which the image will be drawn",
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "transition": true
    },
    "raster-hue-rotate": {
      "type": "number",
      "default": 0,
      "period": 360,
      "function": true,
      "transition": true,
      "units": "degrees",
      "doc": "Rotates hues around the color wheel."
    },
    "raster-brightness": {
      "type": "array",
      "value": "number",
      "doc": "Increase or reduce the brightness of the image. First value is the minimum, second is the maximum brightness.",
      "length": 2,
      "default": [
        0,
        1
      ],
      "function": true,
      "transition": true
    },
    "raster-saturation": {
      "type": "number",
      "doc": "Increase or reduce the saturation of the image.",
      "default": 0,
      "function": true,
      "transition": true
    },
    "raster-contrast": {
      "type": "number",
      "doc": "Increase or reduce the contrast of the image.",
      "default": 0,
      "minimum": -1,
      "maximum": 1,
      "function": true,
      "transition": true
    },
    "raster-fade-duration": {
      "type": "number",
      "default": 300,
      "minimum": 0,
      "function": true,
      "transition": true,
      "units": "milliseconds",
      "doc": "Fade duration when a new tile is added."
    }
  },
  "paint_background": {
    "background-color": {
      "type": "color",
      "default": "#000000",
      "doc": "The color with which the background will be drawn",
      "function": true,
      "transition": true,
      "requires": [
        {
          "!": "background-image"
        }
      ]
    },
    "background-image": {
      "type": "string",
      "doc": "Optionally an image which is drawn as the background"
    },
    "background-opacity": {
      "type": "number",
      "default": 1,
      "minimum": 0,
      "maximum": 1,
      "doc": "The opacity at which the background will be drawn",
      "function": true,
      "transition": true
    }
  },
  "transition": {
    "duration": {
      "type": "number",
      "default": 300,
      "minimum": 0,
      "units": "milliseconds",
      "doc": "Time allotted for transitions to complete."
    },
    "delay": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "units": "milliseconds",
      "doc": "Length of time before a transition begins."
    }
  }
}

},{}],96:[function(require,module,exports){
"use strict";function Buffer(t){var e;t&&t.length&&(e=t,t=e.length);var r=new Uint8Array(t||0);return e&&r.set(e),r.readUInt32LE=BufferMethods.readUInt32LE,r.writeUInt32LE=BufferMethods.writeUInt32LE,r.readInt32LE=BufferMethods.readInt32LE,r.writeInt32LE=BufferMethods.writeInt32LE,r.readFloatLE=BufferMethods.readFloatLE,r.writeFloatLE=BufferMethods.writeFloatLE,r.readDoubleLE=BufferMethods.readDoubleLE,r.writeDoubleLE=BufferMethods.writeDoubleLE,r.toString=BufferMethods.toString,r.write=BufferMethods.write,r.slice=BufferMethods.slice,r.copy=BufferMethods.copy,r._isBuffer=!0,r}function encodeString(t){for(var e,r,n=t.length,i=[],o=0;n>o;o++){if(e=t.charCodeAt(o),e>55295&&57344>e){if(!r){e>56319||o+1===n?i.push(239,191,189):r=e;continue}if(56320>e){i.push(239,191,189),r=e;continue}e=r-55296<<10|e-56320|65536,r=null}else r&&(i.push(239,191,189),r=null);128>e?i.push(e):2048>e?i.push(e>>6|192,63&e|128):65536>e?i.push(e>>12|224,e>>6&63|128,63&e|128):i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return i}module.exports=Buffer;var ieee754=require("ieee754"),lastStr,lastStrEncoded,BufferMethods={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return ieee754.read(this,t,!0,23,4)},readDoubleLE:function(t){return ieee754.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return ieee754.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return ieee754.write(this,t,e,!0,52,8)},toString:function(t,e,r){var n="",i="";e=e||0,r=Math.min(this.length,r||this.length);for(var o=e;r>o;o++){var u=this[o];127>=u?(n+=decodeURIComponent(i)+String.fromCharCode(u),i=""):i+="%"+u.toString(16)}return n+=decodeURIComponent(i)},write:function(t,e){for(var r=t===lastStr?lastStrEncoded:encodeString(t),n=0;n<r.length;n++)this[e+n]=r[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var r=0;r<this.length;r++)t[e+r]=this[r]}};BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE,Buffer.byteLength=function(t){return lastStr=t,lastStrEncoded=encodeString(t),lastStrEncoded.length},Buffer.isBuffer=function(t){return!(!t||!t._isBuffer)};
},{"ieee754":98}],97:[function(require,module,exports){
(function(t){"use strict";function i(t){this.buf=d.isBuffer(t)?t:new d(t||0),this.pos=0,this.length=this.buf.length}function e(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function s(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function r(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function n(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function o(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function h(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function a(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function f(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function u(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}module.exports=i;var d=t.Buffer||require("./buffer");i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var l=4294967296,p=1/l;i.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var s=this.readVarint(),r=s>>3,n=this.pos;t(r,i,this),this.pos===n&&this.skip(s)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*l;return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*l;return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,i,e,s,r,n,o=this.buf;if(e=o[this.pos++],128>e)return e;if(e=127&e,s=o[this.pos++],128>s)return e|s<<7;if(s=(127&s)<<7,r=o[this.pos++],128>r)return e|s|r<<14;if(r=(127&r)<<14,n=o[this.pos++],128>n)return e|s|r|n<<21;if(t=e|s|r|(127&n)<<21,i=o[this.pos++],t+=268435456*(127&i),128>i)return t;if(i=o[this.pos++],t+=34359738368*(127&i),128>i)return t;if(i=o[this.pos++],t+=4398046511104*(127&i),128>i)return t;if(i=o[this.pos++],t+=562949953421312*(127&i),128>i)return t;if(i=o[this.pos++],t+=72057594037927940*(127&i),128>i)return t;if(i=o[this.pos++],t+=0x8000000000000000*(127&i),128>i)return t;throw new Error("Expected varint not more than 10 bytes")},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=this.buf.toString("utf8",this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.slice(this.pos,t);return this.pos=t,i},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readVarint());return i},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!=this.length){var e=new d(i);this.buf.copy(e),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeUInt32LE(Math.floor(t*p),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeInt32LE(Math.floor(t*p),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t,127>=t)this.realloc(1),this.buf[this.pos++]=t;else if(16383>=t)this.realloc(2),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127;else if(2097151>=t)this.realloc(3),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127;else if(268435455>=t)this.realloc(4),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127|128,this.buf[this.pos++]=t>>>21&127;else{for(var i=this.pos;t>=128;)this.realloc(1),this.buf[this.pos++]=255&t|128,t/=128;if(this.realloc(1),this.buf[this.pos++]=0|t,this.pos-i>10)throw new Error("Given varint doesn't fit into 10 bytes")}},writeSVarint:function(t){this.writeVarint(0>t?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var i=d.byteLength(t);this.writeVarint(i),this.realloc(i),this.buf.write(t,this.pos),this.pos+=i},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;i>e;e++)this.buf[this.pos++]=t[e]},writeMessage:function(t,e,s){this.writeTag(t,i.Bytes),this.pos++;var r=this.pos;e(s,this);var n=this.pos-r,o=127>=n?1:16383>=n?2:2097151>=n?3:268435455>=n?4:Math.ceil(Math.log(n)/(7*Math.LN2));if(o>1){this.realloc(o-1);for(var h=this.pos-1;h>=r;h--)this.buf[h+o-1]=this.buf[h]}this.pos=r-1,this.writeVarint(n),this.pos+=n},writePackedVarint:function(t,i){this.writeMessage(t,e,i)},writePackedSVarint:function(t,i){this.writeMessage(t,s,i)},writePackedBoolean:function(t,i){this.writeMessage(t,o,i)},writePackedFloat:function(t,i){this.writeMessage(t,r,i)},writePackedDouble:function(t,i){this.writeMessage(t,n,i)},writePackedFixed32:function(t,i){this.writeMessage(t,h,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,a,i)},writePackedFixed64:function(t,i){this.writeMessage(t,f,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,u,i)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});
},{"./buffer":96}],98:[function(require,module,exports){
exports.read=function(o,t,a,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,n=a?h-1:0,s=a?-1:1,N=o[t+n];for(n+=s,M=N&(1<<-i)-1,N>>=-i,i+=w;i>0;M=256*M+o[t+n],n+=s,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+o[t+n],n+=s,i-=8);if(0===M)M=1-e;else{if(M===f)return p?0/0:1/0*(N?-1:1);p+=Math.pow(2,r),M-=e}return(N?-1:1)*p*Math.pow(2,M-r)},exports.write=function(o,t,a,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,n=i>>1,s=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,N=r?0:M-1,u=r?1:-1,l=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(w=isNaN(t)?1:0,p=i):(p=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-p))<1&&(p--,f*=2),t+=p+n>=1?s/f:s*Math.pow(2,1-n),t*f>=2&&(p++,f/=2),p+n>=i?(w=0,p=i):p+n>=1?(w=(t*f-1)*Math.pow(2,h),p+=n):(w=t*Math.pow(2,n-1)*Math.pow(2,h),p=0));h>=8;o[a+N]=255&w,N+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;o[a+N]=255&p,N+=u,p/=256,e-=8);o[a+N-u]|=128*l};
},{}],99:[function(require,module,exports){
"use strict";function Point(t,n){this.x=t,this.y=n}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),i=Math.sin(t),s=n*this.x-i*this.y,r=i*this.x+n*this.y;return this.x=s,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t};
},{}],100:[function(require,module,exports){
!function(){"use strict";function t(i,n){return this instanceof t?(this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&this._initFormat(n),void this.clear()):new t(i,n)}function i(t,i){t.bbox=n(t,0,t.children.length,i)}function n(t,i,n,r){for(var o,a=h(),s=i;n>s;s++)o=t.children[s],e(a,t.leaf?r(o):o.bbox);return a}function h(){return[1/0,1/0,-1/0,-1/0]}function e(t,i){return t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.max(t[2],i[2]),t[3]=Math.max(t[3],i[3]),t}function r(t,i){return t.bbox[0]-i.bbox[0]}function o(t,i){return t.bbox[1]-i.bbox[1]}function a(t){return(t[2]-t[0])*(t[3]-t[1])}function s(t){return t[2]-t[0]+(t[3]-t[1])}function l(t,i){return(Math.max(i[2],t[2])-Math.min(i[0],t[0]))*(Math.max(i[3],t[3])-Math.min(i[1],t[1]))}function u(t,i){var n=Math.max(t[0],i[0]),h=Math.max(t[1],i[1]),e=Math.min(t[2],i[2]),r=Math.min(t[3],i[3]);return Math.max(0,e-n)*Math.max(0,r-h)}function c(t,i){return t[0]<=i[0]&&t[1]<=i[1]&&i[2]<=t[2]&&i[3]<=t[3]}function f(t,i){return i[0]<=t[2]&&i[1]<=t[3]&&i[2]>=t[0]&&i[3]>=t[1]}function d(t,i,n,h,e){for(var r,o=[i,n];o.length;)n=o.pop(),i=o.pop(),h>=n-i||(r=i+Math.ceil((n-i)/h/2)*h,x(t,i,n,r,e),o.push(i,r,r,n))}function x(t,i,n,h,e){for(var r,o,a,s,l,u,c,f,d;n>i;){for(n-i>600&&(r=n-i+1,o=h-i+1,a=Math.log(r),s=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*s*(r-s)/r)*(0>o-r/2?-1:1),u=Math.max(i,Math.floor(h-o*s/r+l)),c=Math.min(n,Math.floor(h+(r-o)*s/r+l)),x(t,u,c,h,e)),f=t[h],o=i,d=n,p(t,i,h),e(t[n],f)>0&&p(t,i,n);d>o;){for(p(t,o,d),o++,d--;e(t[o],f)<0;)o++;for(;e(t[d],f)>0;)d--}0===e(t[i],f)?p(t,i,d):(d++,p(t,d,n)),h>=d&&(i=d+1),d>=h&&(n=d-1)}}function p(t,i,n){var h=t[i];t[i]=t[n],t[n]=h}t.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],h=this.toBBox;if(!f(t,i.bbox))return n;for(var e,r,o,a,s=[];i;){for(e=0,r=i.children.length;r>e;e++)o=i.children[e],a=i.leaf?h(o):o.bbox,f(t,a)&&(i.leaf?n.push(o):c(t,a)?this._all(o,n):s.push(o));i=s.pop()}return n},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;n>i;i++)this.insert(t[i]);return this}var h=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var e=this.data;this.data=h,h=e}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:h(),leaf:!0},this},remove:function(t){if(!t)return this;for(var i,n,h,e,r=this.data,o=this.toBBox(t),a=[],s=[];r||a.length;){if(r||(r=a.pop(),n=a[a.length-1],i=s.pop(),e=!0),r.leaf&&(h=r.children.indexOf(t),-1!==h))return r.children.splice(h,1),a.push(r),this._condense(a),this;e||r.leaf||!c(r.bbox,o)?n?(i++,r=n.children[i],e=!1):r=null:(a.push(r),s.push(i),i=0,n=r,r=r.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,i){return t[0]-i[0]},compareMinY:function(t,i){return t[1]-i[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,n,h,e){var r,o=h-n+1,a=this._maxEntries;if(a>=o)return r={children:t.slice(n,h+1),height:1,bbox:null,leaf:!0},i(r,this.toBBox),r;e||(e=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,e-1))),r={children:[],height:e,bbox:null};var s,l,u,c,f=Math.ceil(o/a),x=f*Math.ceil(Math.sqrt(a));for(d(t,n,h,x,this.compareMinX),s=n;h>=s;s+=x)for(u=Math.min(s+x-1,h),d(t,s,u,f,this.compareMinY),l=s;u>=l;l+=f)c=Math.min(l+f-1,u),r.children.push(this._build(t,l,c,e-1));return i(r,this.toBBox),r},_chooseSubtree:function(t,i,n,h){for(var e,r,o,s,u,c,f,d;;){if(h.push(i),i.leaf||h.length-1===n)break;for(f=d=1/0,e=0,r=i.children.length;r>e;e++)o=i.children[e],u=a(o.bbox),c=l(t,o.bbox)-u,d>c?(d=c,f=f>u?u:f,s=o):c===d&&f>u&&(f=u,s=o);i=s}return i},_insert:function(t,i,n){var h=this.toBBox,r=n?t.bbox:h(t),o=[],a=this._chooseSubtree(r,this.data,i,o);for(a.children.push(t),e(a.bbox,r);i>=0&&o[i].children.length>this._maxEntries;)this._split(o,i),i--;this._adjustParentBBoxes(r,o,i)},_split:function(t,n){var h=t[n],e=h.children.length,r=this._minEntries;this._chooseSplitAxis(h,r,e);var o={children:h.children.splice(this._chooseSplitIndex(h,r,e)),height:h.height};h.leaf&&(o.leaf=!0),i(h,this.toBBox),i(o,this.toBBox),n?t[n-1].children.push(o):this._splitRoot(h,o)},_splitRoot:function(t,n){this.data={children:[t,n],height:t.height+1},i(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,h){var e,r,o,s,l,c,f,d;for(c=f=1/0,e=i;h-i>=e;e++)r=n(t,0,e,this.toBBox),o=n(t,e,h,this.toBBox),s=u(r,o),l=a(r)+a(o),c>s?(c=s,d=e,f=f>l?l:f):s===c&&f>l&&(f=l,d=e);return d},_chooseSplitAxis:function(t,i,n){var h=t.leaf?this.compareMinX:r,e=t.leaf?this.compareMinY:o,a=this._allDistMargin(t,i,n,h),s=this._allDistMargin(t,i,n,e);s>a&&t.children.sort(h)},_allDistMargin:function(t,i,h,r){t.children.sort(r);var o,a,l=this.toBBox,u=n(t,0,i,l),c=n(t,h-i,h,l),f=s(u)+s(c);for(o=i;h-i>o;o++)a=t.children[o],e(u,t.leaf?l(a):a.bbox),f+=s(u);for(o=h-i-1;o>=i;o--)a=t.children[o],e(c,t.leaf?l(a):a.bbox),f+=s(c);return f},_adjustParentBBoxes:function(t,i,n){for(var h=n;h>=0;h--)e(i[h].bbox,t)},_condense:function(t){for(var n,h=t.length-1;h>=0;h--)0===t[h].children.length?h>0?(n=t[h-1].children,n.splice(n.indexOf(t[h]),1)):this.clear():i(t[h],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module?module.exports=t:"undefined"!=typeof self?self.rbush=t:window.rbush=t}();
},{}],101:[function(require,module,exports){
function UnitBezier(t,i,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(r-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=e,this.p2y=r}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,i){"undefined"==typeof i&&(i=1e-6);var e,r,s,h,n;for(s=t,n=0;8>n;n++){if(h=this.sampleCurveX(s)-t,Math.abs(h)<i)return s;var u=this.sampleCurveDerivativeX(s);if(Math.abs(u)<1e-6)break;s-=h/u}if(e=0,r=1,s=t,e>s)return e;if(s>r)return r;for(;r>e;){if(h=this.sampleCurveX(s),Math.abs(h-t)<i)return s;t>h?e=s:r=s,s=.5*(r-e)+e}return s},UnitBezier.prototype.solve=function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))};
},{}],102:[function(require,module,exports){
module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js");
},{"./lib/vectortile.js":103,"./lib/vectortilefeature.js":104,"./lib/vectortilelayer.js":105}],103:[function(require,module,exports){
"use strict";function VectorTile(e,r){this.layers=e.readFields(readTile,{},r)}function readTile(e,r,a){if(3===e){var i=readLayer(a);i.length&&(r[i.name]=i)}}function readLayer(e){var r=e.readVarint(),a=e.pos+r,i=new VectorTileLayer(e,a);return e.pos=a,i}var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile;
},{"./vectortilelayer":105}],104:[function(require,module,exports){
"use strict";function VectorTileFeature(e,r,t,a,o){this.properties={},this.extent=t,this.type=0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=o,e.readFields(readFeature,this,r)}function readFeature(e,r,t){1==e?r._id=t.readVarint():2==e?readTag(t,r):3==e?r.type=t.readVarint():4==e&&(r._geometry=t.pos)}function readTag(e,r){for(var t=e.readVarint(),a=e.pos+t;e.pos<a;){var o=r._keys[e.readVarint()],i=r._values[e.readVarint()];r.properties[o]=i}}var Point=require("point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,t=e.readVarint(),a=e.pos+t,o=1,i=0,n=0,s=0,p=[];e.pos<a;){if(!i){var u=e.readVarint();o=7&u,i=u>>3}if(i--,1===o||2===o)n+=e.readSVarint(),s+=e.readSVarint(),1===o&&(r&&p.push(r),r=[]),r.push(new Point(n,s));else{if(7!==o)throw new Error("unknown command "+o);r.push(r[0].clone())}}return r&&p.push(r),p},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint(),t=e.pos+r,a=1,o=0,i=0,n=0,s=1/0,p=-1/0,u=1/0,d=-1/0;e.pos<t;){if(!o){var h=e.readVarint();a=7&h,o=h>>3}if(o--,1===a||2===a)i+=e.readSVarint(),n+=e.readSVarint(),s>i&&(s=i),i>p&&(p=i),u>n&&(u=n),n>d&&(d=n);else if(7!==a)throw new Error("unknown command "+a)}return[s,u,p,d]};
},{"point-geometry":99}],105:[function(require,module,exports){
"use strict";function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r))}function readValueMessage(e){for(var t=null,r=e.readVarint(),a=e.pos+r;e.pos<a;){var s=e.readVarint()>>3;t=1===s?e.readString():2===s?e.readFloat():3===s?e.readDouble():4===s||5===s?e.readVarint():6===s?e.readSVarint():7===s?Boolean(e.readVarint()):null}return t}var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(0>e||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)};
},{"./vectortilefeature.js":104}]},{},[21])


//# sourceMappingURL=mapbox-gl.js.map